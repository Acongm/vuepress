"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[8136],{8317:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-0897aa90",path:"/Pattern/COMPARISON.html",title:"观察者模式 vs 代理模式状态容器",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"需求",slug:"需求",children:[]},{level:2,title:"方式一：Observer（手动发布）",slug:"方式一-observer-手动发布",children:[]},{level:2,title:"方式二：ProxyStore（写入即发布）",slug:"方式二-proxystore-写入即发布",children:[]},{level:2,title:"对比表",slug:"对比表",children:[]},{level:2,title:"为什么都像 Vue3？",slug:"为什么都像-vue3",children:[]},{level:2,title:"选型建议",slug:"选型建议",children:[]}],git:{updatedTime:1770137152e3},filePathRelative:"Pattern/COMPARISON.md"}},5812:(n,s,a)=>{a.r(s),a.d(s,{default:()=>p});const t=(0,a(6252).uE)('<h1 id="观察者模式-vs-代理模式状态容器" tabindex="-1"><a class="header-anchor" href="#观察者模式-vs-代理模式状态容器" aria-hidden="true">#</a> 观察者模式 vs 代理模式状态容器</h1><blockquote><p>同一个需求（Counter），两种实现方式，看清它们的边界与取舍。</p></blockquote><h2 id="需求" tabindex="-1"><a class="header-anchor" href="#需求" aria-hidden="true">#</a> 需求</h2><p>多个地方监听 <code>count</code>，任意地方更新 <code>count</code> 时通知所有监听者，并能取消订阅。</p><hr><h2 id="方式一-observer-手动发布" tabindex="-1"><a class="header-anchor" href="#方式一-observer-手动发布" aria-hidden="true">#</a> 方式一：Observer（手动发布）</h2><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Observer/Subject&#39;</span>\n\n<span class="token keyword">const</span> counter$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 订阅（拿到的是完整 data）</span>\n<span class="token keyword">const</span> <span class="token function-variable function">observerA</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;A count =&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token keyword">const</span> <span class="token function-variable function">observerB</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;B count =&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n\ncounter$<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>observerA<span class="token punctuation">)</span>\ncounter$<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>observerB<span class="token punctuation">)</span>\n\n<span class="token comment">// ⚠️ 需要你&quot;显式 notify&quot;才会发布</span>\ncounter$<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\ncounter$<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 取消订阅</span>\ncounter$<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span>observerA<span class="token punctuation">)</span>\ncounter$<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span>observerB<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>特点</strong></p><ul><li>你决定何时发布（<code>notify</code>）</li><li>订阅者只拿到当前值，没有 <code>prevValue</code></li><li>适合：事件流、消息广播、跨模块通信</li></ul><hr><h2 id="方式二-proxystore-写入即发布" tabindex="-1"><a class="header-anchor" href="#方式二-proxystore-写入即发布" aria-hidden="true">#</a> 方式二：ProxyStore（写入即发布）</h2><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ProxyStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./ProxyStore/ProxyStore&#39;</span>\n\n<span class="token keyword">type</span> <span class="token class-name">State</span> <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyStore<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 按 key 订阅（返回 unsubscribe 函数）</span>\n<span class="token keyword">const</span> stopA <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prevValue<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;A:&#39;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> prevValue<span class="token punctuation">,</span> <span class="token string">&#39;-&gt;&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> stopB <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prevValue<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;B:&#39;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> prevValue<span class="token punctuation">,</span> <span class="token string">&#39;-&gt;&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// ✅ 直接赋值，自动触发通知</span>\nstore<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>\nstore<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">10</span>\n\n<span class="token comment">// 取消订阅</span>\n<span class="token function">stopA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token function">stopB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>特点</strong></p><ul><li>赋值即发布，代码更简洁</li><li>订阅者能拿到 <code>(value, key, prevValue)</code></li><li>适合：状态管理、细粒度响应式（Vue3 / Valtio 风格）</li></ul><hr><h2 id="对比表" tabindex="-1"><a class="header-anchor" href="#对比表" aria-hidden="true">#</a> 对比表</h2><table><thead><tr><th>维度</th><th>Observer (Subject)</th><th>ProxyStore</th></tr></thead><tbody><tr><td>触发时机</td><td>手动 <code>notify(data)</code></td><td>赋值即触发</td></tr><tr><td>订阅粒度</td><td>整个 Subject</td><td>按 key</td></tr><tr><td>回调签名</td><td><code>(data) =&gt; void</code></td><td><code>(value, key, prevValue) =&gt; void</code></td></tr><tr><td>是否有 prevValue</td><td>❌</td><td>✅</td></tr><tr><td>典型场景</td><td>事件广播、消息总线</td><td>状态容器、响应式数据</td></tr><tr><td>Vue3 对应</td><td>事件总线 / mitt</td><td><code>reactive</code> + <code>watch</code></td></tr></tbody></table><hr><h2 id="为什么都像-vue3" tabindex="-1"><a class="header-anchor" href="#为什么都像-vue3" aria-hidden="true">#</a> 为什么都像 Vue3？</h2><ol><li><strong>Proxy 拦截</strong>：ProxyStore 的 <code>set</code> trap 和 Vue3 <code>reactive</code> 完全相同——写入触发通知。</li><li><strong>订阅/通知</strong>：两者都是发布-订阅家族；Vue3 内部也是 <code>Map&lt;key, Set&lt;effect&gt;&gt;</code>，只是做了&quot;自动依赖收集&quot;。</li><li><strong>Subject 更像 <code>mitt</code> / 自定义事件</strong>：Vue3 没有内置事件总线，但社区用 <code>mitt</code> 实现的模式和 Subject 一模一样。</li></ol><hr><h2 id="选型建议" tabindex="-1"><a class="header-anchor" href="#选型建议" aria-hidden="true">#</a> 选型建议</h2><ul><li><strong>只是广播事件 / 不关心状态快照</strong>：用 Observer（Subject）。</li><li><strong>需要状态容器 + 细粒度响应</strong>：用 ProxyStore。</li><li><strong>需要自动依赖追踪（不手动 subscribe）</strong>：直接用 Vue3 reactivity / MobX / Valtio。</li></ul>',23),e={},p=(0,a(3744).Z)(e,[["render",function(n,s){return t}]])}}]);