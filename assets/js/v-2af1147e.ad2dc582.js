"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[337],{3798:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-2af1147e",path:"/Pattern/CustomEvent/",title:"原生自定义事件 (Custom Events)",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"概述",slug:"概述",children:[]},{level:2,title:"特点",slug:"特点",children:[]},{level:2,title:"原生用法",slug:"原生用法",children:[]},{level:2,title:"核心类",slug:"核心类",children:[{level:3,title:"CustomEventBridge",slug:"customeventbridge",children:[]}]},{level:2,title:"API 文档",slug:"api-文档",children:[{level:3,title:"推荐用法（DOM 事件风格）",slug:"推荐用法-dom-事件风格",children:[]}]},{level:2,title:"React Hook 示例",slug:"react-hook-示例",children:[]},{level:2,title:"跨框架通信示例",slug:"跨框架通信示例",children:[{level:3,title:"React 组件",slug:"react-组件",children:[]},{level:3,title:"Vue 组件",slug:"vue-组件",children:[]},{level:3,title:"原生 JavaScript",slug:"原生-javascript",children:[]}]},{level:2,title:"微前端通信",slug:"微前端通信",children:[]},{level:2,title:"事件名前缀",slug:"事件名前缀",children:[]},{level:2,title:"适用场景",slug:"适用场景",children:[]}],git:{updatedTime:1770135097e3},filePathRelative:"Pattern/CustomEvent/README.md"}},7169:(n,s,a)=>{a.r(s),a.d(s,{default:()=>e});const p=(0,a(6252).uE)('<h1 id="原生自定义事件-custom-events" tabindex="-1"><a class="header-anchor" href="#原生自定义事件-custom-events" aria-hidden="true">#</a> 原生自定义事件 (Custom Events)</h1><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><p>Custom Events 是浏览器原生的事件机制，可用于实现跨组件、跨框架的通信。通过 <code>CustomEvent</code> 和 <code>dispatchEvent</code> API 实现。</p><h2 id="特点" tabindex="-1"><a class="header-anchor" href="#特点" aria-hidden="true">#</a> 特点</h2><ul><li>✅ <strong>原生 API</strong>：无需任何依赖</li><li>✅ <strong>跨框架</strong>：React、Vue、Angular 都可使用</li><li>✅ <strong>跨微前端</strong>：不同子应用间通信</li><li>✅ <strong>浏览器支持好</strong>：IE9+ 都支持</li><li>⚠️ 仅限同一页面内（不跨标签页）</li><li>⚠️ 需要手动管理事件监听器</li></ul><h2 id="原生用法" tabindex="-1"><a class="header-anchor" href="#原生用法" aria-hidden="true">#</a> 原生用法</h2><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 发布事件</span>\nwindow<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>\n  <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">&#39;user:login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    detail<span class="token operator">:</span> <span class="token punctuation">{</span> userId<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&#39;John&#39;</span> <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span>\n\n<span class="token comment">// 订阅事件</span>\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;user:login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> CustomEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;User logged in:&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="核心类" tabindex="-1"><a class="header-anchor" href="#核心类" aria-hidden="true">#</a> 核心类</h2><h3 id="customeventbridge" tabindex="-1"><a class="header-anchor" href="#customeventbridge" aria-hidden="true">#</a> CustomEventBridge</h3><p>封装原生 API，添加缓存和类型安全。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bridge <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEventBridge</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">&#39;app:&#39;</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 发布</span>\nbridge<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&#39;John&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 订阅</span>\nbridge<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;User:&#39;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 获取缓存</span>\n<span class="token keyword">const</span> user <span class="token operator">=</span> bridge<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 取消订阅</span>\nbridge<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>\n\n<span class="token comment">// 一次性订阅</span>\nbridge<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;ready&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Ready!&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="api-文档" tabindex="-1"><a class="header-anchor" href="#api-文档" aria-hidden="true">#</a> API 文档</h2><h3 id="推荐用法-dom-事件风格" tabindex="-1"><a class="header-anchor" href="#推荐用法-dom-事件风格" aria-hidden="true">#</a> 推荐用法（DOM 事件风格）</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> on<span class="token punctuation">,</span> off<span class="token punctuation">,</span> dispatch<span class="token punctuation">,</span> once<span class="token punctuation">,</span> get<span class="token punctuation">,</span> clear <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./CustomEventSingleton&#39;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="dispatch-key-detail" tabindex="-1"><a class="header-anchor" href="#dispatch-key-detail" aria-hidden="true">#</a> dispatch(key, detail)</h4><p>发布数据，触发 CustomEvent。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">&#39;notification&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  type<span class="token operator">:</span> <span class="token string">&#39;success&#39;</span><span class="token punctuation">,</span>\n  message<span class="token operator">:</span> <span class="token string">&#39;操作成功&#39;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="get-key" tabindex="-1"><a class="header-anchor" href="#get-key" aria-hidden="true">#</a> get(key)</h4><p>获取缓存的数据。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> notification <span class="token operator">=</span> <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Notification<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;notification&#39;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="on-key-callback" tabindex="-1"><a class="header-anchor" href="#on-key-callback" aria-hidden="true">#</a> on(key, callback)</h4><p>订阅事件。如果已有缓存数据，立即触发回调。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;notification&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">showToast</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="off-key-callback" tabindex="-1"><a class="header-anchor" href="#off-key-callback" aria-hidden="true">#</a> off(key, callback)</h4><p>取消订阅（必须传入相同的函数引用）。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n<span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>\n<span class="token comment">// 稍后...</span>\n<span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="clear-key" tabindex="-1"><a class="header-anchor" href="#clear-key" aria-hidden="true">#</a> clear(key)</h4><p>清除数据并通知订阅者。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function">clear</span><span class="token punctuation">(</span><span class="token string">&#39;notification&#39;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="once-key-callback" tabindex="-1"><a class="header-anchor" href="#once-key-callback" aria-hidden="true">#</a> once(key, callback)</h4><p>一次性订阅，触发后自动移除。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;app:initialized&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;App ready!&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="react-hook-示例" tabindex="-1"><a class="header-anchor" href="#react-hook-示例" aria-hidden="true">#</a> React Hook 示例</h2><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useCustomEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token function">on</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> setData<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">off</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> setData<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">return</span> data\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用</span>\n<span class="token keyword">function</span> <span class="token function">NotificationToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> notification <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useCustomEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Notification<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;notification&#39;</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>notification<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">toast toast-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>notification<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">&gt;</span>\n      <span class="token punctuation">{</span>notification<span class="token punctuation">.</span>message<span class="token punctuation">}</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="跨框架通信示例" tabindex="-1"><a class="header-anchor" href="#跨框架通信示例" aria-hidden="true">#</a> 跨框架通信示例</h2><h3 id="react-组件" tabindex="-1"><a class="header-anchor" href="#react-组件" aria-hidden="true">#</a> React 组件</h3><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// React 发布</span>\n<span class="token keyword">function</span> <span class="token function">ReactButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">&#39;button:clicked&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> from<span class="token operator">:</span> <span class="token string">&#39;react&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">React Button</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="vue-组件" tabindex="-1"><a class="header-anchor" href="#vue-组件" aria-hidden="true">#</a> Vue 组件</h3><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> on<span class="token punctuation">,</span> off <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./CustomEventSingleton&#39;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Received from React:&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;button:clicked&#39;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;button:clicked&#39;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="原生-javascript" tabindex="-1"><a class="header-anchor" href="#原生-javascript" aria-hidden="true">#</a> 原生 JavaScript</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 直接使用原生 API 也可以接收</span>\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;shared:button:clicked&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Received:&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="微前端通信" tabindex="-1"><a class="header-anchor" href="#微前端通信" aria-hidden="true">#</a> 微前端通信</h2><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 主应用</span>\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">&#39;micro:route:change&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&#39;/dashboard&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 子应用 A (React)</span>\n<span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;micro:route:change&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">navigate</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 子应用 B (Vue)</span>\n<span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;micro:route:change&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="事件名前缀" tabindex="-1"><a class="header-anchor" href="#事件名前缀" aria-hidden="true">#</a> 事件名前缀</h2><p>默认使用 <code>shared:</code> 前缀，避免与其他事件冲突：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 实际触发的事件名</span>\n<span class="token string">&#39;shared:user&#39;</span>\n<span class="token string">&#39;shared:notification&#39;</span>\n<span class="token string">&#39;shared:cart&#39;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>自定义前缀：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bridge <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEventBridge</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">&#39;myapp:&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// 事件名变为 &#39;myapp:user&#39;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="适用场景" tabindex="-1"><a class="header-anchor" href="#适用场景" aria-hidden="true">#</a> 适用场景</h2><ul><li>跨框架组件通信（React + Vue + Angular）</li><li>微前端子应用间通信</li><li>与第三方脚本通信</li><li>需要最大兼容性的场景</li><li>不想引入任何依赖的场景</li></ul>',50),t={},e=(0,a(3744).Z)(t,[["render",function(n,s){return p}]])}}]);