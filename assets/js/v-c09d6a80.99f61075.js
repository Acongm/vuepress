"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[3709],{7602:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-c09d6a80",path:"/job-description/ASK_CODE_EXAMPLES.html",title:"可展示代码示例（用于面试展示/复盘）",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"1）Webpack：拆包、长缓存、产物分析",slug:"_1-webpack-拆包、长缓存、产物分析",children:[{level:3,title:"1.1 splitChunks / runtimeChunk",slug:"_1-1-splitchunks-runtimechunk",children:[]},{level:3,title:"1.2 contenthash + 静态资源缓存策略（要点）",slug:"_1-2-contenthash-静态资源缓存策略-要点",children:[]},{level:3,title:"1.3 sideEffects 的正确打开方式",slug:"_1-3-sideeffects-的正确打开方式",children:[]}]},{level:2,title:"2）性能：RUM（Web-Vitals）上报闭环",slug:"_2-性能-rum-web-vitals-上报闭环",children:[]},{level:2,title:"3）资源优先级：preconnect / preload",slug:"_3-资源优先级-preconnect-preload",children:[]},{level:2,title:"4）脚本加载：defer / async 的取舍",slug:"_4-脚本加载-defer-async-的取舍",children:[]},{level:2,title:"5）图片 WebP 兜底：<picture>",slug:"_5-图片-webp-兜底-picture",children:[]},{level:2,title:"6）ESLint：从 0-1 的落地方式（示例骨架）",slug:"_6-eslint-从-0-1-的落地方式-示例骨架",children:[]},{level:2,title:"7）React：错误边界（Error Boundary）",slug:"_7-react-错误边界-error-boundary",children:[]},{level:2,title:"8）NestJS：Cron 定时 + 幂等（示意）",slug:"_8-nestjs-cron-定时-幂等-示意",children:[]}],git:{updatedTime:1769096781e3},filePathRelative:"job-description/ASK_CODE_EXAMPLES.md"}},9803:(n,s,a)=>{a.r(s),a.d(s,{default:()=>e});const p=(0,a(6252).uE)('<h1 id="可展示代码示例-用于面试展示-复盘" tabindex="-1"><a class="header-anchor" href="#可展示代码示例-用于面试展示-复盘" aria-hidden="true">#</a> 可展示代码示例（用于面试展示/复盘）</h1><blockquote><p>说明：这里收纳“适合贴代码”的部分，避免把逐字稿写成代码仓库。 建议面试现场做法：先讲思路与取舍 → 再打开本文件挑 1-2 段关键代码讲。</p></blockquote><hr><h2 id="_1-webpack-拆包、长缓存、产物分析" tabindex="-1"><a class="header-anchor" href="#_1-webpack-拆包、长缓存、产物分析" aria-hidden="true">#</a> 1）Webpack：拆包、长缓存、产物分析</h2><h3 id="_1-1-splitchunks-runtimechunk" tabindex="-1"><a class="header-anchor" href="#_1-1-splitchunks-runtimechunk" aria-hidden="true">#</a> 1.1 <code>splitChunks</code> / <code>runtimeChunk</code></h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// webpack.prod.js（片段示例）</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">runtimeChunk</span><span class="token operator">:</span> <span class="token string">&#39;single&#39;</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\\\/]node_modules[\\\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>\n          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;vendors&#39;</span><span class="token punctuation">,</span>\n          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">10</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">common</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>\n          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_1-2-contenthash-静态资源缓存策略-要点" tabindex="-1"><a class="header-anchor" href="#_1-2-contenthash-静态资源缓存策略-要点" aria-hidden="true">#</a> 1.2 <code>contenthash</code> + 静态资源缓存策略（要点）</h3><ul><li>JS/CSS 文件名用 <code>contenthash</code>，避免“小改动导致全量缓存失效”。</li><li>CDN 强缓存 + 可回滚发布策略配套（缓存不是越长越好，关键是可控）。</li></ul><h3 id="_1-3-sideeffects-的正确打开方式" tabindex="-1"><a class="header-anchor" href="#_1-3-sideeffects-的正确打开方式" aria-hidden="true">#</a> 1.3 <code>sideEffects</code> 的正确打开方式</h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// package.json（示例）</span>\n<span class="token punctuation">{</span>\n  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>要点：不要把 <code>sideEffects</code> 一刀切设为 <code>false</code>，否则可能误伤样式导入。</p><hr><h2 id="_2-性能-rum-web-vitals-上报闭环" tabindex="-1"><a class="header-anchor" href="#_2-性能-rum-web-vitals-上报闭环" aria-hidden="true">#</a> 2）性能：RUM（Web-Vitals）上报闭环</h2><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// rum.ts（示例）</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> onLCP<span class="token punctuation">,</span> onCLS<span class="token punctuation">,</span> onINP<span class="token punctuation">,</span> onFCP<span class="token punctuation">,</span> onTTFB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;web-vitals&#39;</span>\n\n<span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span>metric<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  navigator<span class="token punctuation">.</span>sendBeacon<span class="token operator">?.</span><span class="token punctuation">(</span>\n    <span class="token string">&#39;/rum&#39;</span><span class="token punctuation">,</span>\n    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token operator">:</span> metric<span class="token punctuation">.</span>name<span class="token punctuation">,</span>\n      value<span class="token operator">:</span> metric<span class="token punctuation">.</span>value<span class="token punctuation">,</span>\n      id<span class="token operator">:</span> metric<span class="token punctuation">.</span>id<span class="token punctuation">,</span>\n      url<span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>\n      ua<span class="token operator">:</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span>\n      ts<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initRum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">onLCP</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n  <span class="token function">onCLS</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n  <span class="token function">onINP</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n  <span class="token function">onFCP</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n  <span class="token function">onTTFB</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>讲解要点：</p><ul><li>口径要说清楚：线上采样、P75/P95、按路由/按地域/按网络类型拆维度。</li><li>目标不是“跑分”，而是“可定位、可回归、可持续”。</li></ul><hr><h2 id="_3-资源优先级-preconnect-preload" tabindex="-1"><a class="header-anchor" href="#_3-资源优先级-preconnect-preload" aria-hidden="true">#</a> 3）资源优先级：<code>preconnect</code> / <code>preload</code></h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html（示例） --&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.example.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span> <span class="token punctuation">/&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>\n  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span>\n  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/assets/critical-font.woff2<span class="token punctuation">&quot;</span></span>\n  <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font<span class="token punctuation">&quot;</span></span>\n  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font/woff2<span class="token punctuation">&quot;</span></span>\n  <span class="token attr-name">crossorigin</span>\n<span class="token punctuation">/&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>讲解要点：</p><ul><li><code>preconnect</code> 解决的是“连接建立”成本。</li><li><code>preload</code> 解决的是“关键资源优先级”，只给确定影响首屏的资源。</li></ul><hr><h2 id="_4-脚本加载-defer-async-的取舍" tabindex="-1"><a class="header-anchor" href="#_4-脚本加载-defer-async-的取舍" aria-hidden="true">#</a> 4）脚本加载：<code>defer</code> / <code>async</code> 的取舍</h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/assets/app.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://third-party.example.com/sdk.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>讲解要点：</p><ul><li><code>defer</code>：不阻塞解析，且按顺序执行（适合业务主包）。</li><li><code>async</code>：下载完成就执行，顺序不保证（适合独立第三方脚本）。</li></ul><hr><h2 id="_5-图片-webp-兜底-picture" tabindex="-1"><a class="header-anchor" href="#_5-图片-webp-兜底-picture" aria-hidden="true">#</a> 5）图片 WebP 兜底：<code>&lt;picture&gt;</code></h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picture</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/img/banner.webp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/webp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/img/banner.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner<span class="token punctuation">&quot;</span></span> <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picture</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>讲解要点：</p><ul><li>前端兜底最稳定；特殊 WebView 可加能力探测（缓存结果）。</li><li>升级必须配监控：图片失败率、LCP 波动、错误日志。</li></ul><hr><h2 id="_6-eslint-从-0-1-的落地方式-示例骨架" tabindex="-1"><a class="header-anchor" href="#_6-eslint-从-0-1-的落地方式-示例骨架" aria-hidden="true">#</a> 6）ESLint：从 0-1 的落地方式（示例骨架）</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// .eslintrc.cjs（示例）</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&#39;@typescript-eslint/parser&#39;</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@typescript-eslint&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;import&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;promise&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;react-hooks&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token string">&#39;eslint:recommended&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;plugin:@typescript-eslint/recommended&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;plugin:promise/recommended&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;plugin:import/recommended&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;plugin:import/typescript&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;prettier&#39;</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 质量类：尽量 error</span>\n    <span class="token string-property property">&#39;@typescript-eslint/no-floating-promises&#39;</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span>\n    <span class="token string-property property">&#39;@typescript-eslint/no-unused-vars&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">argsIgnorePattern</span><span class="token operator">:</span> <span class="token string">&#39;^_&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 可读性：可 warn → 渐进收紧</span>\n    <span class="token string-property property">&#39;import/order&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;warn&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;newlines-between&#39;</span><span class="token operator">:</span> <span class="token string">&#39;always&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// Hooks：必须 error</span>\n    <span class="token string-property property">&#39;react-hooks/rules-of-hooks&#39;</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span>\n    <span class="token string-property property">&#39;react-hooks/exhaustive-deps&#39;</span><span class="token operator">:</span> <span class="token string">&#39;warn&#39;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>讲解要点：</p><ul><li>Prettier 管格式、ESLint 管质量，避免两者打架。</li><li>策略：新增必过、存量渐进；提交前自动修、CI 卡点。</li></ul><hr><h2 id="_7-react-错误边界-error-boundary" tabindex="-1"><a class="header-anchor" href="#_7-react-错误边界-error-boundary" aria-hidden="true">#</a> 7）React：错误边界（Error Boundary）</h2><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>\n  <span class="token punctuation">{</span> fallback<span class="token operator">?</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span> children<span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> hasError<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span>\n<span class="token operator">&gt;</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span> hasError<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> hasError<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 上报错误（示例）</span>\n    <span class="token comment">// reportError(error)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fallback <span class="token operator">??</span> <span class="token keyword">null</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>讲解要点：</p><ul><li>目的：把“局部崩溃”隔离掉，不影响主流程。</li><li>配套：错误上报 + 降级 UI + 可回滚。</li></ul><hr><h2 id="_8-nestjs-cron-定时-幂等-示意" tabindex="-1"><a class="header-anchor" href="#_8-nestjs-cron-定时-幂等-示意" aria-hidden="true">#</a> 8）NestJS：Cron 定时 + 幂等（示意）</h2><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@nestjs/common&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Cron <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@nestjs/schedule&#39;</span>\n\n<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ReportJobService</span> <span class="token punctuation">{</span>\n  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Cron</span></span><span class="token punctuation">(</span><span class="token string">&#39;0 */5 * * * *&#39;</span><span class="token punctuation">)</span>\n  <span class="token keyword">async</span> <span class="token function">generateReports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 关键点：</span>\n    <span class="token comment">// 1) 使用幂等键/分布式锁，避免多实例重复执行</span>\n    <span class="token comment">// 2) 任务实例入库，记录状态与产物</span>\n    <span class="token comment">// 3) 生成逻辑最好放到 worker/队列</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>讲解要点：</p><ul><li>cron 只负责触发；执行要有幂等/锁。</li><li>导出是重活：队列化、并发控制、超时与告警。</li></ul>',46),t={},e=(0,a(3744).Z)(t,[["render",function(n,s){return p}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,p]of s)a[n]=p;return a}}}]);