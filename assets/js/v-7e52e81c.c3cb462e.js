"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[1870],{3315:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-7e52e81c",path:"/interview-prep/tech__performance.html",title:"前端性能（指标体系与优化方法论）",lang:"zh-CN",frontmatter:{id:"tech__performance",type:"tech",title:"前端性能（指标体系与优化方法论）",mastery:"not_started",tags:["performance","web-vitals"],projects:["project__dji-user-center","project__dji-rms"],source_refs:[{source:"resume",file:"docs/job-description/web前端开发工程师-彭聪.md",anchor:"技术亮点"}],seed_refs:[{source:"outline",file:"docs/job-description/web前端开发工程师-彭聪-面试技术大纲.md",anchor:"性能指标与方法论"}],updated_at:"2025-12-20T00:00:00.000Z"},excerpt:"",headers:[{level:2,title:"摘要（Auto）",slug:"摘要-auto",children:[]},{level:2,title:"关联卡片",slug:"关联卡片",children:[]},{level:2,title:"在我项目中的角色与使用场景",slug:"在我项目中的角色与使用场景",children:[]},{level:2,title:"原理简述",slug:"原理简述",children:[]},{level:2,title:"对比表格",slug:"对比表格",children:[]},{level:2,title:"模拟问答",slug:"模拟问答",children:[]},{level:2,title:"手写代码区",slug:"手写代码区",children:[]},{level:2,title:"面试官追问（面试官视角）",slug:"面试官追问-面试官视角",children:[]},{level:2,title:"我的补充（Manual）",slug:"我的补充-manual",children:[]},{level:2,title:"复盘与反思（Learnings）",slug:"复盘与反思-learnings",children:[]}],git:{updatedTime:1769877604e3},filePathRelative:"interview-prep/tech__performance.md"}},1299:(n,s,a)=>{a.r(s),a.d(s,{default:()=>h});var t=a(6252);const p=(0,t._)("h2",{id:"摘要-auto",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#摘要-auto","aria-hidden":"true"},"#"),(0,t.Uk)(" 摘要（Auto）")],-1),e=(0,t._)("ul",null,[(0,t._)("li",null,"指标体系：LCP / FCP / TTI / CLS / INP、首屏/白屏时间、资源体积、接口耗时、缓存命中率"),(0,t._)("li",null,"定位手段：Performance/Network、Lighthouse、Web Vitals 上报、Long Task 分析"),(0,t._)("li",null,"优化策略：关键渲染路径（CRP）、渐进式渲染（骨架屏/占位/分片）、资源优先级（preload/prefetch）")],-1),o=(0,t._)("h2",{id:"关联卡片",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#关联卡片","aria-hidden":"true"},"#"),(0,t.Uk)(" 关联卡片")],-1),l=(0,t.Uk)("项目： "),c=(0,t._)("code",null,"project__dji-user-center",-1),i=(0,t._)("code",null,"project__dji-rms",-1),r=(0,t.Uk)("技术： "),u=(0,t._)("code",null,"tech__react",-1),k=(0,t._)("code",null,"tech__webpack",-1),d=(0,t.uE)('<h2 id="在我项目中的角色与使用场景" tabindex="-1"><a class="header-anchor" href="#在我项目中的角色与使用场景" aria-hidden="true">#</a> 在我项目中的角色与使用场景</h2><ul><li>用户中心（偏 C 端/高访问）：以 <strong>LCP/INP/CLS</strong> 为主指标，重点优化首屏可见与交互响应。</li><li>RMS（偏中后台/长生命周期）：以“<strong>性能预算 + 监控 + 回归门禁</strong>”做长期治理，防止随着需求叠加而性能回退。</li><li>我的落地方法（可复述）： <ul><li>先做基线：建立“现状数据 + 目标阈值 + 覆盖人群”（设备/网络/地域）。</li><li>再做定位：把慢拆成“网络/资源/主线程/渲染/接口”五类，逐类下刀。</li><li>最后做闭环：上线前门禁 + 上线后告警 + 定期复盘（看趋势而不是一次性成绩）。</li></ul></li></ul><h2 id="原理简述" tabindex="-1"><a class="header-anchor" href="#原理简述" aria-hidden="true">#</a> 原理简述</h2><p>分层认知：</p><ul><li>加载性能：TTFB/资源下载/缓存命中</li><li>运行时性能：Long Task、主线程阻塞、渲染频率</li><li>感知性能：骨架屏、占位、渐进渲染</li><li>可访问性：a11y 与性能治理的交集（焦点、可读性、交互响应）</li></ul><p>关键指标（Web Vitals）怎么理解（面试常考）：</p><ul><li><strong>LCP</strong>：最大内容元素渲染出来的时间 → “用户觉得页面内容出来了没” <ul><li>常见瓶颈：首屏 JS 过大、首图/字体优先级低、SSR/CSR 交互、接口慢导致占位迟迟不替换。</li></ul></li><li><strong>INP</strong>：用户交互到下一帧绘制完成的延迟 → “点了有没有立刻响应” <ul><li>常见瓶颈：主线程长任务、过多同步计算、事件处理里做重活、渲染一次做太多工作。</li></ul></li><li><strong>CLS</strong>：布局抖动 → “页面会不会跳” <ul><li>常见瓶颈：图片/广告/字体未预留尺寸、骨架屏与真实内容尺寸不一致、异步内容插入。</li></ul></li></ul><p>定位方法（我用的排查顺序）：</p><ul><li>先对齐口径：是“实验室数据（Lighthouse）”还是“真实用户数据（RUM）”？</li><li>Network：看 TTFB、关键资源 waterfall、是否被阻塞（CSS/字体/首图）。</li><li>Performance：看 Long Task、JS 执行占比、强制同步布局（Layout thrashing）。</li><li>React/前端框架：用 Profiler 看 commit 次数与耗时，锁定重渲染源头。</li></ul><p>优化方法论（可直接套话术）：</p><ul><li><strong>先保可见</strong>：骨架屏/占位/渐进渲染（先让 LCP 下来）</li><li><strong>再减阻塞</strong>：CRP 梳理（关键 CSS、字体、首图优先级）</li><li><strong>再降成本</strong>：更小的包、更少的执行、更少的无效渲染</li><li><strong>最后做治理</strong>：预算、监控、回归矩阵与门禁，避免“优化一次、回退十次”</li></ul><h2 id="对比表格" tabindex="-1"><a class="header-anchor" href="#对比表格" aria-hidden="true">#</a> 对比表格</h2><table><thead><tr><th>维度</th><th>骨架屏（Skeleton）</th><th>纯 Loading</th><th>结论</th></tr></thead><tbody><tr><td>感知速度</td><td><strong>强</strong>（先可见）</td><td>弱</td><td>首屏优先骨架/占位</td></tr><tr><td>CLS 风险</td><td>中（要对齐尺寸）</td><td>低</td><td>骨架必须“等比/占位”</td></tr><tr><td>实现成本</td><td>中</td><td>低</td><td>关键页面值得投入</td></tr></tbody></table><table><thead><tr><th>维度</th><th>preload</th><th>prefetch</th></tr></thead><tbody><tr><td>目的</td><td><strong>当前导航</strong>马上要用</td><td><strong>未来可能</strong>会用</td></tr><tr><td>优先级</td><td>高</td><td>低（空闲时）</td></tr><tr><td>常见场景</td><td>首屏首图/关键 chunk/字体</td><td>下一路由 chunk</td></tr></tbody></table><table><thead><tr><th>维度</th><th>HTTP/2 复用</th><th>域名拆分（domain sharding）</th></tr></thead><tbody><tr><td>结论</td><td>现代网络下更推荐复用</td><td>多数时候收益下降甚至变差</td></tr><tr><td>风险</td><td>需要服务端/网关支持</td><td>DNS/握手成本上升、缓存分散</td></tr></tbody></table><h2 id="模拟问答" tabindex="-1"><a class="header-anchor" href="#模拟问答" aria-hidden="true">#</a> 模拟问答</h2><ul><li>[ ] 你怎么建立性能基线？怎么保证“每一刀都有证据、每一刀都有回归验证”？ <ul><li>基线：选定关键页面与关键人群（设备/网络），记录 LCP/INP/CLS 分布（p50/p75/p95）。</li><li>证据：每次改动绑定一条假设（例如“首屏 JS -200KB → LCP p75 -300ms”），上线前后对比。</li><li>回归：把关键指标接入告警与趋势看板；引入性能预算门禁，防止包体/关键资源回退。</li></ul></li><li>[!] 优化导致 CLS 变差怎么办？如何设计兜底与回滚？ <ul><li>定位：用 Layout Shift 事件定位“谁在跳”（常见是图片/字体/骨架尺寸不一致）。</li><li>兜底：关键媒体资源预留宽高；骨架与真实内容共享布局；字体 <code>font-display</code> 策略与预加载。</li><li>回滚：关键优化走开关（灰度），CLS 异常触发自动降级（例如退回 loading 或关闭某组件异步插入）。</li></ul></li><li>[ ] 如何建立性能预算（bundle/关键资源上限）并做上线门禁？ <ul><li>预算维度：入口 bundle、关键路由 chunk、首屏关键资源（css/font/hero image）。</li><li><h1 id="门禁方式-ci-阶段比对-stats-json-或构建产物体积-超阈值阻断或需要审批。-current-your-changes" tabindex="-1"><a class="header-anchor" href="#门禁方式-ci-阶段比对-stats-json-或构建产物体积-超阈值阻断或需要审批。-current-your-changes" aria-hidden="true">#</a> 门禁方式：CI 阶段比对 <code>stats.json</code> 或构建产物体积；超阈值阻断或需要审批。 &lt;&lt;&lt;&lt;&lt;&lt;&lt; Current (Your changes)</h1></li></ul></li><li>[ ] 如何把“HTTP/缓存/TLS”这种偏网络的点，跟 LCP/TTFB 的指标关联起来？ <ul><li>口径：先把 LCP 拆成 TTFB + 资源下载 + 解析执行 + 渲染提交；网络侧主要影响 TTFB 与资源下载。</li><li>实操：对比协议版本（H1/H2/H3）、握手耗时、缓存命中率、压缩比，观察 TTFB 与关键资源 waterfall 是否缩短。</li></ul></li><li>[ ] 图片/字体在性能里怎么讲“收益与风险”？ <ul><li>图片：收益在“传输字节数与解码成本”；风险是 CLS（未预留尺寸）与首图优先级不当。</li><li>字体：收益在“阻塞链路缩短”；风险是 FOIT/FOUT 与重排（需要 <code>font-display</code>、子集化、预加载策略配合）。</li></ul></li><li>[ ] 为什么线上更看 p75/p95，而不是平均值？你怎么做弱网/中低端机回归？ <ul><li>p75/p95 更能代表“坏体验人群”，平均值容易被少量极快用户稀释。</li><li>回归：按设备档位/网络类型/关键路径做矩阵，跑同一页面同一账号同一资源版本对比。 <blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>Incoming (Background Agent changes)</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></li></ul></li></ul><h2 id="手写代码区" tabindex="-1"><a class="header-anchor" href="#手写代码区" aria-hidden="true">#</a> 手写代码区</h2><p>最小的 Web Vitals 上报（RUM）：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> onCLS<span class="token punctuation">,</span> onINP<span class="token punctuation">,</span> onLCP<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">Metric</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;web-vitals&#39;</span>\n\n<span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span>metric<span class="token operator">:</span> Metric<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 真实项目：加上用户/路由/设备信息 + 采样</span>\n  navigator<span class="token punctuation">.</span>sendBeacon<span class="token operator">?.</span><span class="token punctuation">(</span>\n    <span class="token string">&#39;/perf&#39;</span><span class="token punctuation">,</span>\n    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token operator">:</span> metric<span class="token punctuation">.</span>name<span class="token punctuation">,</span>\n      value<span class="token operator">:</span> metric<span class="token punctuation">.</span>value<span class="token punctuation">,</span>\n      id<span class="token operator">:</span> metric<span class="token punctuation">.</span>id<span class="token punctuation">,</span>\n      navigationType<span class="token operator">:</span> metric<span class="token punctuation">.</span>navigationType\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">onLCP</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n<span class="token function">onINP</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n<span class="token function">onCLS</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>性能预算门禁（伪代码：对 dist 目录做体积上限校验）：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// scripts/check-bundle-budget.js</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token constant">BUDGET</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token string-property property">&#39;assets/index-*.js&#39;</span><span class="token operator">:</span> <span class="token number">350</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>\n  <span class="token string-property property">&#39;assets/vendor-*.js&#39;</span><span class="token operator">:</span> <span class="token number">500</span> <span class="token operator">*</span> <span class="token number">1024</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">globMatch</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> pattern</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> re <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>\n    <span class="token string">&#39;^&#39;</span> <span class="token operator">+</span> pattern<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;\\\\.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\*</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;.*&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;$&#39;</span>\n  <span class="token punctuation">)</span>\n  <span class="token keyword">return</span> re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> dist <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> files <span class="token operator">=</span> fs\n  <span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> <span class="token string">&#39;assets&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">assets/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>f<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">let</span> ok <span class="token operator">=</span> <span class="token boolean">true</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>pattern<span class="token punctuation">,</span> limit<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token constant">BUDGET</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> f <span class="token keyword">of</span> files<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">globMatch</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> size <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      ok <span class="token operator">=</span> <span class="token boolean">false</span>\n      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[BUDGET FAIL] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>f<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>limit<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\nprocess<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>ok <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="面试官追问-面试官视角" tabindex="-1"><a class="header-anchor" href="#面试官追问-面试官视角" aria-hidden="true">#</a> 面试官追问（面试官视角）</h2><ul><li>[ ] 你怎么判断“体感慢”对应哪个指标？怎么落到行动？</li><li>[!] 弱网/中低端机如何评估？如何做回归矩阵？</li></ul><h2 id="我的补充-manual" tabindex="-1"><a class="header-anchor" href="#我的补充-manual" aria-hidden="true">#</a> 我的补充（Manual）</h2><p>（不会被脚本覆盖）</p><h2 id="复盘与反思-learnings" tabindex="-1"><a class="header-anchor" href="#复盘与反思-learnings" aria-hidden="true">#</a> 复盘与反思（Learnings）</h2><ul><li>如果重做会怎么改？</li></ul>',28),b={},h=(0,a(3744).Z)(b,[["render",function(n,s){const a=(0,t.up)("RouterLink");return(0,t.wg)(),(0,t.iD)(t.HY,null,[p,e,o,(0,t._)("ul",null,[(0,t._)("li",null,[l,(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/project__dji-user-center.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[c])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/project__dji-rms.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[i])),_:1})])])]),(0,t._)("li",null,[r,(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/tech__react.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[u])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/tech__webpack.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[k])),_:1})])])])]),d],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);