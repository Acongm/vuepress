"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[5435],{2565:(s,n,a)=>{a.r(n),a.d(n,{data:()=>t});const t={key:"v-6f5a46b5",path:"/interview-prep/matrix__lowcode-ssr-csr-export.html",title:"低代码与报表选型：Schema 渲染 / SSR vs CSR / 导出策略",lang:"zh-CN",frontmatter:{id:"matrix__lowcode-ssr-csr-export",type:"matrix",title:"低代码与报表选型：Schema 渲染 / SSR vs CSR / 导出策略",mastery:"not_started",tags:["lowcode","schema","ssr","csr","export","performance"],projects:["project__xdr-dashboard-report"],source_refs:[{source:"outline",file:"docs/job-description/web前端开发工程师-彭聪-面试技术大纲.md",anchor:"7）魔方大屏：低代码内部原理 / 8）报表：NestJS 的 SSR 原理"}],updated_at:"2025-12-21T00:00:00.000Z"},excerpt:"",headers:[{level:2,title:"摘要（Auto）",slug:"摘要-auto",children:[]},{level:2,title:"建议追问（Auto）",slug:"建议追问-auto",children:[]},{level:2,title:"关联卡片",slug:"关联卡片",children:[]},{level:2,title:"在我项目中的角色与使用场景",slug:"在我项目中的角色与使用场景",children:[]},{level:2,title:"原理简述",slug:"原理简述",children:[]},{level:2,title:"对比表格",slug:"对比表格",children:[{level:3,title:"1）低代码渲染器：自研 vs 开源二次开发",slug:"_1-低代码渲染器-自研-vs-开源二次开发",children:[]},{level:3,title:"2）渲染模式：CSR vs SSR vs 流式 SSR",slug:"_2-渲染模式-csr-vs-ssr-vs-流式-ssr",children:[]},{level:3,title:"3）导出：截图 vs 服务端渲染 vs 离线渲染任务",slug:"_3-导出-截图-vs-服务端渲染-vs-离线渲染任务",children:[]}]},{level:2,title:"模拟问答",slug:"模拟问答",children:[]},{level:2,title:"手写代码区",slug:"手写代码区",children:[{level:3,title:"1）SSR 注水/脱水（避免 hydration mismatch 的最小思路）",slug:"_1-ssr-注水-脱水-避免-hydration-mismatch-的最小思路",children:[]},{level:3,title:"2）导出任务：带权限快照的最小协议（伪代码）",slug:"_2-导出任务-带权限快照的最小协议-伪代码",children:[]}]},{level:2,title:"我的补充（Manual）",slug:"我的补充-manual",children:[]}],git:{updatedTime:1770135605e3},filePathRelative:"interview-prep/matrix__lowcode-ssr-csr-export.md"}},9193:(s,n,a)=>{a.r(n),a.d(n,{default:()=>h});var t=a(6252);const e=(0,t.uE)('<h2 id="摘要-auto" tabindex="-1"><a class="header-anchor" href="#摘要-auto" aria-hidden="true">#</a> 摘要（Auto）</h2><ul><li>生成时间：2025-12-21</li><li>关注点：Schema 驱动渲染链路、编辑器一致性、运行时性能治理、SSR/Hydration、导出一致性与权限隔离、稳定性与降级</li></ul><h2 id="建议追问-auto" tabindex="-1"><a class="header-anchor" href="#建议追问-auto" aria-hidden="true">#</a> 建议追问（Auto）</h2><ul><li>为什么选 SSR/CSR/流式 SSR？反例是什么？</li><li>导出怎么保证一致性与权限？失败怎么兜底？</li><li>低代码如何做物料版本治理与 schema 迁移？</li></ul><h2 id="关联卡片" tabindex="-1"><a class="header-anchor" href="#关联卡片" aria-hidden="true">#</a> 关联卡片</h2>',5),l=(0,t.Uk)("项目： "),r=(0,t._)("code",null,"project__xdr-dashboard-report",-1),i=(0,t.Uk)("技术： "),p=(0,t._)("code",null,"tech__react",-1),o=(0,t._)("code",null,"tech__typescript",-1),d=(0,t._)("code",null,"tech__performance",-1),c=(0,t.uE)('<h2 id="在我项目中的角色与使用场景" tabindex="-1"><a class="header-anchor" href="#在我项目中的角色与使用场景" aria-hidden="true">#</a> 在我项目中的角色与使用场景</h2><ul><li>低代码（大屏/报表）里通常会同时遇到三类“选型问题”： <ul><li><strong>渲染器</strong>：自研 vs 开源二次开发；编辑态/运行态一致性如何保证？</li><li><strong>渲染模式</strong>：SSR vs CSR vs 流式 SSR，首屏/SEO/鉴权/稳定性如何权衡？</li><li><strong>导出</strong>：客户端截图 vs 服务端渲染/离线渲染；一致性、权限隔离与失败兜底怎么做？</li></ul></li></ul><h2 id="原理简述" tabindex="-1"><a class="header-anchor" href="#原理简述" aria-hidden="true">#</a> 原理简述</h2><p>把问题拆成三段更容易讲清楚：</p><ul><li><strong>Schema 驱动低代码（核心）</strong>： <ul><li>schema 是可序列化的“UI + 数据 + 事件”描述；runtime 把 schema → runtime tree → 组件树。</li><li>关键：nodeId 索引 + 局部更新，避免“schema 一动全树重渲染”。</li><li>编辑器：拖拽/撤销重做/编组，本质是对 schema 的增量变更（command/patch）。</li></ul></li><li><strong>SSR/CSR（核心）</strong>： <ul><li>CSR：逻辑简单、生态成熟，但首屏完全依赖 JS 下载与执行；弱网/低端机更容易慢。</li><li>SSR：服务端先把 HTML 渲染出来（可带鉴权），客户端 hydration 接管；要处理一致性（时间/随机数/环境差异）。</li><li>流式 SSR：边渲染边输出，TTFB 更早；但错误处理/中断/缓存隔离更复杂。</li></ul></li><li><strong>导出（核心）</strong>： <ul><li>最重要的是“一致性 + 权限”：导出任务要带用户身份/权限快照，服务端按权限过滤数据，且与线上展示口径一致。</li><li>失败兜底：异步任务、重试、降级到截图或导出占位（按业务约束选择）。</li></ul></li></ul><h2 id="对比表格" tabindex="-1"><a class="header-anchor" href="#对比表格" aria-hidden="true">#</a> 对比表格</h2><h3 id="_1-低代码渲染器-自研-vs-开源二次开发" tabindex="-1"><a class="header-anchor" href="#_1-低代码渲染器-自研-vs-开源二次开发" aria-hidden="true">#</a> 1）低代码渲染器：自研 vs 开源二次开发</h3><table><thead><tr><th>维度</th><th>自研渲染器</th><th>开源框架二次开发</th></tr></thead><tbody><tr><td>定制能力</td><td><strong>强</strong>（贴合业务 DSL）</td><td>中-强（受框架边界影响）</td></tr><tr><td>交付速度</td><td>中</td><td><strong>快</strong></td></tr><tr><td>治理成本</td><td><strong>高</strong>（长期维护）</td><td>中（跟随社区升级）</td></tr><tr><td>风险与回滚</td><td>可控（版本锁定）但需要自建迁移体系</td><td>受上游版本影响，需要隔离升级风险</td></tr></tbody></table><h3 id="_2-渲染模式-csr-vs-ssr-vs-流式-ssr" tabindex="-1"><a class="header-anchor" href="#_2-渲染模式-csr-vs-ssr-vs-流式-ssr" aria-hidden="true">#</a> 2）渲染模式：CSR vs SSR vs 流式 SSR</h3><table><thead><tr><th>维度</th><th>CSR</th><th>SSR</th><th>流式 SSR</th></tr></thead><tbody><tr><td>首屏</td><td>中-差（依赖 JS）</td><td><strong>好</strong>（HTML 直出）</td><td><strong>更好</strong>（边渲染边输出）</td></tr><tr><td>SEO</td><td>弱</td><td><strong>强</strong></td><td><strong>强</strong></td></tr><tr><td>实现复杂度</td><td>低</td><td>中-高（hydration/同构数据）</td><td>高（错误/中断/缓存）</td></tr><tr><td>稳定性与降级</td><td>简单（直接回退）</td><td>需要 SSR→CSR 降级策略</td><td>更需要（流中断/异常）</td></tr></tbody></table><h3 id="_3-导出-截图-vs-服务端渲染-vs-离线渲染任务" tabindex="-1"><a class="header-anchor" href="#_3-导出-截图-vs-服务端渲染-vs-离线渲染任务" aria-hidden="true">#</a> 3）导出：截图 vs 服务端渲染 vs 离线渲染任务</h3><table><thead><tr><th>维度</th><th>客户端截图</th><th>服务端渲染导出</th><th>离线渲染任务（队列）</th></tr></thead><tbody><tr><td>一致性</td><td>中（受浏览器影响）</td><td><strong>强</strong>（同口径渲染）</td><td><strong>强</strong>（可控环境）</td></tr><tr><td>性能/稳定性</td><td>受客户端影响</td><td>中（服务端压力）</td><td><strong>高</strong>（异步、可重试）</td></tr><tr><td>权限隔离</td><td>易遗漏</td><td><strong>可严控</strong></td><td><strong>可严控</strong></td></tr><tr><td>适用场景</td><td>轻量兜底</td><td>中等规模、实时导出</td><td>大规模/耗时导出</td></tr></tbody></table><h2 id="模拟问答" tabindex="-1"><a class="header-anchor" href="#模拟问答" aria-hidden="true">#</a> 模拟问答</h2><ul><li><p>[ ] Q1：为什么低代码一定要做“物料版本治理 + schema 迁移”？不做会怎样？</p><ul><li>不做的后果：物料升级后线上配置失效、渲染报错、回滚困难。</li><li>口径：配置锁定物料版本；破坏性变更用 migration 脚本升级 schema；支持一键回滚旧物料版本。</li></ul></li><li><p>[ ] Q2：SSR 的 hydration mismatch 常见原因是什么？你怎么避免？</p><ul><li>常见原因：时间/随机数、依赖浏览器 API、服务端与客户端数据不一致、条件渲染分支不同。</li><li>避免：同构数据注水/脱水（dehydrate）、避免在 render 中引入不确定性、把浏览器专属逻辑放到 effect。</li></ul></li><li><p>[ ] Q3：流式 SSR 的收益点是什么？最大的坑是什么？怎么做降级？</p><ul><li>收益：TTFB 更早、首屏更快。</li><li>坑：错误处理/中断恢复更复杂；缓存必须按用户/权限隔离；并发下超时与资源泄露风险更高。</li><li>降级：SSR 超时/失败回退 CSR；关键模块失败只降级局部，不拖垮整页。</li></ul></li><li><p>[ ] Q4：导出怎么保证“一致性 + 权限隔离”？失败怎么兜底？</p><ul><li>一致性：导出与线上展示同一份数据与渲染口径（同一套数据加工/筛选规则）。</li><li>权限：导出任务携带用户身份与权限快照，服务端按权限过滤数据，避免越权导出。</li><li>兜底：异步任务 + 重试；必要时降级到截图或导出占位，并完整上报失败原因与版本号。</li></ul></li><li><p>[ ] Q5：高频刷新大屏为什么容易卡？你怎么治理并“可观测”？</p><ul><li>卡的根因：长任务（计算/渲染）、联动触发链过长、图表动画/数据量过大、内存增长。</li><li>治理：数据层合并/节流/降采样；渲染层局部更新/分片/虚拟化；图表降级（动画/细节）。</li><li>可观测：Long Task、FPS/掉帧、内存趋势、错误率与关键交互耗时（按大屏/组件维度打标签）。</li></ul></li></ul><h2 id="手写代码区" tabindex="-1"><a class="header-anchor" href="#手写代码区" aria-hidden="true">#</a> 手写代码区</h2><h3 id="_1-ssr-注水-脱水-避免-hydration-mismatch-的最小思路" tabindex="-1"><a class="header-anchor" href="#_1-ssr-注水-脱水-避免-hydration-mismatch-的最小思路" aria-hidden="true">#</a> 1）SSR 注水/脱水（避免 hydration mismatch 的最小思路）</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">Dehydrated</span> <span class="token operator">=</span> <span class="token punctuation">{</span> route<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> data<span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">serializeState</span><span class="token punctuation">(</span>state<span class="token operator">:</span> Dehydrated<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 真实项目：注意 XSS（转义/安全序列化）</span>\n  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">deserializeState</span><span class="token punctuation">(</span>raw<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Dehydrated <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>raw<span class="token punctuation">)</span> <span class="token keyword">as</span> Dehydrated\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-导出任务-带权限快照的最小协议-伪代码" tabindex="-1"><a class="header-anchor" href="#_2-导出任务-带权限快照的最小协议-伪代码" aria-hidden="true">#</a> 2）导出任务：带权限快照的最小协议（伪代码）</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">ExportJob</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  reportId<span class="token operator">:</span> <span class="token builtin">string</span>\n  userId<span class="token operator">:</span> <span class="token builtin">string</span>\n  permissionSnapshot<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 例如资源权限列表</span>\n  params<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">canExport</span><span class="token punctuation">(</span>job<span class="token operator">:</span> ExportJob<span class="token punctuation">,</span> requiredPerm<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> job<span class="token punctuation">.</span>permissionSnapshot<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>requiredPerm<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="我的补充-manual" tabindex="-1"><a class="header-anchor" href="#我的补充-manual" aria-hidden="true">#</a> 我的补充（Manual）</h2><p>（不会被脚本覆盖：真实约束、组织因素、踩坑）</p>',21),u={},h=(0,a(3744).Z)(u,[["render",function(s,n){const a=(0,t.up)("RouterLink");return(0,t.wg)(),(0,t.iD)(t.HY,null,[e,(0,t._)("ul",null,[(0,t._)("li",null,[l,(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/project__xdr-dashboard-report.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[r])),_:1})])])]),(0,t._)("li",null,[i,(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/tech__react.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[p])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/tech__typescript.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[o])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"/interview-prep/tech__performance.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,t.w5)((()=>[d])),_:1})])])])]),c],64)}]])}}]);