"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[8021],{6792:(t,e,l)=>{l.r(e),l.d(e,{data:()=>d});const d={key:"v-63ad3518",path:"/interview-prep/matrix__cicd-release-strategy.html",title:"CI/CD 与发布策略：门禁 / 镜像缓存 / 蓝绿&金丝雀 / 可追溯与回滚",lang:"zh-CN",frontmatter:{id:"matrix__cicd-release-strategy",type:"matrix",title:"CI/CD 与发布策略：门禁 / 镜像缓存 / 蓝绿&金丝雀 / 可追溯与回滚",mastery:"not_started",tags:["cicd","devops","docker","release","security"],projects:["project__dji-devops","project__dji-rms"],source_refs:[{source:"outline",file:"docs/job-description/web前端开发工程师-彭聪-面试技术大纲.md",anchor:"5）大疆 DevOps 平台维护：流水线 CI/CD 原理"}],updated_at:"2025-12-21T00:00:00.000Z"},excerpt:"",headers:[{level:2,title:"摘要（Auto）",slug:"摘要-auto",children:[]},{level:2,title:"建议追问（Auto）",slug:"建议追问-auto",children:[]},{level:2,title:"关联卡片",slug:"关联卡片",children:[]},{level:2,title:"在我项目中的角色与使用场景",slug:"在我项目中的角色与使用场景",children:[]},{level:2,title:"原理简述",slug:"原理简述",children:[]},{level:2,title:"对比表格",slug:"对比表格",children:[{level:3,title:"1）发布策略：蓝绿 vs 金丝雀 vs 滚动",slug:"_1-发布策略-蓝绿-vs-金丝雀-vs-滚动",children:[]},{level:3,title:"2）门禁：质量 vs 安全（常见组合）",slug:"_2-门禁-质量-vs-安全-常见组合",children:[]},{level:3,title:"3）Docker 缓存命中：写法差异",slug:"_3-docker-缓存命中-写法差异",children:[]}]},{level:2,title:"模拟问答",slug:"模拟问答",children:[]},{level:2,title:"手写代码区",slug:"手写代码区",children:[]},{level:2,title:"我的补充（Manual）",slug:"我的补充-manual",children:[]}],git:{updatedTime:1767433666e3},filePathRelative:"interview-prep/matrix__cicd-release-strategy.md"}},53:(t,e,l)=>{l.r(e),l.d(e,{default:()=>c});var d=l(6252);const i=(0,d.uE)('<h2 id="摘要-auto" tabindex="-1"><a class="header-anchor" href="#摘要-auto" aria-hidden="true">#</a> 摘要（Auto）</h2><ul><li>生成时间：2025-12-21</li><li>关注点：流水线阶段拆解、质量与安全门禁、Docker 分层与缓存命中、蓝绿/金丝雀/滚动发布、可追溯（commit→ 构建 → 镜像 → 发布）、回滚与降级</li></ul><h2 id="建议追问-auto" tabindex="-1"><a class="header-anchor" href="#建议追问-auto" aria-hidden="true">#</a> 建议追问（Auto）</h2><ul><li>如何做到“本地过/CI 不过”不会发生？门禁如何渐进收敛？</li><li>镜像为什么能缓存？Dockerfile 怎么写才命中？</li><li>灰度怎么观测？回滚怎么一键？</li></ul><h2 id="关联卡片" tabindex="-1"><a class="header-anchor" href="#关联卡片" aria-hidden="true">#</a> 关联卡片</h2>',5),r=(0,d.Uk)("项目： "),a=(0,d._)("code",null,"project__dji-devops",-1),s=(0,d._)("code",null,"project__dji-rms",-1),n=(0,d.uE)('<h2 id="在我项目中的角色与使用场景" tabindex="-1"><a class="header-anchor" href="#在我项目中的角色与使用场景" aria-hidden="true">#</a> 在我项目中的角色与使用场景</h2><ul><li>典型约束： <ul><li>多团队并行交付，发布频繁，必须保证“质量可控 + 可追溯 + 可回滚”。</li><li>构建/测试慢，CI 资源有限，需要靠缓存与增量把时延压下去。</li><li>安全与合规：需要扫描与审计（SAST/依赖漏洞/权限最小化）。</li></ul></li></ul><h2 id="原理简述" tabindex="-1"><a class="header-anchor" href="#原理简述" aria-hidden="true">#</a> 原理简述</h2><p>把 CI/CD 拆成“流水线阶段 + 产物与版本 + 发布策略 + 观测与回滚”四块：</p><ul><li><strong>流水线阶段</strong>：build → test → scan → package → deploy</li><li><strong>产物与版本</strong>： <ul><li>buildMeta（commit hash/buildId）写入产物/镜像标签</li><li>artifact 与镜像仓库统一管理，记录谁在何时发布了哪个版本到哪个环境</li></ul></li><li><strong>发布策略</strong>：蓝绿 / 金丝雀 / 滚动 + 健康检查 + 自动回滚</li><li><strong>观测与回滚</strong>：错误率/性能/关键接口耗时作为“是否继续放量”的依据；异常触发回滚或降级开关</li></ul><h2 id="对比表格" tabindex="-1"><a class="header-anchor" href="#对比表格" aria-hidden="true">#</a> 对比表格</h2><h3 id="_1-发布策略-蓝绿-vs-金丝雀-vs-滚动" tabindex="-1"><a class="header-anchor" href="#_1-发布策略-蓝绿-vs-金丝雀-vs-滚动" aria-hidden="true">#</a> 1）发布策略：蓝绿 vs 金丝雀 vs 滚动</h3><table><thead><tr><th>维度</th><th>蓝绿（Blue/Green）</th><th>金丝雀（Canary）</th><th>滚动（Rolling）</th></tr></thead><tbody><tr><td>风险控制</td><td><strong>强</strong>（切流即可回退）</td><td><strong>强</strong>（小流量观测）</td><td>中（逐批替换）</td></tr><tr><td>资源成本</td><td>高（两套环境）</td><td>中</td><td>低</td></tr><tr><td>复杂度</td><td>中</td><td>高（观测/放量）</td><td>中</td></tr><tr><td>适用场景</td><td>关键系统、回滚必须快</td><td>频繁发布、需要观测</td><td>资源紧张、常规服务</td></tr></tbody></table><h3 id="_2-门禁-质量-vs-安全-常见组合" tabindex="-1"><a class="header-anchor" href="#_2-门禁-质量-vs-安全-常见组合" aria-hidden="true">#</a> 2）门禁：质量 vs 安全（常见组合）</h3><table><thead><tr><th>门禁项</th><th>目的</th><th>典型落地</th></tr></thead><tbody><tr><td>lint/typecheck</td><td>代码质量/类型安全</td><td>PR 阶段必跑，<code>max-warnings=0</code> 渐进收敛</td></tr><tr><td>unit test</td><td>回归保护</td><td>关键模块必跑，按风险设覆盖率阈值</td></tr><tr><td>SAST</td><td>代码安全</td><td>高危必阻断，中低危输出清单</td></tr><tr><td>deps scan</td><td>依赖漏洞</td><td>高危阻断，提供升级建议与豁免期限</td></tr></tbody></table><h3 id="_3-docker-缓存命中-写法差异" tabindex="-1"><a class="header-anchor" href="#_3-docker-缓存命中-写法差异" aria-hidden="true">#</a> 3）Docker 缓存命中：写法差异</h3><table><thead><tr><th>写法</th><th>缓存命中</th><th>说明</th></tr></thead><tbody><tr><td>先复制 lockfile 再装依赖，最后复制源码</td><td><strong>高</strong></td><td>业务代码变动不影响依赖层</td></tr><tr><td>先复制全部源码再装依赖</td><td>低</td><td>任何改动都让依赖层失效</td></tr></tbody></table><h2 id="模拟问答" tabindex="-1"><a class="header-anchor" href="#模拟问答" aria-hidden="true">#</a> 模拟问答</h2><ul><li><p>[ ] Q1：你怎么保证“可追溯”（commit→ 构建 → 镜像 → 发布）？</p><ul><li>buildMeta：commit hash/buildId 写进镜像 tag 与应用内版本信息。</li><li>发布记录：记录发布人/时间/环境/版本/变更单，支持一键回滚到上一稳定版本。</li></ul></li><li><p>[ ] Q2：Docker 分层缓存为什么能提速？Dockerfile 怎么写才命中？</p><ul><li>原理：层（layer）复用；依赖层稳定就能命中缓存。</li><li>写法：先复制 <code>package.json</code>/lockfile 安装依赖，再复制业务代码；配合 CI 缓存 pnpm/yarn store。</li></ul></li><li><p>[ ] Q3：质量门禁怎么做“渐进收敛”而不是一刀切？</p><ul><li>新代码强制：只对改动文件/目录严格（<code>lint-staged</code> + PR gate）。</li><li>存量治理：豁免清单 + 期限 + 趋势看板，逐步把 warning 清零再升为 error。</li></ul></li><li><p>[ ] Q4：金丝雀怎么观测？用哪些指标决定继续放量还是回滚？</p><ul><li>指标：错误率、核心接口耗时、关键页面 Web Vitals（LCP/INP/CLS）、业务转化指标（按场景）。</li><li>策略：分阶段放量（1%→5%→20%→100%），每阶段设阈值与观察窗口；异常自动停止并回滚。</li></ul></li><li><p>[ ] Q5：配置与密钥怎么治理？怎么避免“错配导致事故”？</p><ul><li>分离：代码配置 vs 环境配置（env/secret）分离；按环境/按服务最小权限。</li><li>校验：发布前校验必填变量/格式；审批流 + 审计；异常快速回滚与熔断。</li></ul></li></ul><h2 id="手写代码区" tabindex="-1"><a class="header-anchor" href="#手写代码区" aria-hidden="true">#</a> 手写代码区</h2><p>一个“buildMeta 注入”的最小思路（伪代码）：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1) CI 读取当前 commit hash → 生成 BUILD_ID\n2) 构建时写入环境变量：BUILD_ID、GIT_SHA\n3) 应用启动时暴露 /version：返回 BUILD_ID、GIT_SHA\n4) 日志/错误上报都带 BUILD_ID，保证可追溯\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="我的补充-manual" tabindex="-1"><a class="header-anchor" href="#我的补充-manual" aria-hidden="true">#</a> 我的补充（Manual）</h2><p>（不会被脚本覆盖：真实约束、组织因素、踩坑）</p>',19),h={},c=(0,l(3744).Z)(h,[["render",function(t,e){const l=(0,d.up)("RouterLink");return(0,d.wg)(),(0,d.iD)(d.HY,null,[i,(0,d._)("ul",null,[(0,d._)("li",null,[r,(0,d._)("ul",null,[(0,d._)("li",null,[(0,d.Wm)(l,{to:"/interview-prep/project__dji-devops.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,d.w5)((()=>[a])),_:1})]),(0,d._)("li",null,[(0,d.Wm)(l,{to:"/interview-prep/project__dji-rms.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,d.w5)((()=>[s])),_:1})])])])]),n],64)}]])},3744:(t,e)=>{e.Z=(t,e)=>{const l=t.__vccOpts||t;for(const[t,d]of e)l[t]=d;return l}}}]);