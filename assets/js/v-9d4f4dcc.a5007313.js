"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[4166],{4071:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-9d4f4dcc",path:"/vue/vue-render.html",title:"Vue çš„æ¸²æŸ“æµç¨‹",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"ğŸŒŸ ä¸€å¥è¯æ¦‚æ‹¬ Vue æ¸²æŸ“æµç¨‹ï¼š",slug:"ğŸŒŸ-ä¸€å¥è¯æ¦‚æ‹¬-vue-æ¸²æŸ“æµç¨‹",children:[]},{level:2,title:"ä¸€ã€æ•´ä½“æ¶æ„å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰",slug:"ä¸€ã€æ•´ä½“æ¶æ„å›¾-æ–‡å­—ç‰ˆ",children:[]},{level:2,title:"äºŒã€è¯¦ç»†åˆ†æ­¥è®²è§£",slug:"äºŒã€è¯¦ç»†åˆ†æ­¥è®²è§£",children:[{level:3,title:"1ï¸âƒ£ ç¬¬ä¸€æ­¥ï¼šæ¨¡æ¿ç¼–è¯‘ï¼ˆCompileï¼‰",slug:"_1ï¸âƒ£-ç¬¬ä¸€æ­¥-æ¨¡æ¿ç¼–è¯‘-compile",children:[]},{level:3,title:"2ï¸âƒ£ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç»„ä»¶å®ä¾‹ & å“åº”å¼ç³»ç»Ÿ",slug:"_2ï¸âƒ£-ç¬¬äºŒæ­¥-åˆ›å»ºç»„ä»¶å®ä¾‹-å“åº”å¼ç³»ç»Ÿ",children:[]},{level:3,title:"3ï¸âƒ£ ç¬¬ä¸‰æ­¥ï¼šåˆæ¬¡æ¸²æŸ“ï¼ˆMountï¼‰",slug:"_3ï¸âƒ£-ç¬¬ä¸‰æ­¥-åˆæ¬¡æ¸²æŸ“-mount",children:[]},{level:3,title:"4ï¸âƒ£ ç¬¬å››æ­¥ï¼šå“åº”å¼æ›´æ–°ï¼ˆReactivity â†’ Render â†’ Patchï¼‰",slug:"_4ï¸âƒ£-ç¬¬å››æ­¥-å“åº”å¼æ›´æ–°-reactivity-â†’-render-â†’-patch",children:[]}]},{level:2,title:"ä¸‰ã€Vue vs React Fiber å…³é”®å·®å¼‚",slug:"ä¸‰ã€vue-vs-react-fiber-å…³é”®å·®å¼‚",children:[]},{level:2,title:"å››ã€å…³é”®æºç æ–‡ä»¶é€ŸæŸ¥ï¼ˆVue 3ï¼‰",slug:"å››ã€å…³é”®æºç æ–‡ä»¶é€ŸæŸ¥-vue-3",children:[]},{level:2,title:"äº”ã€ä¸¾ä¸ªä½ ç†Ÿæ‚‰çš„ä¾‹å­ï¼šåŠ¨æ€è¡¨å•",slug:"äº”ã€ä¸¾ä¸ªä½ ç†Ÿæ‚‰çš„ä¾‹å­-åŠ¨æ€è¡¨å•",children:[]},{level:2,title:"âœ… æ€»ç»“",slug:"âœ…-æ€»ç»“",children:[]}],git:{updatedTime:1768675436e3},filePathRelative:"vue/vue-render.md"}},4430:(n,s,a)=>{a.r(s),a.d(s,{default:()=>p});const e=(0,a(6252).uE)('<h1 id="vue-çš„æ¸²æŸ“æµç¨‹" tabindex="-1"><a class="header-anchor" href="#vue-çš„æ¸²æŸ“æµç¨‹" aria-hidden="true">#</a> Vue çš„æ¸²æŸ“æµç¨‹</h1><p>ç†è§£ <strong>Vue çš„æ¸²æŸ“æµç¨‹</strong>èƒ½å¸®ä½ æ¨ªå‘å¯¹æ¯”ä¸¤å¤§æ¡†æ¶çš„è®¾è®¡å“²å­¦ã€‚Vueï¼ˆç‰¹åˆ«æ˜¯ Vue 3ï¼‰çš„å“åº”å¼ + æ¸²æŸ“æœºåˆ¶éå¸¸ç²¾å·§ï¼Œä¸”ä¸ React çš„â€œè°ƒåº¦ä¼˜å…ˆâ€ä¸åŒï¼Œå®ƒæ›´åå‘ <strong>â€œä¾èµ–æ”¶é›† + ç²¾å‡†æ›´æ–°â€</strong>ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šä» <strong>Vue 3 æºç è§’åº¦</strong>ï¼Œç³»ç»Ÿè®²è§£ <strong>ä»æ¨¡æ¿ï¼ˆtemplateï¼‰åˆ°çœŸå® DOM çš„å®Œæ•´æ¸²æŸ“æµç¨‹</strong>ï¼ŒåŒ…æ‹¬å“åº”å¼ã€ç¼–è¯‘ã€è™šæ‹Ÿ DOMã€patch ç­‰æ ¸å¿ƒç¯èŠ‚ã€‚</p><blockquote><p>âœ… é€‚ç”¨äºï¼šä½¿ç”¨ Vue 3ï¼ˆComposition API + <code>&lt;script setup&gt;</code>ï¼‰çš„å¼€å‘è€…<br> ğŸ” æºç åŸºäºï¼š<code>vue@3.4+</code>ï¼ˆåŸºäº <code>packages/runtime-core</code> å’Œ <code>packages/compiler-core</code>ï¼‰</p></blockquote><hr><h2 id="ğŸŒŸ-ä¸€å¥è¯æ¦‚æ‹¬-vue-æ¸²æŸ“æµç¨‹" tabindex="-1"><a class="header-anchor" href="#ğŸŒŸ-ä¸€å¥è¯æ¦‚æ‹¬-vue-æ¸²æŸ“æµç¨‹" aria-hidden="true">#</a> ğŸŒŸ ä¸€å¥è¯æ¦‚æ‹¬ Vue æ¸²æŸ“æµç¨‹ï¼š</h2><blockquote><p><strong>æ¨¡æ¿ â†’ ç¼–è¯‘æˆ render å‡½æ•° â†’ æ‰§è¡Œ render ç”Ÿæˆ VNode â†’ patch VNode åˆ°çœŸå® DOM â†’ å“åº”å¼ä¾èµ–æ”¶é›† â†’ æ•°æ®å˜åŒ–æ—¶ç²¾å‡†æ›´æ–°</strong></p></blockquote><p>æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤å¤§é˜¶æ®µï¼š<strong>åˆæ¬¡æ¸²æŸ“ï¼ˆmountï¼‰</strong> å’Œ <strong>æ›´æ–°æ¸²æŸ“ï¼ˆupdateï¼‰</strong>ã€‚</p><hr><h2 id="ä¸€ã€æ•´ä½“æ¶æ„å›¾-æ–‡å­—ç‰ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ•´ä½“æ¶æ„å›¾-æ–‡å­—ç‰ˆ" aria-hidden="true">#</a> ä¸€ã€æ•´ä½“æ¶æ„å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[template / JSX]\n       â†“\n[æ¨¡æ¿ç¼–è¯‘å™¨ï¼ˆcompiler-coreï¼‰]\n       â†“\nç”Ÿæˆ render å‡½æ•°ï¼ˆè¿”å› VNode æ ‘ï¼‰\n       â†“\n[å“åº”å¼ç³»ç»Ÿï¼ˆreactivityï¼‰]\n       â†“\næ‰§è¡Œ render â†’ è§¦å‘ä¾èµ–æ”¶é›†ï¼ˆtrackï¼‰\n       â†“\nè°ƒç”¨ render å‡½æ•° â†’ å¾—åˆ° VNode\n       â†“\n[æ¸²æŸ“å™¨ï¼ˆrendererï¼‰]\n       â†“\npatch(oldVNode, newVNode) â†’ è°ƒç”¨ mount/patch\n       â†“\nåˆ›å»º/æ›´æ–°çœŸå® DOMï¼ˆhostCreateElement ç­‰ï¼‰\n       â†“\n[å®Œæˆæ¸²æŸ“]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>å½“æ•°æ®å˜åŒ–ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[å“åº”å¼æ•°æ® setter]\n       â†“\ntrigger â†’ é€šçŸ¥ effectï¼ˆå³ç»„ä»¶çš„ render å‡½æ•°ï¼‰\n       â†“\né‡æ–°æ‰§è¡Œ render â†’ æ–° VNode\n       â†“\npatch(oldVNode, newVNode) â†’ åªæ›´æ–°å·®å¼‚éƒ¨åˆ†\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h2 id="äºŒã€è¯¦ç»†åˆ†æ­¥è®²è§£" tabindex="-1"><a class="header-anchor" href="#äºŒã€è¯¦ç»†åˆ†æ­¥è®²è§£" aria-hidden="true">#</a> äºŒã€è¯¦ç»†åˆ†æ­¥è®²è§£</h2><h3 id="_1ï¸âƒ£-ç¬¬ä¸€æ­¥-æ¨¡æ¿ç¼–è¯‘-compile" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-ç¬¬ä¸€æ­¥-æ¨¡æ¿ç¼–è¯‘-compile" aria-hidden="true">#</a> 1ï¸âƒ£ ç¬¬ä¸€æ­¥ï¼šæ¨¡æ¿ç¼–è¯‘ï¼ˆCompileï¼‰</h3><blockquote><p>âš ï¸ ä»… SFCï¼ˆ.vue æ–‡ä»¶ï¼‰æˆ–ä½¿ç”¨ <code>template</code> é€‰é¡¹æ—¶å‘ç”Ÿï¼›JSX æˆ–æ‰‹å†™ render å‡½æ•°å¯è·³è¿‡ã€‚</p></blockquote><p><strong>æºç ä½ç½®</strong>ï¼š<code>packages/compiler-core</code></p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>â†’ ç¼–è¯‘åï¼ˆç®€åŒ–ï¼‰ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\n      <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n        <span class="token string-property property">&#39;onUpdate:modelValue&#39;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">$event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name <span class="token operator">=</span> $event<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>å…³é”®å‡½æ•°</strong>ï¼š</p><ul><li><code>compile(template)</code> â†’ ç”Ÿæˆ AST â†’ ä¼˜åŒ–ï¼ˆé™æ€æå‡ã€ç¼“å­˜ï¼‰â†’ ç”Ÿæˆ render å‡½æ•°å­—ç¬¦ä¸²</li><li><code>generate(ast)</code> â†’ è¾“å‡ºå¯æ‰§è¡Œçš„ render å‡½æ•°</li></ul><blockquote><p>âœ… Vue çš„ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼ˆå¦‚é™æ€èŠ‚ç‚¹æå‡ã€äº‹ä»¶ç¼“å­˜ï¼‰è®©è¿è¡Œæ—¶æ›´è½»é‡ã€‚</p></blockquote><hr><h3 id="_2ï¸âƒ£-ç¬¬äºŒæ­¥-åˆ›å»ºç»„ä»¶å®ä¾‹-å“åº”å¼ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-ç¬¬äºŒæ­¥-åˆ›å»ºç»„ä»¶å®ä¾‹-å“åº”å¼ç³»ç»Ÿ" aria-hidden="true">#</a> 2ï¸âƒ£ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç»„ä»¶å®ä¾‹ &amp; å“åº”å¼ç³»ç»Ÿ</h3><p><strong>æºç ä½ç½®</strong>ï¼š<code>packages/reactivity</code> + <code>packages/runtime-core/src/component.ts</code></p><p>å½“ä½ è°ƒç”¨ <code>createApp(App).mount(&#39;#app&#39;)</code>ï¼š</p><ol><li><p><strong>åˆ›å»ºæ ¹ç»„ä»¶å®ä¾‹ï¼ˆcomponent instanceï¼‰</strong></p><ul><li>åŒ…å« <code>setupState</code>ï¼ˆæ¥è‡ª <code>setup()</code> çš„è¿”å›å€¼ï¼‰</li><li><code>props</code>ã€<code>slots</code>ã€<code>refs</code> ç­‰</li></ul></li><li><p><strong>å¯¹æ•°æ®åšå“åº”å¼å¤„ç†</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// setup() ä¸­</span>\n<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;cpeng&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>ref</code> â†’ åŒ…è£…æˆ <code>{ value: ... }</code> + getter/setter æ”¶é›†ä¾èµ–</li><li><code>reactive</code> â†’ ç”¨ <code>Proxy</code> æ‹¦æˆª get/set</li></ul></li><li><p><strong>å…³é”®ï¼šeffectï¼ˆå‰¯ä½œç”¨ï¼‰</strong></p><ul><li>ç»„ä»¶çš„ <strong>render å‡½æ•°è¢«åŒ…è£¹åœ¨ effect ä¸­</strong></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  instance<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å³é‡æ–°æ‰§è¡Œ render</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><hr><h3 id="_3ï¸âƒ£-ç¬¬ä¸‰æ­¥-åˆæ¬¡æ¸²æŸ“-mount" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-ç¬¬ä¸‰æ­¥-åˆæ¬¡æ¸²æŸ“-mount" aria-hidden="true">#</a> 3ï¸âƒ£ ç¬¬ä¸‰æ­¥ï¼šåˆæ¬¡æ¸²æŸ“ï¼ˆMountï¼‰</h3><p><strong>æºç ä½ç½®</strong>ï¼š<code>packages/runtime-core/src/renderer.ts</code></p><h4 id="_3-1-è°ƒç”¨-render-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-1-è°ƒç”¨-render-å‡½æ•°" aria-hidden="true">#</a> 3.1 è°ƒç”¨ render å‡½æ•°</h4><ul><li>æ‰§è¡Œ <code>render()</code> â†’ è¿”å› VNode æ ‘ï¼ˆè™šæ‹Ÿ DOMï¼‰</li><li><strong>æ­¤æ—¶è§¦å‘ä¾èµ–æ”¶é›†ï¼ˆtrackï¼‰</strong>ï¼š <ul><li>è®¿é—® <code>title</code> â†’ è®°å½•ï¼šâ€œè¿™ä¸ª render å‡½æ•°ä¾èµ– titleâ€</li><li>è®¿é—® <code>name</code> â†’ è®°å½•ï¼šâ€œè¿™ä¸ª render å‡½æ•°ä¾èµ– nameâ€</li></ul></li></ul><h4 id="_3-2-è°ƒç”¨-patch-åˆæ¬¡ä¸º-mount" tabindex="-1"><a class="header-anchor" href="#_3-2-è°ƒç”¨-patch-åˆæ¬¡ä¸º-mount" aria-hidden="true">#</a> 3.2 è°ƒç”¨ patchï¼ˆåˆæ¬¡ä¸º mountï¼‰</h4><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>å› ä¸º oldVNode ä¸º <code>null</code>ï¼Œèµ° <code>mountElement</code> åˆ†æ”¯</li></ul><h4 id="_3-3-åˆ›å»ºçœŸå®-dom" tabindex="-1"><a class="header-anchor" href="#_3-3-åˆ›å»ºçœŸå®-dom" aria-hidden="true">#</a> 3.3 åˆ›å»ºçœŸå® DOM</h4><ul><li>è°ƒç”¨ <code>hostCreateElement(&#39;div&#39;)</code>ï¼ˆå¹³å°ç›¸å…³ï¼Œæµè§ˆå™¨ä¸­å°±æ˜¯ <code>document.createElement</code>ï¼‰</li><li>é€’å½’æŒ‚è½½å­èŠ‚ç‚¹</li><li>è®¾ç½®æ–‡æœ¬å†…å®¹ã€å±æ€§ã€äº‹ä»¶ç›‘å¬å™¨</li></ul><blockquote><p>ğŸ’¡ Vue çš„ VNode ç»“æ„ï¼ˆç®€åŒ–ï¼‰ï¼š</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>\n  type<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> Component <span class="token comment">// &#39;div&#39; æˆ– MyComponent</span>\n  props<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span>\n  children<span class="token operator">:</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span>\n  el<span class="token operator">:</span> Element <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token comment">// çœŸå® DOM å¼•ç”¨ï¼ˆmount åèµ‹å€¼ï¼‰</span>\n  shapeFlag<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token comment">// æ ‡è®°ç±»å‹ï¼ˆæ–‡æœ¬ï¼Ÿç»„ä»¶ï¼Ÿï¼‰</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></blockquote><hr><h3 id="_4ï¸âƒ£-ç¬¬å››æ­¥-å“åº”å¼æ›´æ–°-reactivity-â†’-render-â†’-patch" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-ç¬¬å››æ­¥-å“åº”å¼æ›´æ–°-reactivity-â†’-render-â†’-patch" aria-hidden="true">#</a> 4ï¸âƒ£ ç¬¬å››æ­¥ï¼šå“åº”å¼æ›´æ–°ï¼ˆReactivity â†’ Render â†’ Patchï¼‰</h3><p>å½“ä½ ä¿®æ”¹æ•°æ®ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;new name&#39;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_4-1-è§¦å‘-setter-reactivity" tabindex="-1"><a class="header-anchor" href="#_4-1-è§¦å‘-setter-reactivity" aria-hidden="true">#</a> 4.1 è§¦å‘ setterï¼ˆreactivityï¼‰</h4><ul><li><code>ref</code> çš„ setter è¢«è°ƒç”¨ â†’ è°ƒç”¨ <code>trigger(target, &#39;set&#39;, key)</code></li><li>æ‰¾åˆ°æ‰€æœ‰ä¾èµ–è¿™ä¸ª <code>name</code> çš„ <strong>effect</strong>ï¼ˆå³ç»„ä»¶çš„ render å‡½æ•°ï¼‰</li></ul><h4 id="_4-2-è°ƒåº¦æ›´æ–°-scheduler" tabindex="-1"><a class="header-anchor" href="#_4-2-è°ƒåº¦æ›´æ–°-scheduler" aria-hidden="true">#</a> 4.2 è°ƒåº¦æ›´æ–°ï¼ˆschedulerï¼‰</h4><ul><li>Vue é»˜è®¤ä½¿ç”¨ <strong>å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—</strong>ï¼ˆç±»ä¼¼ React çš„ setState æ‰¹å¤„ç†ï¼‰</li><li>å°† <code>instance.update</code> æ”¾å…¥ <code>queueJob</code></li><li>ä¸‹ä¸€ tickï¼ˆ<code>Promise.resolve().then</code>ï¼‰æ‰¹é‡æ‰§è¡Œ</li></ul><blockquote><p>âœ… ä¼˜åŠ¿ï¼šå¤šæ¬¡ä¿®æ”¹åªè§¦å‘ä¸€æ¬¡ render</p></blockquote><h4 id="_4-3-é‡æ–°-render-patch" tabindex="-1"><a class="header-anchor" href="#_4-3-é‡æ–°-render-patch" aria-hidden="true">#</a> 4.3 é‡æ–° render + patch</h4><ul><li>å†æ¬¡æ‰§è¡Œ render â†’ æ–° VNode</li><li>è°ƒç”¨ <code>patch(oldVNode, newVNode, ...)</code></li><li>è¿›å…¥ <strong>diff ç®—æ³•</strong>ï¼ˆVue çš„ diff æ˜¯â€œåŒå±‚æ¯”è¾ƒ + key ä¼˜åŒ–â€ï¼‰</li></ul><h5 id="vue-çš„-patch-æ ¸å¿ƒé€»è¾‘" tabindex="-1"><a class="header-anchor" href="#vue-çš„-patch-æ ¸å¿ƒé€»è¾‘" aria-hidden="true">#</a> Vue çš„ patch æ ¸å¿ƒé€»è¾‘ï¼š</h5><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>type <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ç±»å‹ç›¸åŒ â†’ æ›´æ–°</span>\n  <span class="token function">patchElement</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">)</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ç±»å‹ä¸åŒ â†’ å¸è½½æ—§èŠ‚ç‚¹ï¼ŒæŒ‚è½½æ–°èŠ‚ç‚¹</span>\n  <span class="token function">unmount</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">)</span>\n  <span class="token function">mount</span><span class="token punctuation">(</span>newVNode<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="å¯¹äºæ–‡æœ¬èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#å¯¹äºæ–‡æœ¬èŠ‚ç‚¹" aria-hidden="true">#</a> å¯¹äºæ–‡æœ¬èŠ‚ç‚¹ï¼š</h5><ul><li>ç›´æ¥ <code>textContent = newVNode.children</code></li></ul><h5 id="å¯¹äºå…ƒç´ èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#å¯¹äºå…ƒç´ èŠ‚ç‚¹" aria-hidden="true">#</a> å¯¹äºå…ƒç´ èŠ‚ç‚¹ï¼š</h5><ul><li>æ›´æ–° propsï¼ˆclass/style/äº‹ä»¶ç­‰ï¼‰</li><li>é€’å½’ patch children</li></ul><h5 id="å¯¹äºç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#å¯¹äºç»„ä»¶" aria-hidden="true">#</a> å¯¹äºç»„ä»¶ï¼š</h5><ul><li>è°ƒç”¨å­ç»„ä»¶çš„ renderï¼Œé€’å½’æ•´ä¸ªæµç¨‹</li></ul><hr><h2 id="ä¸‰ã€vue-vs-react-fiber-å…³é”®å·®å¼‚" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€vue-vs-react-fiber-å…³é”®å·®å¼‚" aria-hidden="true">#</a> ä¸‰ã€Vue vs React Fiber å…³é”®å·®å¼‚</h2><table><thead><tr><th>ç»´åº¦</th><th>Vue 3</th><th>React Fiber</th></tr></thead><tbody><tr><td><strong>æ›´æ–°é©±åŠ¨</strong></td><td>å“åº”å¼ä¾èµ–ï¼ˆç²¾å‡†çŸ¥é“è°å˜äº†ï¼‰</td><td>è°ƒåº¦ + ä¼˜å…ˆçº§ï¼ˆä¸çŸ¥é“å…·ä½“å“ªå˜ï¼Œéœ€é‡æ–° renderï¼‰</td></tr><tr><td><strong>æ¸²æŸ“ä¸­æ–­</strong></td><td>âŒ ä¸å¯ä¸­æ–­ï¼ˆæ›´æ–°æ˜¯åŒæ­¥çš„ï¼Œä½†å¼‚æ­¥è°ƒåº¦ï¼‰</td><td>âœ… å¯ä¸­æ–­ï¼ˆFiber + Schedulerï¼‰</td></tr><tr><td><strong>ç¼–è¯‘ä¼˜åŒ–</strong></td><td>âœ… ç¼–è¯‘æ—¶åšå¤§é‡ä¼˜åŒ–ï¼ˆé™æ€æå‡ã€äº‹ä»¶ç¼“å­˜ï¼‰</td><td>âŒ ä¸»è¦é è¿è¡Œæ—¶ï¼ˆReact Compiler åœ¨å®éªŒä¸­ï¼‰</td></tr><tr><td><strong>VNode ç”Ÿæˆ</strong></td><td>ç¼–è¯‘æ—¶ç”Ÿæˆ render å‡½æ•°</td><td>è¿è¡Œæ—¶æ¯æ¬¡ render() è°ƒç”¨ç”Ÿæˆ</td></tr><tr><td><strong>æ€§èƒ½æ¨¡å‹</strong></td><td>â€œè°å˜äº†å°±æ›´æ–°è°â€</td><td>â€œé‡æ–° render + diff æ‰¾å·®å¼‚â€</td></tr></tbody></table><blockquote><p>ğŸ’¡ Vue æ›´åƒâ€œç²¾å‡†å¤–ç§‘æ‰‹æœ¯â€ï¼ŒReact æ›´åƒâ€œå…¨é‡æ‰«æ + æ™ºèƒ½è°ƒåº¦â€ã€‚</p></blockquote><hr><h2 id="å››ã€å…³é”®æºç æ–‡ä»¶é€ŸæŸ¥-vue-3" tabindex="-1"><a class="header-anchor" href="#å››ã€å…³é”®æºç æ–‡ä»¶é€ŸæŸ¥-vue-3" aria-hidden="true">#</a> å››ã€å…³é”®æºç æ–‡ä»¶é€ŸæŸ¥ï¼ˆVue 3ï¼‰</h2><table><thead><tr><th>åŠŸèƒ½</th><th>æºç è·¯å¾„</th></tr></thead><tbody><tr><td>å“åº”å¼ç³»ç»Ÿ</td><td><code>packages/reactivity/src/</code></td></tr><tr><td>æ¸²æŸ“å™¨æ ¸å¿ƒ</td><td><code>packages/runtime-core/src/renderer.ts</code></td></tr><tr><td>VNode å¤„ç†</td><td><code>packages/runtime-core/src/vnode.ts</code></td></tr><tr><td>ç»„ä»¶å®ä¾‹</td><td><code>packages/runtime-core/src/component.ts</code></td></tr><tr><td>æ¨¡æ¿ç¼–è¯‘</td><td><code>packages/compiler-core/src/</code></td></tr><tr><td>patch ç®—æ³•</td><td><code>renderer.ts</code> ä¸­çš„ <code>patch</code>, <code>processElement</code>, <code>patchChildren</code></td></tr></tbody></table><hr><h2 id="äº”ã€ä¸¾ä¸ªä½ ç†Ÿæ‚‰çš„ä¾‹å­-åŠ¨æ€è¡¨å•" tabindex="-1"><a class="header-anchor" href="#äº”ã€ä¸¾ä¸ªä½ ç†Ÿæ‚‰çš„ä¾‹å­-åŠ¨æ€è¡¨å•" aria-hidden="true">#</a> äº”ã€ä¸¾ä¸ªä½ ç†Ÿæ‚‰çš„ä¾‹å­ï¼šåŠ¨æ€è¡¨å•</h2><p>ä½ åœ¨ Vue ä¸­å†™ï¼š</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Form</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FormItem</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>f in fields<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>f.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>f.type<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li><code>fields</code> æ˜¯ <code>ref([])</code></li><li>ç¼–è¯‘å render å‡½æ•°ä¼šè®¿é—® <code>fields.value</code></li><li>é¦–æ¬¡ render â†’ <code>track(fields, &#39;get&#39;, &#39;value&#39;)</code></li><li>å½“ <code>fields.value.push(...)</code> â†’ <code>trigger</code> â†’ é‡æ–° render</li><li>patch æ—¶ï¼š <ul><li>æ¯”è¾ƒæ–°æ—§ <code>fields</code> åˆ—è¡¨</li><li>åˆ©ç”¨ <code>key</code> åšé«˜æ•ˆ diffï¼ˆç§»åŠ¨/æ–°å¢/åˆ é™¤ï¼‰</li><li>åªæ›´æ–°å˜åŒ–çš„ <code>&lt;FormItem&gt;</code></li></ul></li></ol><blockquote><p>âœ… å› ä¸º Vue çŸ¥é“ <strong>æ˜¯ <code>fields</code> å˜äº†</strong>ï¼Œæ‰€ä»¥åªé‡æ–° render è¿™ä¸ªç»„ä»¶ï¼ˆæˆ–å­æ ‘ï¼‰ï¼Œä¸åƒ React é»˜è®¤ä¼šä»æ ¹å¼€å§‹ renderï¼ˆé™¤é memoï¼‰ã€‚</p></blockquote><hr><h2 id="âœ…-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#âœ…-æ€»ç»“" aria-hidden="true">#</a> âœ… æ€»ç»“</h2><p>Vue çš„æ¸²æŸ“æµç¨‹ = <strong>ç¼–è¯‘ + å“åº”å¼ + VNode + patch</strong>ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼š</p><ol><li><strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong> â†’ è¿è¡Œæ—¶æ›´è½»</li><li><strong>ä¾èµ–æ”¶é›†</strong> â†’ æ›´æ–°æ›´ç²¾å‡†</li><li><strong>å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—</strong> â†’ é¿å…é‡å¤ render</li></ol><p>è€Œ React Fiber çš„ä¼˜åŠ¿åœ¨äº <strong>å¯ä¸­æ–­è°ƒåº¦ + å¹¶å‘èƒ½åŠ›</strong>ï¼Œé€‚åˆå¤æ‚äº¤äº’åœºæ™¯ã€‚</p><hr><p>å¦‚æœä½ æƒ³ï¼Œæˆ‘å¯ä»¥ï¼š</p><ul><li>ç”»ä¸€å¼  <strong>Vue å“åº”å¼ + æ¸²æŸ“çš„åä½œå›¾</strong></li><li>å¯¹æ¯” <strong>Vue å’Œ React åœ¨ä½ çš„ â€œmy-ticket-agentâ€ è¡¨å•åœºæ™¯ä¸‹çš„æ›´æ–°è¡Œä¸º</strong></li><li>æˆ–è€…æ·±å…¥è®²è§£ <strong>Vue çš„ patchChildren diff ç®—æ³•ï¼ˆå¸¦ key vs ä¸å¸¦ keyï¼‰</strong></li></ul>',80),t={},p=(0,a(3744).Z)(t,[["render",function(n,s){return e}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);