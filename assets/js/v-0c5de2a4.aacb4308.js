"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[8017],{4358:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-0c5de2a4",path:"/interview-prep/tech__rollup.html",title:"Rollup（库构建与 tree-shaking）",lang:"zh-CN",frontmatter:{id:"tech__rollup",type:"tech",title:"Rollup（库构建与 tree-shaking）",mastery:"not_started",tags:["rollup","bundler","tree-shaking"],projects:["project__announce-plugin"],source_refs:[{source:"resume",file:"docs/job-description/web前端开发工程师-彭聪.md",anchor:"TODO"}],seed_refs:[{source:"outline",file:"docs/job-description/web前端开发工程师-彭聪-面试技术大纲.md",anchor:"TODO"}],updated_at:"2025-12-20T00:00:00.000Z"},excerpt:"",headers:[{level:2,title:"摘要（Auto）",slug:"摘要-auto",children:[]},{level:2,title:"建议追问（Auto）",slug:"建议追问-auto",children:[]},{level:2,title:"关联卡片",slug:"关联卡片",children:[]},{level:2,title:"在我项目中的角色与使用场景",slug:"在我项目中的角色与使用场景",children:[]},{level:2,title:"原理简述",slug:"原理简述",children:[]},{level:2,title:"对比表格",slug:"对比表格",children:[]},{level:2,title:"模拟问答",slug:"模拟问答",children:[]},{level:2,title:"手写代码区",slug:"手写代码区",children:[]},{level:2,title:"我的补充（Manual）",slug:"我的补充-manual",children:[]},{level:2,title:"复盘与反思（Learnings）",slug:"复盘与反思-learnings",children:[]},{level:2,title:"面试官追问（面试官视角）",slug:"面试官追问-面试官视角",children:[]}],git:{updatedTime:1768747638e3},filePathRelative:"interview-prep/tech__rollup.md"}},3858:(n,s,a)=>{a.r(s),a.d(s,{default:()=>u});var e=a(6252);const t=(0,e.uE)('<h2 id="摘要-auto" tabindex="-1"><a class="header-anchor" href="#摘要-auto" aria-hidden="true">#</a> 摘要（Auto）</h2><ul><li>生成时间：2025-12-20</li><li>简历中出现的项目标题（提取）：大疆用户中心重构 / 大疆售后 RMS 系统重构 / 跨平台公告插件系统 / 大疆 DevOps 平台维护 / XDR 系统 - 魔方大屏 + 报表</li><li>面试大纲关键词（提取 Top10）：1）大疆用户中心重构：性能优化 + HTTP 原理 + Webpack 架构 / 性能指标与方法论 / 简历可落地点（结合你的“优化四板斧”） / HTTP 常考点（从“为什么变快”倒推） / Webpack 架构（工程化面试常考） / 按优化顺序，把方案“串起来”（排查 → 定位 → 选择 → 验证） / 0. 排查与基线（先把问题“量化”） / 1. 先保“可见”——骨架屏预渲染（直接拉低 LCP） / 2. 再减“阻塞”——关键渲染路径（CRP）梳理：CSS/字体/首图优先级 / 3. 再降“下载与解析成本”——更小的包体与更少的无效代码</li></ul><h2 id="建议追问-auto" tabindex="-1"><a class="header-anchor" href="#建议追问-auto" aria-hidden="true">#</a> 建议追问（Auto）</h2><ul><li>你为什么在该项目/场景里选择这个方案？替代方案为何不选？</li><li>最大一次事故/踩坑是什么？如何定位与回滚？</li><li>如果重做：架构/边界/工程化会怎么调整？</li></ul><h2 id="关联卡片" tabindex="-1"><a class="header-anchor" href="#关联卡片" aria-hidden="true">#</a> 关联卡片</h2>',5),l=(0,e.Uk)("项目： "),p=(0,e._)("code",null,"project__announce-plugin",-1),r=(0,e.Uk)("对比： "),o=(0,e._)("code",null,"matrix__bundler-webpack-vite-rollup",-1),i=(0,e.uE)('<h2 id="在我项目中的角色与使用场景" tabindex="-1"><a class="header-anchor" href="#在我项目中的角色与使用场景" aria-hidden="true">#</a> 在我项目中的角色与使用场景</h2><ul><li>典型场景：做“跨平台公告插件/SDK/组件库”这类<strong>要被外部系统集成</strong>的产物。 <ul><li>目标：产物要小、格式要全（esm/cjs/umd）、tree-shaking 友好、外部依赖可控（external）。</li></ul></li><li>我在项目里的落地： <ul><li>设计多产物输出（ESM + CJS + UMD），并约定 <code>exports</code> 字段与类型声明输出。</li><li>控制 breaking change：版本化、变更记录、以及验证“被集成方”的兼容性矩阵。</li></ul></li></ul><h2 id="原理简述" tabindex="-1"><a class="header-anchor" href="#原理简述" aria-hidden="true">#</a> 原理简述</h2><p>Rollup 的核心优势是：以 ESM 为中心做静态分析，天然适合 <strong>tree-shaking</strong> 与高质量库产物。</p><ul><li><strong>模块解析</strong>：对 ESM import/export 做静态分析，构建依赖图。</li><li><strong>tree-shaking</strong>： <ul><li>能删除“未被引用的导出”，前提是代码可静态分析且无副作用（side effects）。</li><li>关键开关：<code>treeshake</code>、<code>moduleSideEffects</code>、以及 <code>package.json</code> 的 <code>sideEffects</code> 声明。</li></ul></li><li><strong>external</strong>：库构建常把 <code>react</code> 这类依赖标记为外部，避免打进产物导致重复依赖与体积膨胀。</li><li><strong>插件体系</strong>：同样有 transform/resolve/load/generateBundle 等生命周期，生态成熟。</li></ul><p>权衡点：</p><ul><li>Rollup 不以 Dev Server/HMR 为核心；做应用构建往往需要更多配套。</li><li>对 CJS/动态 require 的处理，需要插件与约束（尽量写成 ESM）。</li></ul><h2 id="对比表格" tabindex="-1"><a class="header-anchor" href="#对比表格" aria-hidden="true">#</a> 对比表格</h2><table><thead><tr><th>维度</th><th>Rollup</th><th>Webpack</th><th>Vite</th></tr></thead><tbody><tr><td>最适合</td><td><strong>库/SDK</strong></td><td>应用（全能）</td><td>应用（DX 优先）</td></tr><tr><td>tree-shaking</td><td><strong>强</strong>（ESM 优先）</td><td>依赖配置与写法</td><td>生产同 Rollup</td></tr><tr><td>external 控制</td><td>强（库场景友好）</td><td>也可做，但更偏应用</td><td>可做</td></tr><tr><td>多格式输出</td><td><strong>一等公民</strong></td><td>可做但较繁琐</td><td>生产可做（Rollup）</td></tr></tbody></table><p>我的选型口径：</p><ul><li>“被别人引入”的库：优先 Rollup（产物质量、体积、格式完整）。</li><li>“自己运行”的应用：Webpack/Vite 更合适。</li></ul><h2 id="模拟问答" tabindex="-1"><a class="header-anchor" href="#模拟问答" aria-hidden="true">#</a> 模拟问答</h2><ul><li>[ ] Q1：tree-shaking 为什么有时不生效？ <ul><li>常见原因： <ul><li>产物是 CJS（静态分析弱），或混用了动态 <code>require</code>。</li><li>包声明有副作用（未正确配置 <code>sideEffects</code>），Rollup 不敢删。</li><li>写法导致引用不可静态确定（比如 <code>export *</code> + 动态访问）。</li></ul></li><li>解决：保持 ESM、配置 <code>moduleSideEffects</code>、把副作用代码（polyfill/全局注入）显式隔离。</li></ul></li><li>[ ] Q2：为什么库构建要 external？ <ul><li>避免把 <code>react</code>/<code>lodash</code> 打进包导致重复依赖、版本冲突与体积膨胀；</li><li>让使用方用自己的依赖版本，符合生态预期。</li></ul></li></ul><h2 id="手写代码区" tabindex="-1"><a class="header-anchor" href="#手写代码区" aria-hidden="true">#</a> 手写代码区</h2><p>一个“ESM + CJS 双产物 + external + d.ts”思路示例：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-typescript&#39;</span>\n\n<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token punctuation">{</span>import(&#39;rollup&#39;).RollupOptions<span class="token punctuation">}</span> */</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  input<span class="token operator">:</span> <span class="token string">&#39;src/index.ts&#39;</span><span class="token punctuation">,</span>\n  external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      tsconfig<span class="token operator">:</span> <span class="token string">&#39;./tsconfig.json&#39;</span><span class="token punctuation">,</span>\n      declaration<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      declarationDir<span class="token operator">:</span> <span class="token string">&#39;dist/types&#39;</span><span class="token punctuation">,</span>\n      rootDir<span class="token operator">:</span> <span class="token string">&#39;src&#39;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  output<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span> file<span class="token operator">:</span> <span class="token string">&#39;dist/index.mjs&#39;</span><span class="token punctuation">,</span> format<span class="token operator">:</span> <span class="token string">&#39;esm&#39;</span><span class="token punctuation">,</span> sourcemap<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span> file<span class="token operator">:</span> <span class="token string">&#39;dist/index.cjs&#39;</span><span class="token punctuation">,</span> format<span class="token operator">:</span> <span class="token string">&#39;cjs&#39;</span><span class="token punctuation">,</span> sourcemap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> exports<span class="token operator">:</span> <span class="token string">&#39;named&#39;</span> <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="我的补充-manual" tabindex="-1"><a class="header-anchor" href="#我的补充-manual" aria-hidden="true">#</a> 我的补充（Manual）</h2><p>（不会被脚本覆盖：踩坑、细节、反例、排查路径）</p><h2 id="复盘与反思-learnings" tabindex="-1"><a class="header-anchor" href="#复盘与反思-learnings" aria-hidden="true">#</a> 复盘与反思（Learnings）</h2><ul><li>如果重做会怎么改？</li></ul><h2 id="面试官追问-面试官视角" tabindex="-1"><a class="header-anchor" href="#面试官追问-面试官视角" aria-hidden="true">#</a> 面试官追问（面试官视角）</h2><ul><li>[ ] 为什么选这个方案？替代方案为什么不选？</li><li>[!] 最大一次事故/踩坑是什么？如何定位与回滚？</li><li>[ ] 如果重做会怎么改？</li></ul>',22),c={},u=(0,a(3744).Z)(c,[["render",function(n,s){const a=(0,e.up)("RouterLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[t,(0,e._)("ul",null,[(0,e._)("li",null,[l,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e.Wm)(a,{to:"/interview-prep/project__announce-plugin.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,e.w5)((()=>[p])),_:1})])])]),(0,e._)("li",null,[r,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e.Wm)(a,{to:"/interview-prep/matrix__bundler-webpack-vite-rollup.html#%E5%AF%B9%E6%AF%94%E8%A1%A8%E6%A0%BC"},{default:(0,e.w5)((()=>[o])),_:1})])])])]),i],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);