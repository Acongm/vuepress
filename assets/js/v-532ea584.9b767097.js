"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[1770],{2873:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-532ea584",path:"/interview-prep/project__announce-plugin.html",title:"跨平台公告插件系统",lang:"zh-CN",frontmatter:{id:"project__announce-plugin",type:"project",title:"跨平台公告插件系统",mastery:"not_started",tags:["rollup","preact","plugin","sandbox"],projects:["project__announce-plugin"],source_refs:[{source:"resume",file:"docs/job-description/web前端开发工程师-彭聪.md",anchor:"跨平台公告插件系统"}],seed_refs:[{source:"outline",file:"docs/job-description/web前端开发工程师-彭聪-面试技术大纲.md",anchor:"4）跨平台公告插件系统：如何实现热插拔 + 如何实现多路复用"}],updated_at:"2025-12-20T00:00:00.000Z"},excerpt:"",headers:[{level:2,title:"摘要（Auto）",slug:"摘要-auto",children:[]},{level:2,title:"建议追问（Auto）",slug:"建议追问-auto",children:[]},{level:2,title:"关联卡片",slug:"关联卡片",children:[]},{level:2,title:"在我项目中的角色与使用场景",slug:"在我项目中的角色与使用场景",children:[]},{level:2,title:"原理简述",slug:"原理简述",children:[]},{level:2,title:"对比表格",slug:"对比表格",children:[]},{level:2,title:"模拟问答",slug:"模拟问答",children:[]},{level:2,title:"手写代码区",slug:"手写代码区",children:[]},{level:2,title:"我的补充（Manual）",slug:"我的补充-manual",children:[]},{level:2,title:"复盘与反思（Learnings）",slug:"复盘与反思-learnings",children:[]},{level:2,title:"面试官追问（面试官视角）",slug:"面试官追问-面试官视角",children:[]}],git:{updatedTime:1766324604e3},filePathRelative:"interview-prep/project__announce-plugin.md"}},9613:(n,s,a)=>{a.r(s),a.d(s,{default:()=>d});var e=a(6252);const t=(0,e.uE)('<h2 id="摘要-auto" tabindex="-1"><a class="header-anchor" href="#摘要-auto" aria-hidden="true">#</a> 摘要（Auto）</h2><ul><li>生成时间：2025-12-20</li><li>简历中出现的项目标题（提取）：大疆用户中心重构 / 大疆售后 RMS 系统重构 / 跨平台公告插件系统 / 大疆 DevOps 平台维护 / XDR 系统 - 魔方大屏 + 报表</li><li>面试大纲关键词（提取 Top10）：1）大疆用户中心重构：性能优化 + HTTP 原理 + Webpack 架构 / 性能指标与方法论 / 简历可落地点（结合你的“优化四板斧”） / HTTP 常考点（从“为什么变快”倒推） / Webpack 架构（工程化面试常考） / 按优化顺序，把方案“串起来”（排查 → 定位 → 选择 → 验证） / 0. 排查与基线（先把问题“量化”） / 1. 先保“可见”——骨架屏预渲染（直接拉低 LCP） / 2. 再减“阻塞”——关键渲染路径（CRP）梳理：CSS/字体/首图优先级 / 3. 再降“下载与解析成本”——更小的包体与更少的无效代码</li></ul><h2 id="建议追问-auto" tabindex="-1"><a class="header-anchor" href="#建议追问-auto" aria-hidden="true">#</a> 建议追问（Auto）</h2><ul><li>你为什么在该项目/场景里选择这个方案？替代方案为何不选？</li><li>最大一次事故/踩坑是什么？如何定位与回滚？</li><li>如果重做：架构/边界/工程化会怎么调整？</li></ul><h2 id="关联卡片" tabindex="-1"><a class="header-anchor" href="#关联卡片" aria-hidden="true">#</a> 关联卡片</h2>',5),l=(0,e.Uk)("技术： "),p=(0,e._)("code",null,"tech__rollup",-1),o=(0,e._)("code",null,"tech__micro-frontend-qiankun",-1),i=(0,e.Uk)("对比： "),c=(0,e._)("code",null,"matrix__bundler-webpack-vite-rollup",-1),u=(0,e.uE)('<h2 id="在我项目中的角色与使用场景" tabindex="-1"><a class="header-anchor" href="#在我项目中的角色与使用场景" aria-hidden="true">#</a> 在我项目中的角色与使用场景</h2><p>独立开发者。负责插件加载生命周期、隔离策略、版本治理与多宿主接入协议。</p><h2 id="原理简述" tabindex="-1"><a class="header-anchor" href="#原理简述" aria-hidden="true">#</a> 原理简述</h2><p>一句话：这是一个“<strong>可热插拔、可灰度、可回滚</strong>”的前端公告插件系统，重点在“生命周期、隔离、依赖与治理”。</p><ul><li>生命周期（可对齐 single-spa/qiankun 的心智）： <ul><li><code>init</code>：初始化配置、拉取公告配置（开关/策略）。</li><li><code>mount</code>：渲染 UI、挂载事件、启动定时器/订阅。</li><li><code>update</code>：公告策略变更（文案/频率/人群）时热更新，不影响宿主。</li><li><code>unmount</code>：释放事件/定时器/订阅，清理 DOM 与样式，保证“卸载干净”。</li></ul></li><li>隔离与冲突治理： <ul><li>CSS：前缀化/Shadow DOM（按宿主能力选择），避免污染宿主样式。</li><li>JS：避免写 <code>window</code>；必要时走命名空间；关键副作用集中管理并可回收。</li><li>依赖：产物 external + peerDependencies，避免多份 React/Vue 运行时导致冲突。</li></ul></li><li>灰度/回滚： <ul><li>插件版本与策略配置分离：同版本可以通过远端策略开关控制展示。</li><li>加载失败兜底：超时/异常熔断，确保“不影响宿主核心链路”。</li></ul></li><li>通信协议： <ul><li>宿主提供最小能力（token/user/device/埋点函数），插件只依赖协议，不依赖宿主框架实现细节。</li></ul></li></ul><h2 id="对比表格" tabindex="-1"><a class="header-anchor" href="#对比表格" aria-hidden="true">#</a> 对比表格</h2><table><thead><tr><th>方案</th><th>隔离性</th><th>通信成本</th><th>性能</th><th>接入复杂度</th><th>适用场景</th></tr></thead><tbody><tr><td>纯 CDN 注入（script）</td><td>弱</td><td>低</td><td>佳</td><td>低</td><td>简单插件、风险可控</td></tr><tr><td>iframe</td><td><strong>强</strong></td><td>高（postMessage）</td><td>中/差</td><td>中</td><td>强隔离/安全优先</td></tr><tr><td>Web Component</td><td>中（Shadow DOM）</td><td>中</td><td>佳</td><td>中</td><td>宿主同标准、希望组件化</td></tr><tr><td>本项目方案（协议 + 可卸载）</td><td>中-强（按策略）</td><td>低-中</td><td>佳</td><td>中</td><td>多宿主、多栈、需要治理能力</td></tr></tbody></table><h2 id="模拟问答" tabindex="-1"><a class="header-anchor" href="#模拟问答" aria-hidden="true">#</a> 模拟问答</h2><ul><li>[ ] 如何保证加载/卸载干净？如何回收事件/定时器/订阅？</li><li>[ ] 多宿主不同技术栈版本冲突如何隔离？公共依赖如何去重？</li><li>[ ] 如果插件加载失败，如何兜底与熔断？可观测性怎么做？</li><li>[ ]（大纲维度）构建工具选型：为什么库更偏 Rollup？什么时候反而 Webpack 更合适？ <ul><li>Rollup：多格式输出（esm/cjs/umd）更自然、tree-shaking 更强、产物更干净。</li><li>Webpack：当插件内部依赖很复杂、需要强 runtime 分包、或者复用应用侧构建体系时更合适。</li></ul></li><li>[ ]（大纲维度）多路复用怎么做到“一次构建/一次运行服务多个系统”？如何实现接入 &lt; 0.5 人日？ <ul><li>协议优先：把宿主差异收敛到最小协议（鉴权/用户信息/埋点/路由）。</li><li>资源去重：单例加载器 + 版本缓存，避免重复注入与重复初始化。</li><li>接入成本：提供“复制粘贴级”接入脚手架（1 段初始化代码 + 1 份配置），其余走默认值。</li></ul></li><li>[ ]（大纲维度）为什么选 Preact（含 <code>preact/compat</code>）？与 React 的风险边界是什么？ <ul><li>可复述要点： <ul><li>目标：插件场景更看重“体积与加载成本”，Preact 内核更小。</li><li>兼容：通过 <code>preact/compat</code> 兼容大部分 React 生态，但要明确“不保证 100% 行为一致”（复杂生态/边角特性要验证）。</li><li>风险控制：限定组件库/依赖范围，建立兼容性用例与宿主矩阵，必要时提供 React 版本产物作为兜底。</li></ul></li></ul></li><li>[ ]（大纲维度）signals 的心智模型是什么？为什么它能带来更新粒度收益？ <ul><li>可复述要点： <ul><li>signals 把“值”变成可订阅原语，更新时只通知依赖它的订阅者，减少无效渲染。</li><li>与 hooks 的差异：hooks 以组件为单位触发 render；signals 更偏“按值驱动更新”。</li><li>权衡：调试与团队心智成本要评估，避免滥用导致状态流难追踪。</li></ul></li></ul></li></ul><p>补充可复述要点：</p><ul><li>卸载干净怎么保证？ <ul><li>统一注册中心：所有 <code>addEventListener/setInterval/subscribe</code> 都通过一个 registry 注册，<code>unmount</code> 统一 dispose。</li></ul></li><li>依赖冲突怎么处理？ <ul><li>产物 external + peerDependencies；必要时通过 UMD 适配层做“最小运行时”。</li></ul></li><li>失败兜底与可观测性： <ul><li>超时熔断（例如 2s 未完成 init/mount 则降级不展示）；</li><li>上报：加载耗时、失败原因、宿主信息、版本号；支持按版本回滚。</li></ul></li></ul><p>补充可复述要点：</p><ul><li>卸载干净怎么保证？ <ul><li>统一注册中心：所有 <code>addEventListener/setInterval/subscribe</code> 都通过一个 registry 注册，<code>unmount</code> 统一 dispose。</li></ul></li><li>依赖冲突怎么处理？ <ul><li>产物 external + peerDependencies；必要时通过 UMD 适配层做“最小运行时”。</li></ul></li><li>失败兜底与可观测性： <ul><li>超时熔断（例如 2s 未完成 init/mount 则降级不展示）；</li><li>上报：加载耗时、失败原因、宿主信息、版本号；支持按版本回滚。</li></ul></li></ul><h1 id="current-your-changes" tabindex="-1"><a class="header-anchor" href="#current-your-changes" aria-hidden="true">#</a> &lt;&lt;&lt;&lt;&lt;&lt;&lt; Current (Your changes)</h1><p>再补一组“热插拔 + 多路复用 + 选型取舍”追问（对应面试大纲第 3/4 部分）：</p><ul><li>[ ] Q4：热插拔的核心是什么？为什么一定要有 <code>update</code>？ <ul><li>核心：让插件在“<strong>不重启宿主</strong>”的情况下可控升级/降级。</li><li><code>update</code> 的价值：策略/内容变了只做增量更新（避免反复 unmount/mount 带来闪烁与副作用风险）。</li><li>兜底：<code>update</code> 失败要能回退到上一版内容或直接熔断不展示（不影响宿主主链路）。</li></ul></li><li>[ ] Q5：你怎么实现“多路复用”（一次构建/一次运行服务多个系统）？ <ul><li>复用层级： <ul><li>构建产物复用：同一版本产物被多个宿主引用（版本治理 + 兼容性矩阵）。</li><li>运行时复用：脚本/运行时单例加载器，避免重复初始化（减少体积与副作用）。</li><li>配置复用：策略中心统一下发（内容/频率/人群/开关）。</li></ul></li><li>关键口径：宿主只对接“协议”，插件只依赖“协议”，避免宿主内部实现耦合。</li></ul></li><li>[ ] Q6：CDN 注入 vs iframe vs Web Component，你怎么选？边界是什么？ <ul><li>CDN 注入：性能好/接入低，但隔离弱 → 适合“低风险、可控范围”的插件。</li><li>iframe：隔离强，但通信与体验成本高 → 适合强隔离/安全优先。</li><li>Web Component：组件化强，Shadow DOM 可隔离样式 → 适合宿主标准统一且可控。</li><li>本项目口径：多宿主多栈 + 需要治理 → 用“协议 + 可卸载 + 可灰度”平衡隔离与成本。</li></ul></li><li>[ ] Q7：多宿主 React/Vue 版本不同怎么接？你怎么避免冲突？ <ul><li>基础策略：external + peerDependencies，避免把宿主的框架运行时打进插件。</li><li>必要时：提供 UMD 适配层或无框架渲染层（把能力收敛在插件内部），并做版本兼容矩阵验证。</li><li>兜底：冲突检测（例如检测全局标识/重复 runtime）→ 自动降级不展示并上报。</li></ul></li><li>[ ] Q8：为什么选 Preact（你简历提到 signals）？和 React 的取舍是什么？ <ul><li>选 Preact：体积更小、适合“插件/嵌入式 UI”场景；<code>preact/compat</code> 兼容大部分 React 写法。</li><li>signals 心智：更细粒度的更新，减少无效渲染；但需要规范（避免混用导致可维护性下降）。</li><li>反例：复杂生态依赖（大量 React 生态组件）或团队不熟悉 signals → 仍可能优先 React。</li></ul></li></ul><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>Incoming (Background Agent changes)</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><h2 id="手写代码区" tabindex="-1"><a class="header-anchor" href="#手写代码区" aria-hidden="true">#</a> 手写代码区</h2><p>一个最小“生命周期调度 + 资源回收”实现：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">Dispose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Registry</span> <span class="token punctuation">{</span>\n  <span class="token keyword">private</span> disposes<span class="token operator">:</span> Dispose<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n  <span class="token function">add</span><span class="token punctuation">(</span>d<span class="token operator">:</span> Dispose<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>disposes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">disposeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> d <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disposes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">Plugin</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  init<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>ctx<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span>\n  <span class="token function-variable function">mount</span><span class="token operator">:</span> <span class="token punctuation">(</span>ctx<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> registry<span class="token operator">:</span> Registry<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span>\n  update<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>ctx<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span>\n  unmount<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>ctx<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span>plugin<span class="token operator">:</span> Plugin<span class="token punctuation">,</span> ctx<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Registry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">await</span> plugin<span class="token punctuation">.</span>init<span class="token operator">?.</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>\n  <span class="token keyword">await</span> plugin<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> registry<span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    registry<span class="token punctuation">.</span><span class="token function">disposeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">await</span> plugin<span class="token punctuation">.</span>unmount<span class="token operator">?.</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="我的补充-manual" tabindex="-1"><a class="header-anchor" href="#我的补充-manual" aria-hidden="true">#</a> 我的补充（Manual）</h2><p>（不会被脚本覆盖）</p><h2 id="复盘与反思-learnings" tabindex="-1"><a class="header-anchor" href="#复盘与反思-learnings" aria-hidden="true">#</a> 复盘与反思（Learnings）</h2><ul><li>如果重做会怎么改？</li></ul><h2 id="面试官追问-面试官视角" tabindex="-1"><a class="header-anchor" href="#面试官追问-面试官视角" aria-hidden="true">#</a> 面试官追问（面试官视角）</h2><ul><li>[ ] 为什么选这个方案？替代方案为什么不选？</li><li>[!] 最大一次事故/踩坑是什么？如何定位与回滚？</li><li>[ ] 如果重做会怎么改？</li><li>[ ] 多系统里 React/Vue 版本不同导致冲突，你如何隔离？external 与 sandbox 各解决什么？</li><li>[ ] 插件灰度怎么做？远端开关/版本号/异常熔断三者如何配合？</li><li>[ ] 什么时候你会放弃 Preact，直接选 React？给一个“不可妥协”的条件。</li></ul>',26),r={},d=(0,a(3744).Z)(r,[["render",function(n,s){const a=(0,e.up)("RouterLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[t,(0,e._)("ul",null,[(0,e._)("li",null,[l,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e.Wm)(a,{to:"/interview-prep/tech__rollup.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,e.w5)((()=>[p])),_:1})]),(0,e._)("li",null,[(0,e.Wm)(a,{to:"/interview-prep/tech__micro-frontend-qiankun.html#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"},{default:(0,e.w5)((()=>[o])),_:1})])])]),(0,e._)("li",null,[i,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e.Wm)(a,{to:"/interview-prep/matrix__bundler-webpack-vite-rollup.html#%E5%AF%B9%E6%AF%94%E8%A1%A8%E6%A0%BC"},{default:(0,e.w5)((()=>[c])),_:1})])])])]),u],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);