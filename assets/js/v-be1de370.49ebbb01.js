"use strict";(self.webpackChunkmd_vuepress=self.webpackChunkmd_vuepress||[]).push([[7657],{4712:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-be1de370",path:"/mark/04-%E5%BE%AE%E5%89%8D%E7%AB%AF.html",title:"微前端对比 & 各方案实现原理",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"笔试题（6 题）",slug:"笔试题-6-题",children:[{level:3,title:"1. 微前端核心问题",slug:"_1-微前端核心问题",children:[]},{level:3,title:"2. 微前端方案对比",slug:"_2-微前端方案对比",children:[]}]},{level:2,title:"面试题（4 题）",slug:"面试题-4-题",children:[{level:3,title:"1. 微前端适用性判断",slug:"_1-微前端适用性判断",children:[]},{level:3,title:"2. 微前端基础设施",slug:"_2-微前端基础设施",children:[]},{level:3,title:"3. 微前端部署与发布",slug:"_3-微前端部署与发布",children:[]},{level:3,title:"4. 子应用性能治理",slug:"_4-子应用性能治理",children:[]}]}],git:{updatedTime:1770278657e3},filePathRelative:"mark/04-微前端.md"}},3619:(n,s,a)=>{a.r(s),a.d(s,{default:()=>p});const e=(0,a(6252).uE)('<h1 id="微前端对比-各方案实现原理" tabindex="-1"><a class="header-anchor" href="#微前端对比-各方案实现原理" aria-hidden="true">#</a> 微前端对比 &amp; 各方案实现原理</h1><h2 id="笔试题-6-题" tabindex="-1"><a class="header-anchor" href="#笔试题-6-题" aria-hidden="true">#</a> 笔试题（6 题）</h2><h3 id="_1-微前端核心问题" tabindex="-1"><a class="header-anchor" href="#_1-微前端核心问题" aria-hidden="true">#</a> 1. 微前端核心问题</h3><p>微前端要解决什么问题？它引入了哪些新的复杂度？适用和不适用的场景分别是什么？</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>要解决的问题：\n\n1. 团队协作问题：\n   - 多团队并行开发，避免代码冲突\n   - 不同团队技术栈独立（React、Vue、Angular 可共存）\n   - 降低团队间的沟通成本和依赖\n\n2. 代码膨胀问题：\n   - 单体应用代码量过大（10万+行代码）\n   - 构建时间长（5-10分钟）\n   - 开发体验差（热更新慢）\n\n3. 发布部署问题：\n   - 单体应用牵一发动全身，任何改动都需要全量发布\n   - 发布风险高，回滚代价大\n   - 无法做到按模块独立部署\n\n4. 业务隔离问题：\n   - 核心业务与边缘业务耦合\n   - 不同业务线需要独立迭代\n   - 历史代码重构成本高\n\n5. 技术债务问题：\n   - 老代码技术栈无法升级（如 React 15 → React 18）\n   - 新老代码共存，逐步迁移\n\n引入的新复杂度：\n\n1. 技术复杂度：\n   - JS 隔离（沙箱机制）\n   - CSS 隔离（样式冲突）\n   - 路由劫持与同步\n   - 应用间通信机制\n   - 公共依赖管理与版本冲突\n\n2. 工程复杂度：\n   - 构建配置复杂（主应用 + 多个子应用）\n   - 联调困难（本地开发需要启动多个应用）\n   - 部署流程复杂（独立部署 + 资源加载）\n   - 版本管理复杂（多仓库/Monorepo）\n\n3. 运维复杂度：\n   - 资源加载性能（多个应用的 JS/CSS 加载）\n   - 错误边界与降级（某个子应用挂了不能影响主应用）\n   - 监控与日志（需要区分不同应用的错误）\n   - 灰度发布与回滚（多应用协同）\n\n4. 开发体验复杂度：\n   - 调试困难（跨应用调试）\n   - 本地开发环境搭建复杂\n   - 需要学习微前端框架（qiankun、Module Federation）\n\n适用场景：\n\n✅ 大型中后台系统：\n   - 多个业务模块（订单、库存、财务、CRM 等）\n   - 多团队协作（5+ 团队）\n   - 代码量大（10万+ 行）\n   - 示例：企业 ERP、电商后台、政务系统\n\n✅ 跨技术栈整合：\n   - 历史系统是 Vue，新系统用 React\n   - 逐步迁移技术栈，新老系统共存\n   - 收购的第三方系统需要整合\n\n✅ 独立业务模块：\n   - 业务模块相对独立（低耦合）\n   - 各模块独立部署需求强烈\n   - 不同模块由不同供应商开发\n\n✅ 多租户 SaaS 平台：\n   - 不同租户可能需要不同的定制模块\n   - 插件化需求（可动态加载/卸载模块）\n\n不适用场景：\n\n❌ 小型项目：\n   - 代码量 &lt; 5万行\n   - 团队 &lt; 5 人\n   - 引入微前端收益 &lt; 成本\n\n❌ 高性能要求场景：\n   - C端应用对首屏性能要求极高（如电商首页）\n   - 微前端额外的 JS 加载会影响性能\n   - 应优先考虑代码分割、懒加载\n\n❌ 强交互应用：\n   - 子应用间需要频繁通信（如实时协作工具）\n   - 组件级复用需求强（应考虑组件库，而非微前端）\n   - 状态共享复杂（Redux/MobX 全局状态）\n\n❌ 移动端 H5：\n   - 移动端性能敏感\n   - 额外的框架代码和沙箱机制会影响性能\n   - 应优先考虑 PWA、离线化\n\n❌ 技术栈统一的团队：\n   - 团队已经统一技术栈（如全部 React）\n   - 使用 Monorepo + 模块化即可解决问题\n   - 不需要微前端的隔离能力\n\n决策原则：\n- 收益 &gt; 成本：解决的问题价值 &gt; 引入的复杂度\n- 团队规模：5+ 团队才考虑\n- 代码规模：10万+ 行代码才考虑\n- 独立部署：如果不需要独立部署，不要用微前端\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div><hr><h3 id="_2-微前端方案对比" tabindex="-1"><a class="header-anchor" href="#_2-微前端方案对比" aria-hidden="true">#</a> 2. 微前端方案对比</h3><p>主流方案对比：iframe / single-spa / qiankun / Module Federation 的核心差异，优缺点对比表。</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>iframe:\n优点：\n  ✅ 天然隔离（JS、CSS、DOM 完全隔离）\n  ✅ 实现简单，零技术门槛\n  ✅ 浏览器原生支持，稳定性好\n  ✅ 可以加载任意第三方页面\n\n缺点：\n  ❌ 性能差（每个 iframe 是独立的浏览器上下文）\n  ❌ 路由同步困难（iframe 内部路由无法同步到主应用 URL）\n  ❌ 弹窗/遮罩层体验差（受 iframe 边界限制）\n  ❌ 白屏时间长（独立加载所有资源）\n  ❌ 内存占用高（多个完整的浏览器上下文）\n  ❌ 通信复杂（postMessage，不同域需要 CORS）\n  ❌ SEO 不友好\n\n适用场景：\n  - 嵌入第三方页面（如支付页面、BI 报表）\n  - 对性能要求不高的后台管理系统\n  - 需要强隔离的场景（安全性要求高）\n\n---\n\nsingle-spa:\n优点：\nk/\n   - 各应用独立的组件\n   - 原因：独立迭代、避免耦合\n\n2. 治理策略：\n\n   策略1：Monorepo 统一管理\n   - 所有应用在一个仓库\n   - package.json 统一版本\n   - 好处：版本强制统一\n\n   project/\n   ├── packages/\n   │   ├── main-app/        (主应用)\n   │   ├── sub-app-1/       (子应用1)\n   │   └── sub-app-2/       (子应用2)\n   └── package.json         (统一依赖版本)\n\n   策略2：依赖版本清单\n   - 维护一份依赖版本清单（versions.json）\n   - 所有应用遵循清单版本\n\n   // versions.json\n   {\n     &quot;react&quot;: &quot;18.2.0&quot;,\n     &quot;react-dom&quot;: &quot;18.2.0&quot;,\n     &quot;antd&quot;: &quot;5.0.0&quot;\n   }\n\n   策略3：CI 检查\n   - 在 CI 阶段检查依赖版本\n   - 不符合规范则阻止部署\n\n   // 检查脚本\n   const checkVersions = () =&gt; {\n     const pkg = require(&#39;./package.json&#39;)\n     if (pkg.dependencies.react !== &#39;18.2.0&#39;) {\n       throw new Error(&#39;React 版本不符合规范&#39;)\n     }\n   }\n\n   策略4：公共依赖中心化\n   - 主应用统一管理公共依赖\n   - 子应用通过主应用获取\n\n   // 主应用暴露依赖\n   window.__SHARED_LIBS__ = {\n     react: React,\n     reactDOM: ReactDOM,\n     antd: antd\n   }\n\n   // 子应用使用\n   const React = window.__SHARED_LIBS__.react\n\n3. 依赖升级流程：\n\n   步骤1：评估影响范围\n   - 哪些应用使用了该依赖\n   - 升级是否有 Breaking Changes\n\n   步骤2：统一升级\n   - 所有应用同步升级\n   - 避免版本碎片化\n\n   步骤3：测试验证\n   - 主应用测试\n   - 所有子应用测试\n\n   步骤4：灰度发布\n   - 先发布一个子应用\n   - 验证无问题后全量发布\n\n---\n\nexternal（外部化）：\n\n定义：\n- 将依赖标记为外部依赖\n- 不打包到 bundle 中\n- 运行时从外部获取（如 CDN、window 全局变量）\n\n配置方式：\n// webpack.config.js\nmodule.exports = {\n  externals: {\n    react: &#39;React&#39;,          // window.React\n    &#39;react-dom&#39;: &#39;ReactDOM&#39;, // window.ReactDOM\n    jquery: &#39;jQuery&#39;         // window.jQuery\n  }\n}\n\n使用场景：\n1. CDN 加载：\n   - 通过 CDN 加载 React\n   - 所有应用共享同一个 CDN 资源\n\n   &lt;!-- index.html --&gt;\n   &lt;script src=&quot;https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js&quot;&gt;&lt;/script&gt;\n   &lt;script src=&quot;https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;\n\n2. 主应用提供：\n   - 主应用加载依赖到 window\n   - 子应用通过 external 使用\n\n   // 主应用\n   import React from &#39;react&#39;\n   window.React = React\n\n   // 子应用 webpack 配置\n   externals: {\n     react: &#39;React&#39;\n   }\n\n优点：\n✅ 减少子应用体积\n✅ 利用浏览器缓存（CDN）\n✅ 强制版本统一（都用同一个 window.React）\n\n缺点：\n❌ 需要手动管理加载顺序\n❌ CDN 不稳定可能影响可用性\n❌ 调试困难（CDN 压缩代码）\n❌ 无法按需加载（必须全量加载）\n\n最佳实践：\n- 适合稳定的大型依赖（React、Vue）\n- 生产环境使用，开发环境关闭（便于调试）\n- 配合 CDN fallback（CDN 失败时本地加载）\n\n---\n\nshared（共享依赖，Module Federation）：\n\n定义：\n- Webpack 5 Module Federation 的共享机制\n- 运行时动态协商依赖版本\n- 自动去重，按需加载\n\n配置方式：\nnew ModuleFederationPlugin({\n  shared: {\n    // 简单配置\n    react: &#39;^18.0.0&#39;,\n\n    // 详细配置\n    &#39;react-dom&#39;: {\n      singleton: true,           // 单例模式\n      requiredVersion: &#39;^18.0.0&#39;, // 版本要求\n      eager: false,              // 是否立即加载\n      strictVersion: false       // 严格版本检查\n    }\n  }\n})\n\n工作机制：\n1. 编译时：\n   - 分析依赖，生成共享清单\n   - 记录版本信息\n\n2. 运行时：\n   - 主应用和子应用协商版本\n   - 选择合适的版本（通常是最高兼容版本）\n   - 共享同一个实例\n\n优点：\n✅ 自动版本协商（无需手动管理）\n✅ 按需加载（懒加载，减少首屏时间）\n✅ 灵活性高（可配置降级策略）\n✅ 支持多版本共存（兼容性好）\n\n缺点：\n❌ 配置复杂（需要理解 singleton、eager 等概念）\n❌ 调试困难（运行时动态加载）\n❌ 版本冲突时可能加载多份（体积增加）\n\n适用场景：\n- 使用 Webpack 5 + Module Federation\n- 依赖版本可能不完全一致\n- 需要灵活的版本管理\n\n对比 external：\n| 特性       | external       | shared              |\n|-----------|----------------|---------------------|\n| 加载时机   | 编译时决定      | 运行时协商           |\n| 版本管理   | 手动           | 自动                |\n| 灵活性    | 低             | 高                  |\n| 体积优化   | 好             | 中等                |\n| 适用场景   | 稳定依赖       | 动态依赖            |\n\n---\n\nsingleton（单例模式）：\n\n定义：\n- 保证全局只有一个依赖实例\n- 所有应用共享同一个实例\n- 版本冲突时强制使用一个版本\n\n配置方式：\nshared: {\n  react: {\n    singleton: true  // 开启单例\n  }\n}\n\n工作机制：\n1. 首次加载：\n   - 主应用加载 React 18.2.0\n   - 注册到全局共享作用域\n\n2. 子应用请求：\n   - 子应用需要 React 18.1.0\n   - 检测到已有 React 18.2.0\n   - 复用 18.2.0（而非加载新版本）\n\n3. 版本冲突：\n   - 如果子应用需要 React 17.0.0（不兼容）\n   - strictVersion: false → 告警，但仍使用 18.2.0\n   - strictVersion: true → 直接报错\n\n为什么需要 singleton：\n1. React 的要求：\n   - React 不支持多实例（Hooks 依赖单例）\n   - 多个 React 实例会导致 Hooks 报错\n\n   错误示例：\n   Error: Invalid hook call. Hooks can only be called inside of the body of a function component.\n\n2. 状态管理：\n   - Redux、MobX 等状态管理库需要单例\n   - 多实例会导致状态不同步\n\n3. 性能考虑：\n   - 减少重复加载\n   - 降低内存占用\n\n适用依赖：\n✅ 必须 singleton：\n   - React / React-DOM\n   - Vue\n   - Redux / MobX\n   - React-Router\n\n⚠️ 可选 singleton：\n   - Ant Design（建议单例，但多实例也能用）\n   - lodash（多实例无影响，但浪费资源）\n\n❌ 不需要 singleton：\n   - 纯工具函数\n   - 业务组件\n\n配置示例：\nshared: {\n  // 必须单例\n  react: {\n    singleton: true,\n    strictVersion: true  // 严格模式，版本不匹配报错\n  },\n\n  // 建议单例\n  antd: {\n    singleton: true,\n    strictVersion: false  // 宽松模式，版本不匹配告警\n  },\n\n  // 可选单例\n  lodash: {\n    singleton: false  // 允许多版本\n  }\n}\n\n---\n\n版本冲突处理：\n\n1. 预防策略：\n\n   策略1：版本锁定（package-lock.json）\n   - 锁定所有依赖的精确版本\n   - 避免安装时版本变化\n\n   策略2：版本规范\n   - 制定版本规范文档\n   - 统一主要依赖的版本（React、Ant Design）\n\n   策略3：依赖检查工具\n   - 开发工具检查依赖版本\n   - CI 阶段强制检查\n\n   // check-deps.js\n   const checkDeps = () =&gt; {\n     const mainPkg = require(&#39;../main-app/package.json&#39;)\n     const subPkg = require(&#39;../sub-app/package.json&#39;)\n\n     if (mainPkg.dependencies.react !== subPkg.dependencies.react) {\n       throw new Error(&#39;React 版本不一致&#39;)\n     }\n   }\n\n2. 运行时处理：\n\n   方案1：宽松模式（默认）\n   shared: {\n     react: {\n       singleton: true,\n       strictVersion: false,  // 不严格检查\n       requiredVersion: &#39;^18.0.0&#39;\n     }\n   }\n   - 版本不匹配时告警，但继续运行\n   - 风险：可能运行时错误\n\n   方案2：严格模式\n   shared: {\n     react: {\n       singleton: true,\n       strictVersion: true  // 严格检查\n     }\n   }\n   - 版本不匹配直接报错\n   - 强制修复版本问题\n\n   方案3：降级加载\n   shared: {\n     react: {\n       singleton: false  // 允许多版本\n     }\n   }\n   - 各应用加载各自版本\n   - 缺点：体积增加、多实例问题\n\n3. 监控与告警：\n\n   // 版本冲突监控\n   const monitorSharedDeps = () =&gt; {\n     const sharedScope = window.__webpack_share_scopes__.default\n\n     Object.keys(sharedScope).forEach(dep =&gt; {\n       const versions = Object.keys(sharedScope[dep])\n       if (versions.length &gt; 1) {\n         console.warn(`${dep} 存在多个版本:`, versions)\n         // 上报监控系统\n         reportVersionConflict(dep, versions)\n       }\n     })\n   }\n\n4. 实际案例与解决方案：\n\n   案例1：React 版本冲突\n   问题：主应用 React 18，子应用 React 17\n\n   方案：升级子应用\n   ✅ 推荐：升级子应用到 React 18\n   ⚠️ 临时：singleton: false，加载两份（可能 Hooks 报错）\n\n   案例2：Ant Design 版本冲突\n   问题：不同子应用使用 Ant Design 4 和 5\n\n   方案1：统一升级到 Ant Design 5\n   方案2：各自加载（不共享 antd）\n\n   shared: {\n     // antd 不共享，各自打包\n   }\n\n   案例3：工具库版本冲突\n   问题：lodash 4.17.20 和 4.17.21\n\n   方案：允许多版本（影响小）\n   shared: {\n     lodash: {\n       singleton: false\n     }\n   }\n\n5. 最佳实践总结：\n\n   ✅ 核心依赖必须统一版本（React、Vue）\n   ✅ 使用 Monorepo 或版本清单管理\n   ✅ CI 阶段检查依赖版本\n   ✅ 建立版本升级机制（定期统一升级）\n   ✅ 监控运行时版本冲突\n\n   ❌ 避免过度使用 strictVersion（容易报错）\n   ❌ 避免版本碎片化（每个应用版本都不同）\n   ❌ 避免手动修改 package-lock.json\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br></div></div><hr><h2 id="面试题-4-题" tabindex="-1"><a class="header-anchor" href="#面试题-4-题" aria-hidden="true">#</a> 面试题（4 题）</h2><h3 id="_1-微前端适用性判断" tabindex="-1"><a class="header-anchor" href="#_1-微前端适用性判断" aria-hidden="true">#</a> 1. 微前端适用性判断</h3><p>你的业务适不适合微前端？给出判断标准、评估维度与反例（什么情况下不应该用）。</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>判断标准（评分表）：\n\n维度1：团队规模（权重 30%）\n├─ 5+ 个独立团队：+30分 ✅ 强烈推荐\n├─ 3-4 个团队：+20分 ⚠️ 可以考虑\n├─ 1-2 个团队：+5分 ❌ 不推荐\n└─ 理由：微前端主要解决多团队协作问题\n\n维度2：代码规模（权重 25%）\n├─ 10万+ 行代码：+25分 ✅ 强烈推荐\n├─ 5-10万 行代码：+15分 ⚠️ 可以考虑\n├─ &lt; 5万 行代码：+5分 ❌ 不推荐\n└─ 理由：代码量大才有拆分价值\n\n维度3：独立部署需求（权重 25%）\n├─ 必须独立部署：+25分 ✅ 强烈推荐\n├─ 偶尔独立部署：+15分 ⚠️ 可以考虑\n├─ 不需要独立部署：+0分 ❌ 不推荐\n└─ 理由：独立部署是微前端的核心价值\n\n维度4：技术栈差异（权重 15%）\n├─ 多技术栈（React+Vue）：+15分 ✅ 推荐\n├─ 单技术栈，但需要渐进式迁移：+10分 ⚠️ 可以考虑\n├─ 单技术栈统一：+0分 ⚠️ 收益不明显\n└─ 理由：技术栈统一可用 Monorepo\n\n维度5：业务耦合度（权重 5%）\n├─ 业务模块独立（低耦合）：+5分 ✅ 推荐\n├─ 业务有一定依赖：+3分 ⚠️ 可以考虑\n├─ 业务高度耦合：-10分 ❌ 不推荐\n└─ 理由：高耦合会导致频繁跨应用通信\n\n评分规则：\n- 80-100分：✅ 强烈推荐微前端\n- 60-79分：⚠️ 可以考虑，需评估收益成本\n- &lt; 60分：❌ 不推荐，收益 &lt; 成本\n\n---\n\n评估维度（详细）：\n\n1. 团队维度：\n   ✅ 适合：\n   - 多团队并行开发（5+ 团队）\n   - 团队地域分散（不同城市）\n   - 团队技术栈不同\n   - 团队独立性强（各自负责一块业务）\n\n   ❌ 不适合：\n   - 单一小团队（&lt; 5人）\n   - 团队紧密协作（频繁跨团队开发）\n   - 团队技术能力弱（学习成本高）\n\n2. 业务维度：\n   ✅ 适合：\n   - 多个独立业务模块（订单、库存、财务）\n   - 业务模块相对独立（低耦合）\n   - 不同业务迭代节奏不同\n   - 中后台系统（ToB）\n\n   ❌ 不适合：\n   - 单一业务（如单纯的博客系统）\n   - 业务高度耦合（频繁跨模块调用）\n   - C端高性能要求（首屏性能敏感）\n   - 强交互应用（实时协作）\n\n3. 技术维度：\n   ✅ 适合：\n   - 历史技术栈迁移（Vue 2 → Vue 3 / React）\n   - 多技术栈并存需求\n   - 大型单体应用重构\n   - 需要独立升级技术栈\n\n   ❌ 不适合：\n   - 技术栈统一且稳定\n   - 团队对微前端不熟悉\n   - 对性能要求极高（额外开销不可接受）\n\n4. 部署维度：\n   ✅ 适合：\n   - 需要独立部署（高频发布）\n   - 不同模块发布周期不同\n   - 需要灰度发布\n   - 回滚风险隔离\n\n   ❌ 不适合：\n   - 统一发布即可\n   - 发布频率低（月度发布）\n   - 部署流程复杂度不可接受\n\n5. 规模维度：\n   ✅ 适合：\n   - 代码量 &gt; 10万行\n   - 构建时间 &gt; 5分钟\n   - 应用启动时间 &gt; 30秒\n   - 团队 &gt; 10人\n\n   ❌ 不适合：\n   - 小型项目（&lt; 5万行）\n   - 构建时间可接受（&lt; 2分钟）\n   - 团队小（&lt; 5人）\n\n---\n\n反例（不应该用微前端的场景）：\n\n反例1：个人博客系统\n- 代码量：5000 行\n- 团队：1 人\n- 业务：单一博客功能\n- 结论：❌ 完全没必要，用 Next.js 单体应用即可\n- 理由：引入微前端纯属过度设计\n\n反例2：创业公司 MVP 产品\n- 代码量：2 万行\n- 团队：3 人\n- 业务：快速迭代验证\n- 结论：❌ 不适合，浪费时间\n- 理由：\n  · 团队小，不存在协作问题\n  · 业务变化快，架构复杂度是负担\n  · 应优先验证产品，而非过度工程化\n\n反例3：C端电商首页\n- 场景：首屏性能要求极高（&lt; 1秒）\n- 用户：百万级 DAU\n- 结论：❌ 不适合\n- 理由：\n  · 微前端额外的 JS 加载影响首屏\n  · 应优先考虑 SSR、代码分割、CDN\n  · 可以用微前端做中后台管理，但不做C端\n\n反例4：强交互应用（实时协作工具）\n- 场景：在线文档编辑（类 Google Docs）\n- 特点：组件间频繁通信、状态高度共享\n- 结论：❌ 不适合\n- 理由：\n  · 应用间通信成本高\n  · 状态同步复杂\n  · 应优先考虑组件化，而非应用化\n\n反例5：技术栈统一的团队\n- 团队：全部使用 React\n- 规模：10 人\n- 代码：8 万行\n- 结论：⚠️ 不一定需要微前端\n- 理由：\n  · 使用 Monorepo + 代码分割可能更合适\n  · 微前端的技术栈隔离能力用不上\n  · 除非有强烈的独立部署需求\n\n反例6：移动端 H5 应用\n- 场景：移动端商城\n- 特点：性能敏感、流量成本高\n- 结论：❌ 不适合\n- 理由：\n  · 额外的框架代码影响性能\n  · 移动端网络不稳定，加载多个应用慢\n  · 应优先考虑 PWA、离线化\n\n---\n\n决策流程图：\n\n第一步：基础判断\nQ1: 团队 &gt;= 5 人？\n  ├─ 否 → ❌ 不建议（考虑 Monorepo）\n  └─ 是 → 继续\n\nQ2: 代码 &gt;= 10 万行？\n  ├─ 否 → ❌ 不建议（考虑模块化）\n  └─ 是 → 继续\n\nQ3: 需要独立部署？\n  ├─ 否 → ❌ 不建议（微前端核心价值缺失）\n  └─ 是 → 继续\n\n第二步：收益评估\nQ4: 是否存在以下痛点（2个以上）？\n  □ 多团队代码冲突频繁\n  □ 构建时间过长（&gt; 5分钟）\n  □ 技术栈迁移困难\n  □ 发布风险大（牵一发动全身）\n  □ 业务模块耦合严重\n\n  ├─ 是（2+ 痛点）→ ✅ 推荐微前端\n  └─ 否 → ❌ 不建议\n\n第三步：成本评估\nQ5: 团队是否能承受？\n  □ 学习成本（qiankun / Module Federation）\n  □ 改造成本（子应用需要改造）\n  □ 维护成本（多应用联调、部署）\n\n  ├─ 能承受 → ✅ 可以尝试\n  └─ 不能承受 → ❌ 暂缓\n\n---\n\n实际案例分析：\n\n案例1：某大型电商后台（适合）\n- 团队：15 人，3 个业务组\n- 代码：30 万行\n- 业务：订单、库存、财务、CRM\n- 技术栈：React 为主，历史遗留 jQuery\n- 痛点：\n  · 构建时间 8 分钟\n  · 任何改动都需要全量发布\n  · 新人上手困难（代码太多）\n- 方案：✅ 使用 qiankun 微前端\n- 效果：\n  · 构建时间降至 2 分钟（各子应用独立构建）\n  · 独立部署，发布频率从月度到周度\n  · 新人只需关注自己的子应用\n\n案例2：某政务系统（适合）\n- 团队：多个外包团队（技术能力参差不齐）\n- 代码：50 万行+\n- 业务：审批、公文、档案、统计等20+ 模块\n- 技术栈：不统一（有 Vue、React、Angular）\n- 方案：✅ 使用 qiankun，iframe 兜底\n- 收益：\n  · 各团队独立开发，减少冲突\n  · 技术栈隔离，各团队自主选择\n  · 模块独立部署，降低风险\n\n案例3：某创业公司 ToC 产品（不适合）\n- 团队：5 人\n- 代码：3 万行\n- 业务：社交 App\n- 方案：❌ 不使用微前端\n- 理由：\n  · 团队小，不存在协作问题\n  · 代码量小，模块化即可\n  · 性能敏感，不能接受额外开销\n  · 应专注于产品迭代\n\n---\n\n决策建议：\n\n何时应该用微前端：\n✅ 大型中后台系统（ERP、CRM、政务）\n✅ 多团队协作（5+ 团队）\n✅ 代码量大（10万+ 行）\n✅ 需要独立部署\n✅ 技术栈迁移需求\n✅ 收益明显 &gt; 成本\n\n何时不应该用微前端：\n❌ 小型项目（&lt; 5万行）\n❌ 小团队（&lt; 5人）\n❌ C端高性能要求\n❌ 强交互应用\n❌ 不需要独立部署\n❌ 技术栈统一且稳定\n❌ 团队技术能力不足\n\n中间地带（谨慎评估）：\n⚠️ 中型项目（5-10 万行）\n⚠️ 中型团队（5-10 人）\n⚠️ 有独立部署需求，但频率不高\n⚠️ 技术栈统一，但有少量历史代码\n\n建议：先从简单的方案开始（Monorepo、代码分割），问题严重时再引入微前端。\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br></div></div><hr><h3 id="_2-微前端基础设施" tabindex="-1"><a class="header-anchor" href="#_2-微前端基础设施" aria-hidden="true">#</a> 2. 微前端基础设施</h3><p>微前端下如何做&quot;统一登录态/权限/埋点/错误上报&quot;？如何设计主子应用的通信机制？</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>一、统一登录态\n\n问题：\n- 各子应用都需要获取用户信息\n- Token 需要统一管理\n- 登录状态需要同步\n\n方案设计：\n\n1. 主应用统一管理（推荐）：\n\n   架构：\n   ┌──────────────────────────┐\n   │      主应用（Main App）    │\n   │  ├─ 登录页面              │\n   │  ├─ Token 存储(LocalStorage)│\n   │  ├─ 用户信息缓存           │\n   │  └─ 登出逻辑              │\n   └──────────────────────────┘\n              ↓ props传递\n   ┌──────────────────────────┐\n   │      子应用（Sub App）     │\n   │  ├─ 接收 token           │\n   │  ├─ 接收 user info       │\n   │  └─ 接收 logout 方法      │\n   └──────────────────────────┘\n\n   实现（qiankun）：\n   // 主应用\n   import { registerMicroApps, start } from &#39;qiankun&#39;\n\n   const getToken = () =&gt; localStorage.getItem(&#39;token&#39;)\n   const getUserInfo = () =&gt; JSON.parse(localStorage.getItem(&#39;userInfo&#39;))\n   const logout = () =&gt; {\n     localStorage.removeItem(&#39;token&#39;)\n     window.location.href = &#39;/login&#39;\n   }\n\n   registerMicroApps([\n     {\n       name: &#39;app1&#39;,\n       entry: &#39;//localhost:8081&#39;,\n       container: &#39;#container&#39;,\n       activeRule: &#39;/app1&#39;,\n       props: {\n         getToken,\n         getUserInfo,\n         logout,\n         // 或者直接传递\n         token: getToken(),\n         userInfo: getUserInfo()\n       }\n     }\n   ])\n\n   // 子应用\n   export async function mount(props) {\n     const { getToken, getUserInfo, logout } = props\n\n     // 使用 token\n     axios.defaults.headers.common[&#39;Authorization&#39;] = `Bearer ${getToken()}`\n\n     // 使用用户信息\n     const userInfo = getUserInfo()\n     store.commit(&#39;SET_USER&#39;, userInfo)\n\n     // 登出\n     &lt;Button onClick={logout}&gt;退出登录&lt;/Button&gt;\n   }\n\n2. 共享 Token 存储：\n\n   方案1：LocalStorage 命名空间\n   // 主应用设置\n   localStorage.setItem(&#39;global:token&#39;, token)\n   localStorage.setItem(&#39;global:userInfo&#39;, JSON.stringify(userInfo))\n\n   // 子应用读取\n   const token = localStorage.getItem(&#39;global:token&#39;)\n\n   方案2：Cookie（跨域需要配置）\n   // 主应用设置 cookie（设置 domain）\n   document.cookie = `token=${token}; path=/; domain=.example.com`\n\n   // 子应用自动携带（同域）\n\n3. SSO 单点登录（企业级）：\n\n   流程：\n   1. 用户访问子应用\n   2. 子应用检测无 token，跳转 SSO 登录页\n   3. SSO 登录成功，颁发 token\n   4. 回调到子应用，携带 token\n   5. 子应用保存 token\n\n   优点：\n   - 多系统统一认证\n   - 安全性高\n   - 支持第三方应用\n\n   缺点：\n   - 需要独立的 SSO 服务\n   - 实现复杂度高\n\n---\n\n二、统一权限管理\n\n问题：\n- 不同用户权限不同（菜单、按钮、路由）\n- 各子应用都需要权限控制\n\n方案设计：\n\n1. 主应用统一权限（推荐）：\n\n   // 主应用\n   const permissions = {\n     menu: [&#39;order&#39;, &#39;inventory&#39;, &#39;finance&#39;],  // 菜单权限\n     button: [&#39;order:create&#39;, &#39;order:delete&#39;], // 按钮权限\n     api: [&#39;/api/order/*&#39;]                      // 接口权限\n   }\n\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     props: {\n       permissions,\n       hasPermission: (code) =&gt; permissions.button.includes(code)\n     }\n   }])\n\n   // 子应用使用\n   export function mount(props) {\n     const { hasPermission } = props\n\n     // 按钮权限控制\n     {hasPermission(&#39;order:create&#39;) &amp;&amp; &lt;Button&gt;创建订单&lt;/Button&gt;}\n\n     // 路由权限控制\n     &lt;Route path=&quot;/order/create&quot;\n            render={() =&gt; hasPermission(&#39;order:create&#39;)\n              ? &lt;CreateOrder /&gt;\n              : &lt;NoPermission /&gt;\n            }\n     /&gt;\n   }\n\n2. 权限路由自动生成：\n\n   // 主应用\n   const routes = [\n     { path: &#39;/app1&#39;, app: &#39;app1&#39;, permission: &#39;app1:access&#39; },\n     { path: &#39;/app2&#39;, app: &#39;app2&#39;, permission: &#39;app2:access&#39; }\n   ]\n\n   const accessibleRoutes = routes.filter(route =&gt;\n     hasPermission(route.permission)\n   )\n\n   // 根据权限动态注册子应用\n   registerMicroApps(accessibleRoutes.map(route =&gt; ({\n     name: route.app,\n     activeRule: route.path,\n   })))\n\n3. 菜单权限过滤：\n\n   // 主应用菜单配置\n   const menuConfig = [\n     { title: &#39;订单管理&#39;, path: &#39;/app1&#39;, permission: &#39;order:view&#39; },\n     { title: &#39;库存管理&#39;, path: &#39;/app2&#39;, permission: &#39;inventory:view&#39; },\n     { title: &#39;财务管理&#39;, path: &#39;/app3&#39;, permission: &#39;finance:view&#39; }\n   ]\n\n   const filteredMenu = menuConfig.filter(menu =&gt;\n     hasPermission(menu.permission)\n   )\n\n---\n\n三、统一埋点\n\n问题：\n- 需要收集用户行为（页面访问、按钮点击）\n- 各子应用需要统一埋点标准\n\n方案设计：\n\n1. 主应用提供埋点SDK（推荐）：\n\n   // 主应用初始化埋点\n   import Track from &#39;@company/track-sdk&#39;\n\n   const tracker = new Track({\n     appId: &#39;main-app&#39;,\n     userId: getUserId()\n   })\n\n   // 注入到子应用\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     props: {\n       tracker,\n       track: (event, data) =&gt; tracker.track(event, data)\n     }\n   }])\n\n   // 子应用使用\n   export function mount(props) {\n     const { track } = props\n\n     // 页面访问埋点\n     useEffect(() =&gt; {\n       track(&#39;page_view&#39;, { page: &#39;/order/list&#39; })\n     }, [])\n\n     // 按钮点击埋点\n     &lt;Button onClick={() =&gt; {\n       track(&#39;button_click&#39;, { button: &#39;create_order&#39; })\n       createOrder()\n     }}&gt;创建订单&lt;/Button&gt;\n   }\n\n2. 路由切换自动埋点：\n\n   // 主应用监听路由变化\n   import { addGlobalUncaughtErrorHandler } from &#39;qiankun&#39;\n\n   window.addEventListener(&#39;popstate&#39;, () =&gt; {\n     tracker.track(&#39;route_change&#39;, {\n       from: prevPath,\n       to: location.pathname,\n       app: getCurrentApp()\n     })\n   })\n\n3. 全局事件自动采集（无侵入）：\n\n   // 主应用全局监听\n   document.addEventListener(&#39;click&#39;, (e) =&gt; {\n     const target = e.target\n     const trackData = target.dataset.track\n\n     if (trackData) {\n       tracker.track(&#39;auto_click&#39;, JSON.parse(trackData))\n     }\n   }, true)\n\n   // 子应用使用 data 属性\n   &lt;Button data-track=&#39;{&quot;type&quot;:&quot;create_order&quot;}&#39;&gt;创建&lt;/Button&gt;\n\n4. 性能监控埋点：\n\n   // 主应用\n   const performance = {\n     appLoad: (app, time) =&gt; {\n       tracker.track(&#39;app_load&#39;, { app, time })\n     },\n     apiRequest: (url, time) =&gt; {\n       tracker.track(&#39;api_request&#39;, { url, time })\n     }\n   }\n\n   // qiankun 生命周期埋点\n   addGlobalUncaughtErrorHandler((event, app) =&gt; {\n     tracker.track(&#39;app_load_time&#39;, {\n       app,\n       time: performance.now()\n     })\n   })\n\n---\n\n四、统一错误上报\n\n问题：\n- 子应用错误需要捕获\n- 错误需要区分来源（哪个子应用）\n- 不能让子应用错误影响主应用\n\n方案设计：\n\n1. 全局错误捕获（主应用）：\n\n   // 主应用\n   import { addGlobalUncaughtErrorHandler } from &#39;qiankun&#39;\n\n   // JS 错误捕获\n   window.addEventListener(&#39;error&#39;, (event) =&gt; {\n     const currentApp = getCurrentApp()\n\n     reportError({\n       type: &#39;js_error&#39;,\n       app: currentApp,\n       message: event.message,\n       stack: event.error?.stack,\n       url: location.href\n     })\n   })\n\n   // Promise 错误捕获\n   window.addEventListener(&#39;unhandledrejection&#39;, (event) =&gt; {\n     reportError({\n       type: &#39;promise_error&#39;,\n       app: getCurrentApp(),\n       reason: event.reason\n     })\n   })\n\n   // qiankun 应用加载错误\n   addGlobalUncaughtErrorHandler((event, app) =&gt; {\n     reportError({\n       type: &#39;app_load_error&#39;,\n       app: app.name,\n       error: event\n     })\n   })\n\n2. 子应用错误边界：\n\n   // React 子应用\n   class ErrorBoundary extends React.Component {\n     componentDidCatch(error, errorInfo) {\n       // 通过 props 上报错误\n       this.props.reportError({\n         type: &#39;react_error&#39;,\n         error: error.toString(),\n         componentStack: errorInfo.componentStack\n       })\n     }\n\n     render() {\n       if (this.state.hasError) {\n         return &lt;h1&gt;子应用出错了&lt;/h1&gt;\n       }\n       return this.props.children\n     }\n   }\n\n   // mount 时包裹\n   export function mount(props) {\n     const { reportError } = props\n\n     ReactDOM.render(\n       &lt;ErrorBoundary reportError={reportError}&gt;\n         &lt;App /&gt;\n       &lt;/ErrorBoundary&gt;,\n       container\n     )\n   }\n\n3. 错误隔离与降级：\n\n   // 主应用\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     entry: &#39;//localhost:8081&#39;,\n     loader: (loading) =&gt; {\n       if (loading) {\n         showLoading()\n       } else {\n         hideLoading()\n       }\n     }\n   }], {\n     // 错误处理\n     errorBoundary: (error, app) =&gt; {\n       // 显示降级UI\n       showErrorPage(app.name, error)\n\n       // 上报错误\n       reportError({ app: app.name, error })\n\n       // 阻止错误冒泡，保护主应用\n       return true\n     }\n   })\n\n4. 错误上报服务：\n\n   // 错误上报 SDK\n   class ErrorReporter {\n     report(error) {\n       const errorData = {\n         ...error,\n         timestamp: Date.now(),\n         userAgent: navigator.userAgent,\n         url: location.href,\n         userId: getUserId(),\n         // 区分应用来源\n         source: error.app || &#39;main-app&#39;\n       }\n\n       // 上报到监控平台（Sentry、阿里云 ARMS）\n       fetch(&#39;/api/error-report&#39;, {\n         method: &#39;POST&#39;,\n         body: JSON.stringify(errorData)\n       })\n     }\n   }\n\n---\n\n五、主子应用通信机制设计\n\n问题：\n- 主应用需要通知子应用（如登出、权限变更）\n- 子应用需要通知主应用（如标题变更、badge 更新）\n- 子应用间需要通信（如数据共享）\n\n方案对比：\n\n1. Props 传递（单向，简单场景）：\n\n   适用：主→子单向传递\n\n   // 主应用\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     props: {\n       data: { user: {} },\n       onEvent: (type, data) =&gt; { /* 主应用处理子应用事件 */ }\n     }\n   }])\n\n   // 子应用\n   export function mount(props) {\n     const { data, onEvent } = props\n\n     // 使用数据\n     console.log(props.data.user)\n\n     // 通知主应用\n     onEvent(&#39;badge-update&#39;, { count: 5 })\n   }\n\n   优点：简单直接\n   缺点：只能主→子，子应用无法主动获取最新数据\n\n2. Actions 通信（qiankun 推荐）：\n\n   适用：主↔子双向通信，状态共享\n\n   // 主应用\n   import { initGlobalState } from &#39;qiankun&#39;\n\n   const actions = initGlobalState({\n     user: { name: &#39;张三&#39; },\n     token: &#39;xxx&#39;,\n     theme: &#39;dark&#39;\n   })\n\n   // 监听变化\n   actions.onGlobalStateChange((state, prev) =&gt; {\n     console.log(&#39;状态变化&#39;, state, prev)\n   })\n\n   // 修改状态\n   actions.setGlobalState({ user: { name: &#39;李四&#39; } })\n\n   // 传递给子应用\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     props: { actions }\n   }])\n\n   // 子应用\n   let globalActions\n\n   export function mount(props) {\n     globalActions = props.actions\n\n     // 监听变化\n     globalActions.onGlobalStateChange((state, prev) =&gt; {\n       // 更新本地状态\n       store.commit(&#39;SET_USER&#39;, state.user)\n     })\n\n     // 修改全局状态\n     globalActions.setGlobalState({ theme: &#39;light&#39; })\n   }\n\n   优点：双向通信，状态同步\n   缺点：耦合度较高\n\n3. EventBus（自定义事件）：\n\n   适用：松耦合通信，跨应用事件\n\n   // 事件总线（主应用创建）\n   class EventBus {\n     constructor() {\n       this.events = {}\n     }\n\n     on(event, callback) {\n       if (!this.events[event]) {\n         this.events[event] = []\n       }\n       this.events[event].push(callback)\n     }\n\n     emit(event, data) {\n       if (this.events[event]) {\n         this.events[event].forEach(cb =&gt; cb(data))\n       }\n     }\n\n     off(event, callback) {\n       if (this.events[event]) {\n         this.events[event] = this.events[event].filter(cb =&gt; cb !== callback)\n       }\n     }\n   }\n\n   const eventBus = new EventBus()\n\n   // 主应用\n   eventBus.on(&#39;logout&#39;, () =&gt; {\n     // 处理登出\n   })\n\n   registerMicroApps([{\n     props: { eventBus }\n   }])\n\n   // 子应用1发布\n   export function mount(props) {\n     const { eventBus } = props\n     eventBus.emit(&#39;logout&#39;)\n   }\n\n   // 子应用2订阅\n   export function mount(props) {\n     const { eventBus } = props\n     eventBus.on(&#39;logout&#39;, () =&gt; {\n       // 响应登出\n     })\n   }\n\n   优点：松耦合，灵活\n   缺点：难以追踪，调试困难\n\n4. SharedWorker（跨标签页通信）：\n\n   适用：多标签页数据同步\n\n   const worker = new SharedWorker(&#39;/shared-worker.js&#39;)\n\n   // 发送消息\n   worker.port.postMessage({ type: &#39;update&#39;, data: {} })\n\n   // 接收消息\n   worker.port.onmessage = (e) =&gt; {\n     console.log(e.data)\n   }\n\n5. LocalStorage + 监听（简单场景）：\n\n   // 主应用\n   localStorage.setItem(&#39;global_message&#39;, JSON.stringify({ type: &#39;logout&#39; }))\n\n   // 子应用监听\n   window.addEventListener(&#39;storage&#39;, (e) =&gt; {\n     if (e.key === &#39;global_message&#39;) {\n       const message = JSON.parse(e.newValue)\n       handleMessage(message)\n     }\n   })\n\n---\n\n通信机制选择建议：\n\n| 场景 | 推荐方案 | 理由 |\n|------|---------|------|\n| 主→子传递初始数据 | Props | 简单直接 |\n| 主↔子双向通信 | Actions | 官方推荐，状态同步 |\n| 子→主事件通知 | Props回调 | 简单场景 |\n| 子↔子通信 | EventBus | 解耦 |\n| 跨标签页通信 | SharedWorker / BroadcastChannel | 浏览器原生能力 |\n| 复杂状态管理 | Redux + 共享store | 统一状态管理 |\n\n最佳实践：\n✅ 优先使用 qiankun Actions（官方方案）\n✅ 状态最小化（只共享必要的状态）\n✅ 单向数据流（主应用是唯一数据源）\n✅ 避免频繁通信（性能开销）\n✅ 清理监听器（unmount 时off）\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br></div></div><hr><h3 id="_3-微前端部署与发布" tabindex="-1"><a class="header-anchor" href="#_3-微前端部署与发布" aria-hidden="true">#</a> 3. 微前端部署与发布</h3><p>讲清楚&quot;资源加载、预加载、灰度发布、回滚&quot;在微前端架构里的方案设计。</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>一、资源加载方案\n\n问题：\n- 子应用资源如何加载（JS、CSS、图片）\n- 资源路径如何处理（相对路径 vs 绝对路径）\n- 如何避免资源404\n\n方案设计：\n\n1. HTML Entry（qiankun 推荐）：\n\n   原理：加载子应用的 HTML，提取其中的 JS/CSS\n\n   优点：\n   ✅ 与子应用部署方式一致\n   ✅ 支持相对路径自动转换\n   ✅ 支持动态脚本、样式\n\n   // qiankun 使用\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     entry: &#39;http://localhost:8081&#39;,  // HTML 地址\n     container: &#39;#container&#39;\n   }])\n\n   加载流程：\n   1. 主应用请求 http://localhost:8081/index.html\n   2. qiankun 解析 HTML，提取 \\&lt;script\\&gt;、&lt;link&gt;\n   3. 提取的资源相对路径转绝对路径\n   4. 按顺序加载 JS/CSS\n   5. 执行 JS，调用生命周期函数\n\n2. JS Entry（传统方案）：\n\n   原理：直接加载子应用的 JS 入口文件\n\n   // single-spa 使用\n   registerApplication({\n     name: &#39;app1&#39;,\n     app: () =&gt; System.import(&#39;http://localhost:8081/main.js&#39;)\n   })\n\n   要求：\n   - 子应用必须打包为 UMD 格式\n   - 需要手动处理 CSS 加载\n   - 需要配置 publicPath（资源路径）\n\n   // webpack.config.js（子应用）\n   output: {\n     library: &#39;app1&#39;,\n     libraryTarget: &#39;umd&#39;,\n     publicPath: &#39;http://localhost:8081/&#39;  // 必须配置\n   }\n\n3. 资源路径处理：\n\n   问题：子应用使用相对路径导致 404\n\n   // 子应用代码\n   &lt;img src=&quot;./assets/logo.png&quot; /&gt;\n   ↓ 实际请求\n   http://main.com/assets/logo.png  // ❌ 错误（主应用域名）\n\n   解决方案：\n\n   方案1：配置 publicPath（编译时）\n   // webpack.config.js\n   output: {\n     publicPath: process__.env.NODE_ENV === &#39;production&#39;\n       ? &#39;https://cdn.app1.com/&#39;\n       : &#39;http://localhost:8081/&#39;\n   }\n\n   方案2：动态 publicPath（运行时）\n   // 子应用入口文件\n   if (window.__POWERED_BY_QIANKUN__) {\n     __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__\n   }\n\n   方案3：使用绝对路径（推荐）\n   &lt;img src=&quot;https://cdn.app1.com/assets/logo.png&quot; /&gt;\n\n4. 按需加载：\n\n   // React 懒加载\n   const OrderList = React.lazy(() =&gt; import(&#39;./OrderList&#39;))\n\n   &lt;Suspense fallback={&lt;Loading /&gt;}&gt;\n     &lt;OrderList /&gt;\n   &lt;/Suspense&gt;\n\n   注意：路由懒加载也需要配置 publicPath\n\n---\n\n二、预加载方案\n\n问题：\n- 首次进入子应用白屏时间长\n- 用户体验差\n\n方案设计：\n\n1. qiankun 预加载（prefetch）：\n\n   // 启动时配置\n   start({\n     prefetch: true  // 默认 true\n   })\n\n   策略：\n   - prefetch: true\n     → 第一个子应用加载完成后，自动预加载其他子应用\n\n   - prefetch: &#39;all&#39;\n     → 主应用 mounted 后，立即预加载所有子应用\n\n   - prefetch: [&#39;app1&#39;, &#39;app2&#39;]\n     → 只预加载指定子应用\n\n   - prefetch: (apps) =&gt; { /* 自定义策略 */ }\n     → 自定义预加载逻辑\n\n2. 手动预加载：\n\n   import { prefetchApps } from &#39;qiankun&#39;\n\n   // 鼠标悬停时预加载\n   &lt;MenuItem\n     onMouseEnter={() =&gt; prefetchApps([&#39;app1&#39;])}\n     onClick={() =&gt; navigateTo(&#39;/app1&#39;)}\n   &gt;\n     订单管理\n   &lt;/MenuItem&gt;\n\n   // 空闲时预加载\n   if (&#39;requestIdleCallback&#39; in window) {\n     requestIdleCallback(() =&gt; {\n       prefetchApps([&#39;app1&#39;, &#39;app2&#39;])\n     })\n   }\n\n3. 预加载优化策略：\n\n   策略1：核心应用优先\n   prefetchApps([&#39;order-app&#39;], {\n     fetch: (url) =&gt; fetch(url, { priority: &#39;high&#39; })\n   })\n\n   策略2：网络状况判断\n   if (navigator.connection.effectiveType === &#39;4g&#39;) {\n     prefetchApps([&#39;app1&#39;, &#39;app2&#39;])\n   } else {\n     // 弱网不预加载\n   }\n\n   策略3：分时预加载\n   setTimeout(() =&gt; prefetchApps([&#39;app1&#39;]), 3000)  // 3秒后\n   setTimeout(() =&gt; prefetchApps([&#39;app2&#39;]), 6000)  // 6秒后\n\n4. Service Worker 缓存：\n\n   // sw.js\n   self.addEventListener(&#39;install&#39;, (event) =&gt; {\n     event.waitUntil(\n       caches.open(&#39;micro-app-cache&#39;).then((cache) =&gt; {\n         return cache.addAll([\n           &#39;http://localhost:8081/main.js&#39;,\n           &#39;http://localhost:8081/vendor.js&#39;\n         ])\n       })\n     )\n   })\n\n   // 拦截请求\n   self.addEventListener(&#39;fetch&#39;, (event) =&gt; {\n     event.respondWith(\n       caches.match(event.request).then((response) =&gt; {\n         return response || fetch(event.request)\n       })\n     )\n   })\n\n5. HTTP/2 Server Push：\n\n   // Nginx 配置\n   location / {\n     http2_push /app1/main.js;\n     http2_push /app1/vendor.js;\n   }\n\n---\n\n三、灰度发布方案\n\n问题：\n- 新版本需要灰度测试\n- 出问题需要快速回滚\n- 不同用户看到不同版本\n\n方案设计：\n\n1. 基于用户的灰度（推荐）：\n\n   架构：\n   ┌─────────────┐\n   │  用户访问    │\n   └──────┬──────┘\n          ↓\n   ┌─────────────┐\n   │ 主应用       │\n   │ ├─ 灰度规则  │  ← 从配置中心获取\n   │ └─ 动态路由  │\n   └──────┬──────┘\n          ↓\n     根据规则加载不同版本\n          ↓\n   ┌──────────────────┐\n   │ 10% 用户 → V2    │  新版本\n   │ 90% 用户 → V1    │  老版本\n   └──────────────────┘\n\n   实现：\n   // 主应用\n   const getAppEntry = (appName) =&gt; {\n     const userId = getUserId()\n     const grayConfig = await fetch(&#39;/api/gray-config&#39;).then(r =&gt; r.json())\n\n     // 判断用户是否在灰度名单\n     if (isInGrayList(userId, grayConfig)) {\n       return `https://app1-v2.example.com`  // 新版本\n     } else {\n       return `https://app1-v1.example.com`  // 老版本\n     }\n   }\n\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     entry: await getAppEntry(&#39;app1&#39;),\n     container: &#39;#container&#39;\n   }])\n\n   灰度规则（配置中心）：\n   {\n     &quot;app1&quot;: {\n       &quot;version&quot;: &quot;v2&quot;,\n       &quot;grayType&quot;: &quot;user&quot;,\n       &quot;grayList&quot;: [&quot;user_1&quot;, &quot;user_2&quot;],  // 白名单\n       &quot;grayPercent&quot;: 10  // 10% 流量\n     }\n   }\n\n2. 基于流量百分比：\n\n   // 主应用\n   const getAppEntry = (appName) =&gt; {\n     const random = Math.random() * 100\n     const grayPercent = getGrayPercent(appName)  // 从配置中心获取\n\n     if (random &lt; grayPercent) {\n       return `https://app1-v2.example.com`  // 10% 流量\n     } else {\n       return `https://app1-v1.example.com`  // 90% 流量\n     }\n   }\n\n3. 基于特征的灰度（AB测试）：\n\n   const getAppEntry = (appName) =&gt; {\n     const user = getUserInfo()\n\n     // 灰度规则\n     const rules = {\n       // VIP 用户优先体验新版本\n       vip: user.vip &amp;&amp; random() &lt; 0.5,\n       // 特定城市灰度\n       city: user.city === &#39;北京&#39;,\n       // 特定浏览器灰度\n       browser: /Chrome/.test(navigator.userAgent)\n     }\n\n     if (Object.values(rules).some(v =&gt; v)) {\n       return `https://app1-v2.example.com`\n     }\n     return `https://app1-v1.example.com`\n   }\n\n4. Nginx 层灰度（运维方案）：\n\n   # nginx.conf\n   upstream app1_v1 {\n     server app1-v1.example.com;\n   }\n\n   upstream app1_v2 {\n     server app1-v2.example.com;\n   }\n\n   # 根据 cookie 分流\n   map $cookie_version $app1_backend {\n     &quot;v2&quot; app1_v2;\n     default app1_v1;\n   }\n\n   location /app1/ {\n     proxy_pass http://$app1_backend;\n   }\n\n5. CDN 灰度（阿里云 CDN）：\n\n   - 配置 CDN 灰度规则\n   - 根据 IP、地域、比例分流\n   - 无需修改代码\n\n---\n\n四、回滚方案\n\n问题：\n- 新版本有 Bug 需要快速回滚\n- 不能影响用户体验\n\n方案设计：\n\n1. 配置中心秒级回滚（推荐）：\n\n   架构：\n   ┌──────────────┐\n   │ 配置中心      │  ← 修改配置\n   │ app1: v2 → v1 │\n   └───────┬──────┘\n           ↓ 实时推送（WebSocket）\n   ┌──────────────┐\n   │ 主应用        │\n   │ ├─ 监听配置   │\n   │ └─ 动态切换   │\n   └───────┬──────┘\n           ↓\n   重新加载子应用（使用 v1）\n\n   实现：\n   // 主应用\n   let currentVersion = {}\n\n   // 监听配置变化（WebSocket）\n   ws.on(&#39;config-change&#39;, (config) =&gt; {\n     const { app, version } = config\n\n     if (currentVersion[app] !== version) {\n       // 卸载旧版本\n       unmountMicroApp(app)\n\n       // 加载新版本\n       const entry = `https://${app}-${version}.example.com`\n       registerMicroApps([{\n         name: app,\n         entry,\n         container: &#39;#container&#39;\n       }])\n\n       // 刷新当前页面\n       if (isAppActive(app)) {\n         location.reload()\n       }\n\n       currentVersion[app] = version\n     }\n   })\n\n   // 配置中心（管理后台）\n   回滚操作：\n   1. 点击&quot;回滚&quot;按钮\n   2. 配置中心修改配置：app1.version = &quot;v1&quot;\n   3. WebSocket 推送到所有主应用\n   4. 主应用自动切换到 v1\n\n   耗时：&lt; 5秒\n\n2. CDN 回滚：\n\n   方案1：切换CDN源\n   // 修改 CDN 回源地址\n   app1.example.com → app1-v1.example.com\n\n   方案2：修改 DNS\n   app1.example.com A 记录\n   1.2.3.4 (v2) → 5.6.7.8 (v1)\n\n   缺点：DNS 生效时间长（TTL）\n\n3. 版本管理策略：\n\n   策略1：保留历史版本（推荐）\n   ├── app1-v1.0.0/\n   ├── app1-v1.0.1/\n   ├── app1-v1.1.0/  ← 当前版本\n   └── app1-v1.2.0/  ← 灰度版本\n\n   回滚：修改配置指向 v1.1.0\n\n   策略2：蓝绿部署\n   ├── app1-blue/  ← 当前生产版本\n   └── app1-green/ ← 新版本\n\n   发布：切换流量 blue → green\n   回滚：切换流量 green → blue\n\n   策略3：金丝雀发布\n   10% 流量 → v2\n   90% 流量 → v1\n\n   如果 v2 有问题，停止灰度，100% 流量 → v1\n\n4. 应用级回滚：\n\n   // 主应用提供降级UI\n   const FallbackApp = () =&gt; (\n     &lt;div&gt;\n       &lt;h1&gt;子应用加载失败&lt;/h1&gt;\n       &lt;Button onClick={() =&gt; loadBackupVersion()}&gt;\n         加载备用版本\n       &lt;/Button&gt;\n     &lt;/div&gt;\n   )\n\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     entry: &#39;https://app1-v2.example.com&#39;,\n     loader: (loading) =&gt; {\n       if (error) {\n         // 自动降级到 v1\n         return loadApp(&#39;https://app1-v1.example.com&#39;)\n       }\n     }\n   }])\n\n5. 监控与自动回滚：\n\n   // 监控错误率\n   const errorRate = getErrorRate(&#39;app1&#39;)\n\n   if (errorRate &gt; 5%) {  // 错误率超过5%\n     // 自动回滚\n     rollback(&#39;app1&#39;, &#39;v1&#39;)\n\n     // 告警通知\n     notify(&#39;app1 错误率过高，已自动回滚&#39;)\n   }\n\n---\n\n最佳实践总结：\n\n资源加载：\n✅ 使用 HTML Entry（qiankun）\n✅ 配置 publicPath 避免 404\n✅ 使用 CDN 加速\n✅ 启用 HTTP/2\n\n预加载：\n✅ qiankun prefetch 开启\n✅ 核心应用优先预加载\n✅ 使用 Service Worker 缓存\n✅ 弱网环境不预加载\n\n灰度发布：\n✅ 配置中心管理灰度规则\n✅ 支持用户维度 + 流量百分比\n✅ 小流量开始（1% → 10% → 50% → 100%）\n✅ 实时监控灰度效果\n\n回滚：\n✅ 配置中心秒级回滚\n✅ 保留历史版本\n✅ 监控自动回滚\n✅ 降级预案\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br></div></div><hr><h3 id="_4-子应用性能治理" tabindex="-1"><a class="header-anchor" href="#_4-子应用性能治理" aria-hidden="true">#</a> 4. 子应用性能治理</h3><p>如果子应用性能差拖垮主应用，你会怎么隔离与治理？如何监控、降级、容错？</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>一、性能隔离方案\n\n问题：\n- 子应用 JS 执行慢，阻塞主应用\n- 子应用内存泄漏\n- 子应用频繁触发重渲染\n\n隔离策略：\n\n1. 时间片隔离（防止长任务阻塞）：\n\n   // 主应用：限制子应用 JS 执行时间\n   const executeWithTimeLimit = (fn, timeout = 50) =&gt; {\n     return new Promise((resolve, reject) =&gt; {\n       const timer = setTimeout(() =&gt; {\n         reject(new Error(&#39;子应用执行超时&#39;))\n       }, timeout)\n\n       try {\n         const result = fn()\n         clearTimeout(timer)\n         resolve(result)\n       } catch (e) {\n         clearTimeout(timer)\n         reject(e)\n       }\n     })\n   }\n\n   // 监控子应用挂载时间\n   const startTime = performance.now()\n   await mount()\n   const mountTime = performance.now() - startTime\n\n   if (mountTime &gt; 3000) {  // 超过3秒\n     reportPerformance({\n       app: &#39;app1&#39;,\n       type: &#39;slow_mount&#39;,\n       time: mountTime\n     })\n   }\n\n2. CPU 隔离（Web Worker）：\n\n   // 将子应用耗时计算放到 Worker\n   // main.js\n   const worker = new Worker(&#39;heavy-compute.worker.js&#39;)\n\n   worker.postMessage({ data: largeData })\n   worker.onmessage = (e) =&gt; {\n     console.log(&#39;计算结果:&#39;, e.data)\n   }\n\n   // heavy-compute.worker.js\n   self.onmessage = (e) =&gt; {\n     const result = expensiveCompute(e.data)\n     self.postMessage(result)\n   }\n\n3. 内存隔离（iframe）：\n\n   // 对于性能特别差的子应用，降级使用 iframe\n   const loadAppInIframe = (app) =&gt; {\n     const iframe = document.createElement(&#39;iframe&#39;)\n     iframe.src = app.entry\n     iframe.style.width = &#39;100%&#39;\n     iframe.style.height = &#39;100%&#39;\n     document.getElementById(&#39;container&#39;).appendChild(iframe)\n   }\n\n   // 卸载时销毁 iframe（释放内存）\n   const destroyIframe = () =&gt; {\n     iframe.remove()\n     iframe = null\n   }\n\n4. 资源隔离（限流）：\n\n   // 限制子应用同时请求数\n   class RequestLimiter {\n     constructor(maxConcurrent = 6) {\n       this.maxConcurrent = maxConcurrent\n       this.currentCount = 0\n       this.queue = []\n     }\n\n     async request(url) {\n       if (this.currentCount &gt;= this.maxConcurrent) {\n         await new Promise(resolve =&gt; this.queue.push(resolve))\n       }\n\n       this.currentCount++\n       try {\n         const response = await fetch(url)\n         return response\n       } finally {\n         this.currentCount--\n         if (this.queue.length &gt; 0) {\n           this.queue.shift()()\n         }\n       }\n     }\n   }\n\n   const limiter = new RequestLimiter(3)  // 限制3个并发\n\n---\n\n二、性能监控方案\n\n1. 加载性能监控：\n\n   // qiankun 生命周期监控\n   registerMicroApps([{\n     name: &#39;app1&#39;,\n     entry: &#39;//localhost:8081&#39;,\n     loader: (loading) =&gt; {\n       if (loading) {\n         window.__APP_LOAD_START__ = performance.now()\n       } else {\n         const loadTime = performance.now() - window.__APP_LOAD_START__\n\n         // 上报加载时间\n         reportMetric({\n           app: &#39;app1&#39;,\n           metric: &#39;load_time&#39;,\n           value: loadTime,\n           level: loadTime &gt; 3000 ? &#39;error&#39; : &#39;info&#39;\n         })\n       }\n     }\n   }])\n\n2. 运行时性能监控：\n\n   // FPS 监控\n   class FPSMonitor {\n     constructor() {\n       this.fps = 0\n       this.lastTime = performance.now()\n       this.frames = 0\n     }\n\n     tick() {\n       this.frames++\n       const now = performance.now()\n\n       if (now &gt;= this.lastTime + 1000) {\n         this.fps = Math.round((this.frames * 1000) / (now - this.lastTime))\n         this.frames = 0\n         this.lastTime = now\n\n         // FPS 过低告警\n         if (this.fps &lt; 30) {\n           reportPerformance({\n             type: &#39;low_fps&#39;,\n             fps: this.fps,\n             app: getCurrentApp()\n           })\n         }\n       }\n\n       requestAnimationFrame(() =&gt; this.tick())\n     }\n   }\n\n   const fpsMonitor = new FPSMonitor()\n   fpsMonitor.tick()\n\n3. 内存监控：\n\n   // 监控子应用内存占用\n   const monitorMemory = () =&gt; {\n     if (performance.memory) {\n       const { usedJSHeapSize, totalJSHeapSize } = performance.memory\n       const usage = (usedJSHeapSize / totalJSHeapSize * 100).toFixed(2)\n\n       // 内存占用过高告警\n       if (usage &gt; 90) {\n         reportPerformance({\n           type: &#39;high_memory&#39;,\n           usage,\n           app: getCurrentApp()\n         })\n       }\n     }\n   }\n\n   setInterval(monitorMemory, 10000)  // 每10秒检测\n\n4. 长任务监控：\n\n   // PerformanceObserver 监控长任务\n   const observer = new PerformanceObserver((list) =&gt; {\n     for (const entry of list.getEntries()) {\n       // 超过50ms的任务被认为是长任务\n       if (entry.duration &gt; 50) {\n         reportPerformance({\n           type: &#39;long_task&#39;,\n           duration: entry.duration,\n           app: getCurrentApp(),\n           startTime: entry.startTime\n         })\n       }\n     }\n   })\n\n   observer.observe({ entryTypes: [&#39;longtask&#39;] })\n\n5. 接口性能监控：\n\n   // 拦截子应用请求，监控接口性能\n   const originalFetch = window.fetch\n   window.fetch = async (...args) =&gt; {\n     const startTime = performance.now()\n     const url = args[0]\n\n     try {\n       const response = await originalFetch(...args)\n       const duration = performance.now() - startTime\n\n       // 慢接口告警（&gt; 3秒）\n       if (duration &gt; 3000) {\n         reportPerformance({\n           type: &#39;slow_api&#39;,\n           url,\n           duration,\n           app: getCurrentApp()\n         })\n       }\n\n       return response\n     } catch (error) {\n       reportPerformance({\n         type: &#39;api_error&#39;,\n         url,\n         error: error.message,\n         app: getCurrentApp()\n       })\n       throw error\n     }\n   }\n\n6. 用户体验监控（Web Vitals）：\n\n   import { getCLS, getFID, getFCP, getLCP, getTTFB } from &#39;web-vitals&#39;\n\n   // 监控核心性能指标\n   getCLS(metric =&gt; reportMetric(&#39;CLS&#39;, metric.value))  // 累计布局偏移\n   getFID(metric =&gt; reportMetric(&#39;FID&#39;, metric.value))  // 首次输入延迟\n   getFCP(metric =&gt; reportMetric(&#39;FCP&#39;, metric.value))  // 首次内容绘制\n   getLCP(metric =&gt; reportMetric(&#39;LCP&#39;, metric.value))  // 最大内容绘制\n   getTTFB(metric =&gt; reportMetric(&#39;TTFB&#39;, metric.value)) // 首字节时间\n\n---\n\n三、降级方案\n\n1. 超时降级：\n\n   // 子应用加载超时，显示降级UI\n   const loadAppWithTimeout = async (app, timeout = 10000) =&gt; {\n     return Promise.race([\n       loadMicroApp(app),\n       new Promise((_, reject) =&gt; {\n         setTimeout(() =&gt; reject(new Error(&#39;加载超时&#39;)), timeout)\n       })\n     ]).catch((error) =&gt; {\n       // 降级：显示静态页面\n       showFallbackUI(app.name)\n\n       reportError({\n         app: app.name,\n         type: &#39;load_timeout&#39;,\n         error\n       })\n     })\n   }\n\n   const showFallbackUI = (appName) =&gt; {\n     const container = document.getElementById(&#39;container&#39;)\n     container.innerHTML = `\n       &lt;div class=&quot;fallback&quot;&gt;\n         &lt;h2&gt;${appName} 加载失败&lt;/h2&gt;\n         &lt;button onclick=&quot;retryLoad()&quot;&gt;重试&lt;/button&gt;\n         &lt;button onclick=&quot;useBasicVersion()&quot;&gt;使用基础版本&lt;/button&gt;\n       &lt;/div&gt;\n     `\n   }\n\n2. 错误降级：\n\n   // 子应用运行时错误，降级处理\n   addGlobalUncaughtErrorHandler((event, app) =&gt; {\n     const errorCount = getErrorCount(app.name)\n\n     if (errorCount &gt; 3) {  // 错误次数超过3次\n       // 降级：卸载子应用\n       unmountMicroApp(app.name)\n\n       // 显示降级UI\n       showDegradedUI(app.name)\n\n       // 告警\n       alertDevelopers({\n         app: app.name,\n         reason: &#39;错误率过高，已自动降级&#39;\n       })\n     }\n   })\n\n3. 性能降级：\n\n   // 根据性能指标动态降级\n   const performanceGrade = getPerformanceGrade()\n\n   if (performanceGrade === &#39;poor&#39;) {\n     // 降级策略\n     - 禁用动画\n     - 减少轮询频率\n     - 延迟加载非核心模块\n     - 降低渲染精度\n\n     registerMicroApps([{\n       name: &#39;app1&#39;,\n       props: {\n         enableAnimation: false,  // 禁用动画\n         pollingInterval: 10000,  // 轮询间隔延长\n         lazyLoad: true           // 懒加载\n       }\n     }])\n   }\n\n4. 设备降级：\n\n   // 低端设备降级\n   const isLowEndDevice = () =&gt; {\n     // 内存小于4GB\n     const memory = navigator.deviceMemory\n     if (memory &amp;&amp; memory &lt; 4) return true\n\n     // CPU核心数少于4\n     const cores = navigator.hardwareConcurrency\n     if (cores &amp;&amp; cores &lt; 4) return true\n\n     return false\n   }\n\n   if (isLowEndDevice()) {\n     // 降级：使用轻量版本\n     registerMicroApps([{\n       name: &#39;app1&#39;,\n       entry: &#39;https://app1-lite.example.com&#39;  // 轻量版\n     }])\n   }\n\n---\n\n四、容错方案\n\n1. 错误边界（React）：\n\n   // 主应用错误边界\n   class MicroAppErrorBoundary extends React.Component {\n     constructor(props) {\n       super(props)\n       this.state = { hasError: false, error: null }\n     }\n\n     static getDerivedStateFromError(error) {\n       return { hasError: true, error }\n     }\n\n     componentDidCatch(error, errorInfo) {\n       // 上报错误\n       reportError({\n         app: this.props.appName,\n         error: error.toString(),\n         errorInfo\n       })\n\n       // 尝试重新加载\n       this.retryCount = (this.retryCount || 0) + 1\n       if (this.retryCount &lt; 3) {\n         setTimeout(() =&gt; {\n           this.setState({ hasError: false })\n           this.forceUpdate()\n         }, 2000)\n       }\n     }\n\n     render() {\n       if (this.state.hasError) {\n         return (\n           &lt;div&gt;\n             &lt;h2&gt;子应用出错了&lt;/h2&gt;\n             &lt;button onClick={() =&gt; location.reload()}&gt;刷新页面&lt;/button&gt;\n           &lt;/div&gt;\n         )\n       }\n       return this.props.children\n     }\n   }\n\n2. 资源加载容错：\n\n   // 子应用 JS 加载失败，尝试备用CDN\n   const loadScriptWithFallback = (src, fallbackSrc) =&gt; {\n     return new Promise((resolve, reject) =&gt; {\n       const script = document.createElement(&#39;script&#39;)\n       script.src = src\n\n       script.onload = resolve\n       script.onerror = () =&gt; {\n         console.log(&#39;主CDN加载失败，尝试备用CDN&#39;)\n\n         // 移除失败的script\n         script.remove()\n\n         // 尝试备用CDN\n         const fallbackScript = document.createElement(&#39;script&#39;)\n         fallbackScript.src = fallbackSrc\n         fallbackScript.onload = resolve\n         fallbackScript.onerror = reject\n         document.head.appendChild(fallbackScript)\n       }\n\n       document.head.appendChild(script)\n     })\n   }\n\n   // 使用\n   loadScriptWithFallback(\n     &#39;https://cdn1.example.com/app1.js&#39;,\n     &#39;https://cdn2.example.com/app1.js&#39;  // 备用CDN\n   )\n\n3. 接口容错：\n\n   // 子应用接口失败，重试机制\n   const fetchWithRetry = async (url, options = {}, retries = 3) =&gt; {\n     for (let i = 0; i &lt; retries; i++) {\n       try {\n         const response = await fetch(url, options)\n         if (response.ok) {\n           return response\n         }\n       } catch (error) {\n         if (i === retries - 1) throw error\n\n         // 指数退避\n         await new Promise(r =&gt; setTimeout(r, Math.pow(2, i) * 1000))\n       }\n     }\n   }\n\n4. 状态容错：\n\n   // 子应用状态异常，自动恢复\n   const recoverState = (app) =&gt; {\n     try {\n       // 尝试从 localStorage 恢复状态\n       const savedState = localStorage.getItem(`${app}_state`)\n       if (savedState) {\n         return JSON.parse(savedState)\n       }\n     } catch (error) {\n       // 恢复失败，使用默认状态\n       return getDefaultState()\n     }\n   }\n\n5. 自动重启：\n\n   // 子应用崩溃自动重启\n   let crashCount = 0\n   const MAX_CRASH_COUNT = 3\n\n   addGlobalUncaughtErrorHandler((event, app) =&gt; {\n     crashCount++\n\n     if (crashCount &lt; MAX_CRASH_COUNT) {\n       // 自动重启\n       setTimeout(() =&gt; {\n         unmountMicroApp(app.name)\n         loadMicroApp({\n           name: app.name,\n           entry: app.entry,\n           container: app.container\n         })\n\n         console.log(`子应用 ${app.name} 已自动重启`)\n       }, 1000)\n     } else {\n       // 重启次数过多，放弃\n       showFatalError(app.name)\n     }\n   })\n\n---\n\n五、性能优化建议\n\n1. 子应用优化：\n\n   ✅ 代码分割（React.lazy、Vue异步组件）\n   ✅ 按需加载（路由懒加载）\n   ✅ Tree Shaking（移除未使用代码）\n   ✅ 压缩打包（Gzip、Brotli）\n   ✅ CDN 加速\n   ✅ 图片懒加载、压缩\n   ✅ 减少依赖体积（使用 lodash-es、day.js）\n   ✅ Service Worker 缓存\n\n2. 主应用优化：\n\n   ✅ 预加载核心子应用\n   ✅ 虚拟滚动（大列表）\n   ✅ 防抖节流（高频事件）\n   ✅ Web Worker（耗时计算）\n   ✅ CSS 隔离（避免样式冲突）\n\n3. 通信优化：\n\n   ✅ 减少跨应用通信频率\n   ✅ 批量更新（合并多次setState）\n   ✅ 使用 throttle/debounce\n\n---\n\n完整的性能治理体系：\n\n┌─────────────────────────────────┐\n│        监控层（Monitoring）       │\n│  ├─ 加载性能（Load Time）         │\n│  ├─ 运行时性能（FPS、Memory）     │\n│  ├─ 接口性能（API Time）          │\n│  └─ 用户体验（Web Vitals）        │\n└────────────┬────────────────────┘\n             ↓ 发现问题\n┌─────────────────────────────────┐\n│        告警层（Alerting）         │\n│  ├─ 性能告警（超时、卡顿）         │\n│  ├─ 错误告警（崩溃、404）          │\n│  └─ 自动通知（钉钉、邮件）         │\n└────────────┬────────────────────┘\n             ↓ 触发策略\n┌─────────────────────────────────┐\n│        降级层（Degradation）      │\n│  ├─ 超时降级（静态页面）           │\n│  ├─ 错误降级（基础版本）           │\n│  ├─ 性能降级（减少动画）           │\n│  └─ 设备降级（轻量版）             │\n└────────────┬────────────────────┘\n             ↓ 保障可用性\n┌─────────────────────────────────┐\n│        容错层（Fault Tolerance）  │\n│  ├─ 错误边界（Error Boundary）    │\n│  ├─ 自动重试（Retry）             │\n│  ├─ 备用方案（Fallback）          │\n│  └─ 自动恢复（Recovery）          │\n└─────────────────────────────────┘\n\n最终目标：\n✅ 子应用问题不影响主应用\n✅ 用户无感知降级\n✅ 问题自动发现、自动降级、自动恢复\n✅ 开发者及时收到告警\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br></div></div><hr>',33),r={},p=(0,a(3744).Z)(r,[["render",function(n,s){return e}]])}}]);