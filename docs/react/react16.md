# åäº”åˆ†é’Ÿè¯»æ‡‚ React 16

## å…³è”é¢è¯•å¡ï¼ˆå¿«é€Ÿè·³è½¬ï¼‰

- æŠ€æœ¯å¡ï¼š[`tech__react`](../interview-prep/tech__react.md#åŸç†ç®€è¿°)
- æ€§èƒ½æ–¹æ³•è®ºï¼š[`tech__performance`](../interview-prep/tech__performance.md#åŸç†ç®€è¿°)

å½“ç„¶ï¼è™½ç„¶ React 16 å‘å¸ƒäº 2017 å¹´ï¼ˆè·ä»Šå·²æœ‰æ•°å¹´ï¼‰ï¼Œä½†å®ƒå¼•å…¥äº†**é©å‘½æ€§çš„æ¶æ„å˜é©**ï¼Œæ˜¯ç†è§£ç°ä»£ Reactï¼ˆåŒ…æ‹¬ React 18+ï¼‰çš„åŸºç¡€ã€‚ç”¨ **15 åˆ†é’Ÿ**å¸¦ä½ æŠ“ä½ React 16 çš„**æ ¸å¿ƒçªç ´**ï¼Œå°¤å…¶é€‚åˆä½ è¿™æ ·ç†Ÿæ‚‰ React ä½†æƒ³ç³»ç»Ÿæ¢³ç†åº•å±‚æ¼”è¿›çš„å‰ç«¯å¼€å‘è€…ã€‚

---

## ä¸€ã€React 16 çš„ä¸‰å¤§é‡Œç¨‹ç¢‘å¼å‡çº§

### âœ… 1. **Fiber æ¶æ„**ï¼ˆæ ¸å¿ƒåº•å±‚é‡æ„ï¼‰

- **é—®é¢˜**ï¼šReact 15 åŠä¹‹å‰ä½¿ç”¨**é€’å½’è°ƒå’Œï¼ˆReconciliationï¼‰**ï¼Œä¸€æ—¦å¼€å§‹æ›´æ–°ï¼Œå¿…é¡»**åŒæ­¥å®Œæˆæ•´ä¸ªç»„ä»¶æ ‘çš„ diff å’Œ DOM æ“ä½œ**ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´å¡é¡¿ï¼ˆå¦‚è¾“å…¥å¡ã€åŠ¨ç”»æ‰å¸§ï¼‰ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼šå¼•å…¥ **Fiberï¼ˆFiber Reconcilerï¼‰**ï¼Œå°†æ›´æ–°è¿‡ç¨‹**æ‹†åˆ†ä¸ºå¯ä¸­æ–­ã€å¯æ¢å¤çš„å·¥ä½œå•å…ƒï¼ˆfiber èŠ‚ç‚¹ï¼‰**ã€‚
  - åˆ©ç”¨ **requestIdleCallback**ï¼ˆæˆ– polyfillï¼‰åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œï¼›
  - æ”¯æŒ**ä¼˜å…ˆçº§è°ƒåº¦**ï¼ˆé«˜ä¼˜å…ˆçº§ä»»åŠ¡å¦‚ç”¨æˆ·è¾“å…¥å¯æ‰“æ–­ä½ä¼˜å…ˆçº§å¦‚æ•°æ®åŠ è½½ï¼‰ï¼›
  - ä¸º**å¼‚æ­¥æ¸²æŸ“ï¼ˆAsync Renderingï¼‰** å¥ å®šåŸºç¡€ï¼ˆåç»­çš„ Suspenseã€Concurrent Mode éƒ½ä¾èµ–å®ƒï¼‰ã€‚

> ğŸ” æœ¬è´¨ï¼šFiber æ˜¯ä¸€ç§**å¸¦ä¼˜å…ˆçº§çš„å¢é‡æ¸²æŸ“æœºåˆ¶**ï¼Œè®© React ä»â€œä¸€æ¬¡æ€§åšå®Œâ€å˜ä¸ºâ€œåˆ†ç‰‡æ‰§è¡Œâ€ã€‚

---

### âœ… 2. **é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰**

- **é—®é¢˜**ï¼šReact 15 ä¸­ï¼Œç»„ä»¶å†…ä»»ä½• JS é”™è¯¯ä¼šå¯¼è‡´**æ•´ä¸ªåº”ç”¨å´©æºƒï¼ˆç™½å±ï¼‰**ï¼Œä¸”é”™è¯¯éš¾ä»¥æ•è·ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼šå¼•å…¥ç”Ÿå‘½å‘¨æœŸ `componentDidCatch(error, info)`ã€‚

  ```jsx
  class ErrorBoundary extends React.Component {
    state = { hasError: false }

    componentDidCatch(error, info) {
      this.setState({ hasError: true })
      logErrorToService(error, info.componentStack)
    }

    render() {
      return this.state.hasError ? <FallbackUI /> : this.props.children
    }
  }
  ```

- **é™åˆ¶**ï¼šä¸èƒ½æ•è·**äº‹ä»¶å¤„ç†å‡½æ•°**ã€**å¼‚æ­¥ä»£ç ï¼ˆsetTimeoutã€Promiseï¼‰**ã€**æœåŠ¡ç«¯æ¸²æŸ“**ä¸­çš„é”™è¯¯ã€‚

> ğŸ’¡ è¿™æ˜¯ä½ æ„å»ºå·¥å•ç³»ç»Ÿç­‰ä¼ä¸šåº”ç”¨æ—¶**å¿…å¤‡çš„å®¹é”™æœºåˆ¶**ã€‚

---

### âœ… 3. **Portalsï¼ˆä¼ é€é—¨ï¼‰**

- **é—®é¢˜**ï¼šModalã€Tooltipã€Dropdown ç­‰ç»„ä»¶éœ€è¦æ¸²æŸ“åˆ° `body` ä¸‹ï¼Œä½†åˆæƒ³ä¿ç•™ React ç»„ä»¶çš„çˆ¶å­å…³ç³»å’Œäº‹ä»¶å†’æ³¡ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š`ReactDOM.createPortal(child, container)`ã€‚
  ```jsx
  render() {
    return ReactDOM.createPortal(
      this.props.children,
      document.body // æ¸²æŸ“åˆ°è¿™é‡Œï¼Œä½†äº‹ä»¶ä»å†’æ³¡åˆ°çˆ¶ç»„ä»¶
    );
  }
  ```
- **å…¸å‹ç”¨é€”**ï¼šå¼¹çª—ã€å…¨å±åŠ è½½ã€é€šçŸ¥ç­‰ã€‚

> ğŸ› ï¸ åœ¨ Ant Design ä¸­ï¼Œ`Modal` å’Œ `Drawer` å†…éƒ¨å°±å¤§é‡ä½¿ç”¨ Portalsã€‚

---

## äºŒã€å…¶ä»–é‡è¦æ–°ç‰¹æ€§

### ğŸ”¸ Fragmentï¼ˆReact.Fragmentï¼‰

- è§£å†³â€œå¿…é¡»è¿”å›å•ä¸ªæ ¹å…ƒç´ â€çš„é™åˆ¶ï¼š
  ```jsx
  // ä»¥å‰ï¼šå¿…é¡»åŠ  <div>
  // ç°åœ¨ï¼š
  render() {
    return (
      <React.Fragment>
        <ChildA />
        <ChildB />
      </React.Fragment>
    );
  }
  // æˆ–ç®€å†™ï¼š
  return (
    <>
      <ChildA />
      <ChildB />
    </>
  );
  ```

---

### ğŸ”¸ æ”¯æŒç›´æ¥è¿”å›å­—ç¬¦ä¸²/æ•°ç»„

```jsx
// React 16+
render() {
  return 'Hello'; // âœ… åˆæ³•
}
render() {
  return [1, 2, 3].map(i => <li key={i}>{i}</li>); // âœ… åˆæ³•
}
```

---

### ğŸ”¸ ç”Ÿå‘½å‘¨æœŸå‡½æ•°å˜æ›´ï¼ˆé“ºå«æœªæ¥ï¼‰

- **åºŸå¼ƒ**ï¼š`componentWillMount`ã€`componentWillReceiveProps`ã€`componentWillUpdate`ï¼ˆå›  Fiber å¼‚æ­¥ç‰¹æ€§ï¼Œè¿™äº›é’©å­å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¸å®‰å…¨ï¼‰ã€‚
- **æ–°å¢**ï¼š`getDerivedStateFromProps`ï¼ˆé™æ€æ–¹æ³•ï¼Œæ›¿ä»£ `componentWillReceiveProps`ï¼‰ã€‚

> ğŸ“Œ è™½ç„¶å½“æ—¶ç”¨å¾—å°‘ï¼Œä½†ä¸º React 16.3+ çš„â€œä¸¥æ ¼æ¨¡å¼â€å’Œåç»­ Hooks é“ºè·¯ã€‚

---

### ğŸ”¸ æ›´å¥½çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰

- æ–°å¢ `ReactDOM.hydrate()` æ›¿ä»£ `ReactDOM.render()` ç”¨äºæ³¨æ°´ï¼ˆhydrationï¼‰ï¼›
- æ”¯æŒ **Streaming SSR**ï¼ˆé€šè¿‡ `renderToNodeStream`ï¼‰ï¼Œå¯è¾¹ç”Ÿæˆ HTML è¾¹å‘é€ï¼Œæå‡é¦–å±é€Ÿåº¦ã€‚

---

## ä¸‰ã€å…³é”®å†…éƒ¨å˜åŒ–ï¼ˆå¼€å‘è€…éœ€çŸ¥ï¼‰

| ç‰¹æ€§     | React 15                     | React 16                                           |
| -------- | ---------------------------- | -------------------------------------------------- |
| è°ƒå’Œç®—æ³• | Stack Reconcilerï¼ˆåŒæ­¥é€’å½’ï¼‰ | **Fiber Reconcilerï¼ˆå¼‚æ­¥åˆ†ç‰‡ï¼‰**                   |
| é”™è¯¯å¤„ç† | å…¨å±€å´©æºƒ                     | **Error Boundaries**                               |
| æ¸²æŸ“ç›®æ ‡ | ä»… DOM                       | **æ”¯æŒè‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼ˆå¦‚ React Nativeã€React ARTï¼‰** |
| License  | BSD + Patentsï¼ˆäº‰è®®ï¼‰        | **MITï¼ˆ2017 å¹´ 9 æœˆåï¼‰**                          |

> ğŸ’¡ React 16 çš„ MIT è®¸å¯è¯ä½¿å…¶åœ¨ä¼ä¸šï¼ˆå¦‚ä½ çš„ Backstage æ’ä»¶ï¼‰ä¸­æ›´å®‰å…¨åœ°ä½¿ç”¨ã€‚

---

## å››ã€å¯¹ç°ä»£ React çš„å½±å“

React 16 æ˜¯**æ‰¿ä¸Šå¯ä¸‹çš„å…³é”®ç‰ˆæœ¬**ï¼š

- **Fiber æ¶æ„** â†’ æ”¯æ’‘äº† React 18 çš„ **Concurrent Rendering**ã€**Automatic Batching**ï¼›
- **Portals + Error Boundaries** â†’ æˆä¸ºä¼ä¸šçº§åº”ç”¨çš„æ ‡é…ï¼›
- **MIT è®¸å¯** â†’ ä¿ƒä½¿ Facebookã€Airbnbã€å¾®è½¯ç­‰å¤§è§„æ¨¡é‡‡ç”¨ã€‚

---

## äº”ã€15 åˆ†é’Ÿæ€»ç»“ï¼ˆé€Ÿè®°ç‰ˆï¼‰

| æ ¸å¿ƒçªç ´             | ä½œç”¨                     | ä½ çš„é¡¹ç›®æ˜¯å¦ç”¨åˆ°ï¼Ÿ                 |
| -------------------- | ------------------------ | ---------------------------------- |
| **Fiber**            | å¼‚æ­¥å¯ä¸­æ–­æ¸²æŸ“ï¼Œæå‡æ€§èƒ½ | âœ… æ‰€æœ‰ç°ä»£ React åº”ç”¨åº•å±‚éƒ½ä¾èµ–å®ƒ |
| **Error Boundaries** | æ•è·ç»„ä»¶é”™è¯¯ï¼Œé˜²æ­¢ç™½å±   | âœ… å·¥å•ç³»ç»Ÿå»ºè®®åŒ…è£¹å…³é”®æ¨¡å—        |
| **Portals**          | æ¸²æŸ“åˆ°ä»»æ„ DOM èŠ‚ç‚¹      | âœ… Ant Design Modal ä¾èµ–å®ƒ         |
| **Fragment**         | æ— éœ€é¢å¤– div åŒ…è£¹        | âœ… æ—¥å¸¸å¼€å‘é«˜é¢‘ä½¿ç”¨                |
| **MIT License**      | æ¶ˆé™¤ä¸“åˆ©é£é™©             | âœ… ä¼ä¸šé¡¹ç›®åˆè§„æ€§ä¿éšœ              |

---

> ğŸ•’ ä½ å·²ç»ç”¨ä¸åˆ° 15 åˆ†é’ŸæŒæ¡äº† React 16 çš„ç²¾é«“ï¼

å¦‚æœä½ æ¥ä¸‹æ¥æƒ³äº†è§£ **React 18 çš„å¹¶å‘ç‰¹æ€§**ï¼ˆå¦‚ `useTransition`ã€`Suspense for Data Fetching`ï¼‰å¦‚ä½•åœ¨ä½ çš„ `my-ticket-agent` ä¸­æå‡ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼
