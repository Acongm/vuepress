<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.32">
    <link rel="apple-touch-icon" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#3eaf7c"><meta name="msapplication-TileImage" content="/favicon.ico"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileColor" content="#000000"><script src="https://hm.baidu.com/hm.js?8e5be87f55d52e1115a38afce593d2bb"></script><title>Webpack 架构 & 与 Rollup、Vite 对比 & 核心原理 | acongm</title><meta name="description" content="前端常用知识、踩坑记录、软件推荐等">
    <link rel="preload" href="/vuepress/assets/js/runtime~app.f97bd93a.js" as="script"><link rel="preload" href="/vuepress/assets/css/styles.fc93d6da.css" as="style"><link rel="preload" href="/vuepress/assets/js/5316.94e78182.js" as="script"><link rel="preload" href="/vuepress/assets/js/app.277a2eeb.js" as="script">
    <link rel="stylesheet" href="/vuepress/assets/css/styles.fc93d6da.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vuepress/" class=""><img class="logo" src="/vuepress/logo.jpg" alt="acongm"><span class="site-name can-hide">acongm</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>在线工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/online-tools/" class="" aria-label="网页工具"><!--[--><!--]--> 网页工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/online-tools/bookmark-scripts.html" class="" aria-label="书签脚本"><!--[--><!--]--> 书签脚本 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>工具方法</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/utils/regexp.html" class="" aria-label="常用正则"><!--[--><!--]--> 常用正则 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/utils/function.html" class="" aria-label="常用方法"><!--[--><!--]--> 常用方法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/utils/library.html" class="" aria-label="库收集"><!--[--><!--]--> 库收集 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><a href="/vuepress/git/README.md" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>软件相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/software/cross-platform.html" class="" aria-label="多平台"><!--[--><!--]--> 多平台 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/mac.html" class="" aria-label="Mac 平台"><!--[--><!--]--> Mac 平台 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/windows.html" class="" aria-label="Windows 平台"><!--[--><!--]--> Windows 平台 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/browser.html" class="" aria-label="浏览器扩展"><!--[--><!--]--> 浏览器扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/vscode.html" class="" aria-label="Visual Studio Code 扩展"><!--[--><!--]--> Visual Studio Code 扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/webstorm.html" class="" aria-label="WebStorm 配置"><!--[--><!--]--> WebStorm 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/zsh.html" class="" aria-label="zsh"><!--[--><!--]--> zsh <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="专题"><span class="title">专题</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress/mack/" class="router-link-active" aria-label="技能提炼"><!--[--><!--]--> 技能提炼 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/01-React%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" class="" aria-label="React 16+ 各版本区别 &amp; React 核心原理"><!--[--><!--]--> React 16+ 各版本区别 &amp; React 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Webpack 架构 &amp; 与 Rollup、Vite 对比 &amp; 核心原理"><!--[--><!--]--> Webpack 架构 &amp; 与 Rollup、Vite 对比 &amp; 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/03-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="" aria-label="性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot;"><!--[--><!--]--> 性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot; <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/04-%E5%BE%AE%E5%89%8D%E7%AB%AF.html" class="" aria-label="微前端对比 &amp; 各方案实现原理"><!--[--><!--]--> 微前端对比 &amp; 各方案实现原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/05-%E4%BD%8E%E4%BB%A3%E7%A0%81.html" class="" aria-label="低代码 &amp; 核心原理"><!--[--><!--]--> 低代码 &amp; 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/06-%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F.html" class="" aria-label="热插拔插件系统对比 &amp; 各方案实现原理差异"><!--[--><!--]--> 热插拔插件系统对比 &amp; 各方案实现原理差异 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/07-NestJS%E4%B8%8ESSR.html" class="" aria-label="从 NestJS 全栈开发到 SSR &amp; SSR 核心原理"><!--[--><!--]--> 从 NestJS 全栈开发到 SSR &amp; SSR 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/08-%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83.html" class="" aria-label="代码规范 &amp; Umi/ESLint 规范为什么这样设计 &amp; 如何落地"><!--[--><!--]--> 代码规范 &amp; Umi/ESLint 规范为什么这样设计 &amp; 如何落地 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/09-Promise%E5%8E%9F%E7%90%86.html" class="" aria-label="JS 为什么会设计 Promise &amp; 如何手写实现一个 Promise"><!--[--><!--]--> JS 为什么会设计 Promise &amp; 如何手写实现一个 Promise <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/10-%E9%AA%A8%E6%9E%B6%E5%B1%8F.html" class="" aria-label="骨架屏怎么提升性能的？骨架屏的原理及实现"><!--[--><!--]--> 骨架屏怎么提升性能的？骨架屏的原理及实现 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/11-HTTP%E4%B8%8E%E7%BC%93%E5%AD%98.html" class="" aria-label="从性能优化到 HTTP 变化及缓存"><!--[--><!--]--> 从性能优化到 HTTP 变化及缓存 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress/mack/" class="router-link-active" aria-label="技能提炼-补充"><!--[--><!--]--> 技能提炼-补充 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/01-React%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E8%A1%A5%E5%85%85.html" class="" aria-label="React 19 新特性详解 &amp; useMemo/useCallback 深度解析"><!--[--><!--]--> React 19 新特性详解 &amp; useMemo/useCallback 深度解析 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/React%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3.html" class="" aria-label="React 更新流程详解"><!--[--><!--]--> React 更新流程详解 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="面试"><span class="title">面试</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="面试"><span class="title">面试</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>知识库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/interview-prep/" class="" aria-label="知识列表（面试准备）"><!--[--><!--]--> 知识列表（面试准备） <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>知识库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/theory/" class="" aria-label="面试题专项"><!--[--><!--]--> 面试题专项 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>知识库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/interview/2025-04-28.md" class="" aria-label="面试题（记录）"><!--[--><!--]--> 面试题（记录） <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="JavaScript / TypeScript"><span class="title">JavaScript / TypeScript</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="JavaScript / TypeScript"><span class="title">JavaScript / TypeScript</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>JavaScript</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/" class="" aria-label="js 基础知识"><!--[--><!--]--> js 基础知识 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/%E7%BB%8F%E5%85%B8%E9%97%AD%E5%8C%85%E5%A4%84%E7%90%86.html" class="" aria-label="经典闭包处理"><!--[--><!--]--> 经典闭包处理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%97%AD%E5%8C%85.html" class="" aria-label="执行上下文-作用域链-闭包"><!--[--><!--]--> 执行上下文-作用域链-闭包 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/call%E3%80%81apply%E4%B8%8Ebind.html" class="" aria-label="call、apply 与 bind"><!--[--><!--]--> call、apply 与 bind <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/js%E6%A8%A1%E6%8B%9Fbind%E6%96%B9%E6%B3%95.html" class="" aria-label="js 模拟 bind 方法"><!--[--><!--]--> js 模拟 bind 方法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/js%E6%A8%A1%E6%8B%9Fnew%E6%93%8D%E4%BD%9C.html" class="" aria-label="能否模拟实现 JS 的 new 操作符"><!--[--><!--]--> 能否模拟实现 JS 的 new 操作符 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TypeScript</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/TypeScript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/TypeScript/Study.html" class="" aria-label="每天学一点 TS"><!--[--><!--]--> 每天学一点 TS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>通信模式</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/Pattern/%E6%A8%A1%E5%BC%8F%E6%9D%A5%E6%BA%90%E4%B8%8E%E7%B1%BB%E6%AF%94.html" class="" aria-label="这些跨组件通信模式，你可能在哪见过？（来源与类比）"><!--[--><!--]--> 这些跨组件通信模式，你可能在哪见过？（来源与类比） <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/Pattern/" class="" aria-label="跨组件通信模式合集"><!--[--><!--]--> 跨组件通信模式合集 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Performance</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/Performance/" class="" aria-label="用户中心前端性能优化实战文档"><!--[--><!--]--> 用户中心前端性能优化实战文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue / React"><span class="title">Vue / React</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue / React"><span class="title">Vue / React</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Vue</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/vue_theory.html" class="" aria-label="vue 原理"><!--[--><!--]--> vue 原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/vue_interview.html" class="" aria-label="vue 面试题"><!--[--><!--]--> vue 面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/vue3.html" class="" aria-label="vue3 原理 - 总结"><!--[--><!--]--> vue3 原理 - 总结 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>React</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/react/class-hooks.html" class="" aria-label="react"><!--[--><!--]--> react <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Webpack / Node"><span class="title">Webpack / Node</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Webpack / Node"><span class="title">Webpack / Node</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Webpack</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/webpack/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86.html" class="" aria-label="Webpack - 介绍"><!--[--><!--]--> Webpack - 介绍 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/webpack/vite-%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86.html" class="" aria-label="vite - 知识梳理"><!--[--><!--]--> vite - 知识梳理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Node 相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/node/npm.html" class="" aria-label="npm 相关"><!--[--><!--]--> npm 相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/node/toolkit.html" class="" aria-label="常用工具包"><!--[--><!--]--> 常用工具包 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>疑难杂症</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/issue/h5.html" class="" aria-label="H5 相关"><!--[--><!--]--> H5 相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/issue/pc.html" class="" aria-label="PC 相关"><!--[--><!--]--> PC 相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Html / CSS "><span class="title">Html / CSS </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Html / CSS "><span class="title">Html / CSS </span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>CSS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/css/" class="" aria-label="CSS 语法相关"><!--[--><!--]--> CSS 语法相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/css/skill.html" class="" aria-label="CSS 奇淫技巧"><!--[--><!--]--> CSS 奇淫技巧 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/css/scss.html" class="" aria-label="常用 SCSS 宏"><!--[--><!--]--> 常用 SCSS 宏 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="主页"><span class="title">主页</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="主页"><span class="title">主页</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://www.acongm.com" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/Acongm" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress/job-description/web前端开发工程师-彭聪.md" class="" aria-label="简历"><!--[--><!--]--> 简历 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><!----><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>在线工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/online-tools/" class="" aria-label="网页工具"><!--[--><!--]--> 网页工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/online-tools/bookmark-scripts.html" class="" aria-label="书签脚本"><!--[--><!--]--> 书签脚本 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>工具方法</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/utils/regexp.html" class="" aria-label="常用正则"><!--[--><!--]--> 常用正则 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/utils/function.html" class="" aria-label="常用方法"><!--[--><!--]--> 常用方法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/utils/library.html" class="" aria-label="库收集"><!--[--><!--]--> 库收集 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><a href="/vuepress/git/README.md" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>软件相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/software/cross-platform.html" class="" aria-label="多平台"><!--[--><!--]--> 多平台 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/mac.html" class="" aria-label="Mac 平台"><!--[--><!--]--> Mac 平台 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/windows.html" class="" aria-label="Windows 平台"><!--[--><!--]--> Windows 平台 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/browser.html" class="" aria-label="浏览器扩展"><!--[--><!--]--> 浏览器扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/vscode.html" class="" aria-label="Visual Studio Code 扩展"><!--[--><!--]--> Visual Studio Code 扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/webstorm.html" class="" aria-label="WebStorm 配置"><!--[--><!--]--> WebStorm 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/software/zsh.html" class="" aria-label="zsh"><!--[--><!--]--> zsh <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="专题"><span class="title">专题</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress/mack/" class="router-link-active" aria-label="技能提炼"><!--[--><!--]--> 技能提炼 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/01-React%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" class="" aria-label="React 16+ 各版本区别 &amp; React 核心原理"><!--[--><!--]--> React 16+ 各版本区别 &amp; React 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Webpack 架构 &amp; 与 Rollup、Vite 对比 &amp; 核心原理"><!--[--><!--]--> Webpack 架构 &amp; 与 Rollup、Vite 对比 &amp; 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/03-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="" aria-label="性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot;"><!--[--><!--]--> 性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot; <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/04-%E5%BE%AE%E5%89%8D%E7%AB%AF.html" class="" aria-label="微前端对比 &amp; 各方案实现原理"><!--[--><!--]--> 微前端对比 &amp; 各方案实现原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/05-%E4%BD%8E%E4%BB%A3%E7%A0%81.html" class="" aria-label="低代码 &amp; 核心原理"><!--[--><!--]--> 低代码 &amp; 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/06-%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F.html" class="" aria-label="热插拔插件系统对比 &amp; 各方案实现原理差异"><!--[--><!--]--> 热插拔插件系统对比 &amp; 各方案实现原理差异 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/07-NestJS%E4%B8%8ESSR.html" class="" aria-label="从 NestJS 全栈开发到 SSR &amp; SSR 核心原理"><!--[--><!--]--> 从 NestJS 全栈开发到 SSR &amp; SSR 核心原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/08-%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83.html" class="" aria-label="代码规范 &amp; Umi/ESLint 规范为什么这样设计 &amp; 如何落地"><!--[--><!--]--> 代码规范 &amp; Umi/ESLint 规范为什么这样设计 &amp; 如何落地 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/09-Promise%E5%8E%9F%E7%90%86.html" class="" aria-label="JS 为什么会设计 Promise &amp; 如何手写实现一个 Promise"><!--[--><!--]--> JS 为什么会设计 Promise &amp; 如何手写实现一个 Promise <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/10-%E9%AA%A8%E6%9E%B6%E5%B1%8F.html" class="" aria-label="骨架屏怎么提升性能的？骨架屏的原理及实现"><!--[--><!--]--> 骨架屏怎么提升性能的？骨架屏的原理及实现 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/11-HTTP%E4%B8%8E%E7%BC%93%E5%AD%98.html" class="" aria-label="从性能优化到 HTTP 变化及缓存"><!--[--><!--]--> 从性能优化到 HTTP 变化及缓存 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress/mack/" class="router-link-active" aria-label="技能提炼-补充"><!--[--><!--]--> 技能提炼-补充 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/01-React%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E8%A1%A5%E5%85%85.html" class="" aria-label="React 19 新特性详解 &amp; useMemo/useCallback 深度解析"><!--[--><!--]--> React 19 新特性详解 &amp; useMemo/useCallback 深度解析 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/mack/React%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3.html" class="" aria-label="React 更新流程详解"><!--[--><!--]--> React 更新流程详解 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="面试"><span class="title">面试</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="面试"><span class="title">面试</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>知识库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/interview-prep/" class="" aria-label="知识列表（面试准备）"><!--[--><!--]--> 知识列表（面试准备） <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>知识库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/theory/" class="" aria-label="面试题专项"><!--[--><!--]--> 面试题专项 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>知识库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/interview/2025-04-28.md" class="" aria-label="面试题（记录）"><!--[--><!--]--> 面试题（记录） <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="JavaScript / TypeScript"><span class="title">JavaScript / TypeScript</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="JavaScript / TypeScript"><span class="title">JavaScript / TypeScript</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>JavaScript</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/" class="" aria-label="js 基础知识"><!--[--><!--]--> js 基础知识 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/%E7%BB%8F%E5%85%B8%E9%97%AD%E5%8C%85%E5%A4%84%E7%90%86.html" class="" aria-label="经典闭包处理"><!--[--><!--]--> 经典闭包处理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%97%AD%E5%8C%85.html" class="" aria-label="执行上下文-作用域链-闭包"><!--[--><!--]--> 执行上下文-作用域链-闭包 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/call%E3%80%81apply%E4%B8%8Ebind.html" class="" aria-label="call、apply 与 bind"><!--[--><!--]--> call、apply 与 bind <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/js%E6%A8%A1%E6%8B%9Fbind%E6%96%B9%E6%B3%95.html" class="" aria-label="js 模拟 bind 方法"><!--[--><!--]--> js 模拟 bind 方法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/JavaScript/js%E6%A8%A1%E6%8B%9Fnew%E6%93%8D%E4%BD%9C.html" class="" aria-label="能否模拟实现 JS 的 new 操作符"><!--[--><!--]--> 能否模拟实现 JS 的 new 操作符 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TypeScript</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/TypeScript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/TypeScript/Study.html" class="" aria-label="每天学一点 TS"><!--[--><!--]--> 每天学一点 TS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>通信模式</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/Pattern/%E6%A8%A1%E5%BC%8F%E6%9D%A5%E6%BA%90%E4%B8%8E%E7%B1%BB%E6%AF%94.html" class="" aria-label="这些跨组件通信模式，你可能在哪见过？（来源与类比）"><!--[--><!--]--> 这些跨组件通信模式，你可能在哪见过？（来源与类比） <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/Pattern/" class="" aria-label="跨组件通信模式合集"><!--[--><!--]--> 跨组件通信模式合集 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Performance</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/Performance/" class="" aria-label="用户中心前端性能优化实战文档"><!--[--><!--]--> 用户中心前端性能优化实战文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue / React"><span class="title">Vue / React</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue / React"><span class="title">Vue / React</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Vue</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/vue_theory.html" class="" aria-label="vue 原理"><!--[--><!--]--> vue 原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/vue_interview.html" class="" aria-label="vue 面试题"><!--[--><!--]--> vue 面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/vue/vue3.html" class="" aria-label="vue3 原理 - 总结"><!--[--><!--]--> vue3 原理 - 总结 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>React</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/react/class-hooks.html" class="" aria-label="react"><!--[--><!--]--> react <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Webpack / Node"><span class="title">Webpack / Node</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Webpack / Node"><span class="title">Webpack / Node</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Webpack</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/webpack/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86.html" class="" aria-label="Webpack - 介绍"><!--[--><!--]--> Webpack - 介绍 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/webpack/vite-%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86.html" class="" aria-label="vite - 知识梳理"><!--[--><!--]--> vite - 知识梳理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Node 相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/node/npm.html" class="" aria-label="npm 相关"><!--[--><!--]--> npm 相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/node/toolkit.html" class="" aria-label="常用工具包"><!--[--><!--]--> 常用工具包 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>疑难杂症</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/issue/h5.html" class="" aria-label="H5 相关"><!--[--><!--]--> H5 相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/issue/pc.html" class="" aria-label="PC 相关"><!--[--><!--]--> PC 相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Html / CSS "><span class="title">Html / CSS </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Html / CSS "><span class="title">Html / CSS </span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>CSS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress/css/" class="" aria-label="CSS 语法相关"><!--[--><!--]--> CSS 语法相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/css/skill.html" class="" aria-label="CSS 奇淫技巧"><!--[--><!--]--> CSS 奇淫技巧 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress/css/scss.html" class="" aria-label="常用 SCSS 宏"><!--[--><!--]--> 常用 SCSS 宏 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="主页"><span class="title">主页</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="主页"><span class="title">主页</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://www.acongm.com" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/Acongm" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress/job-description/web前端开发工程师-彭聪.md" class="" aria-label="简历"><!--[--><!--]--> 简历 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p class="sidebar-item sidebar-heading active">技能提炼 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vuepress/mack/01-React%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" class="sidebar-item" aria-label="React 16+ 各版本区别 &amp; React 核心原理"><!--[--><!--]--> React 16+ 各版本区别 &amp; React 核心原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Webpack 架构 &amp; 与 Rollup、Vite 对比 &amp; 核心原理"><!--[--><!--]--> Webpack 架构 &amp; 与 Rollup、Vite 对比 &amp; 核心原理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#笔试题-6-题" class="router-link-active router-link-exact-active sidebar-item" aria-label="笔试题（6 题）"><!--[--><!--]--> 笔试题（6 题） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_1-webpack-构建流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. Webpack 构建流程"><!--[--><!--]--> 1. Webpack 构建流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_2-loader-vs-plugin" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. Loader vs Plugin"><!--[--><!--]--> 2. Loader vs Plugin <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_3-module-graph-vs-chunk-graph" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Module Graph vs Chunk Graph"><!--[--><!--]--> 3. Module Graph vs Chunk Graph <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_4-rollup-tree-shaking" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. Rollup Tree-shaking"><!--[--><!--]--> 4. Rollup Tree-shaking <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_5-vite-为什么快" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. Vite 为什么快"><!--[--><!--]--> 5. Vite 为什么快 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_6-webpack-hmr-原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. Webpack HMR 原理"><!--[--><!--]--> 6. Webpack HMR 原理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#面试题-4-题" class="router-link-active router-link-exact-active sidebar-item" aria-label="面试题（4 题）"><!--[--><!--]--> 面试题（4 题） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_1-从-0-设计打包器" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 从 0 设计打包器"><!--[--><!--]--> 1. 从 0 设计打包器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_2-vite-的开发-生产模式差异" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. Vite 的开发/生产模式差异"><!--[--><!--]--> 2. Vite 的开发/生产模式差异 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_3-webpack-性能优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Webpack 性能优化"><!--[--><!--]--> 3. Webpack 性能优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress/mack/02-Webpack%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7.html#_4-webpack-迁移到-vite" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. Webpack 迁移到 Vite"><!--[--><!--]--> 4. Webpack 迁移到 Vite <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/vuepress/mack/03-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="sidebar-item" aria-label="性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot;"><!--[--><!--]--> 性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot; <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/04-%E5%BE%AE%E5%89%8D%E7%AB%AF.html" class="sidebar-item" aria-label="微前端对比 &amp; 各方案实现原理"><!--[--><!--]--> 微前端对比 &amp; 各方案实现原理 <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/05-%E4%BD%8E%E4%BB%A3%E7%A0%81.html" class="sidebar-item" aria-label="低代码 &amp; 核心原理"><!--[--><!--]--> 低代码 &amp; 核心原理 <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/06-%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F.html" class="sidebar-item" aria-label="热插拔插件系统对比 &amp; 各方案实现原理差异"><!--[--><!--]--> 热插拔插件系统对比 &amp; 各方案实现原理差异 <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/07-NestJS%E4%B8%8ESSR.html" class="sidebar-item" aria-label="从 NestJS 全栈开发到 SSR &amp; SSR 核心原理"><!--[--><!--]--> 从 NestJS 全栈开发到 SSR &amp; SSR 核心原理 <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/08-%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83.html" class="sidebar-item" aria-label="代码规范 &amp; Umi/ESLint 规范为什么这样设计 &amp; 如何落地"><!--[--><!--]--> 代码规范 &amp; Umi/ESLint 规范为什么这样设计 &amp; 如何落地 <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/09-Promise%E5%8E%9F%E7%90%86.html" class="sidebar-item" aria-label="JS 为什么会设计 Promise &amp; 如何手写实现一个 Promise"><!--[--><!--]--> JS 为什么会设计 Promise &amp; 如何手写实现一个 Promise <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/10-%E9%AA%A8%E6%9E%B6%E5%B1%8F.html" class="sidebar-item" aria-label="骨架屏怎么提升性能的？骨架屏的原理及实现"><!--[--><!--]--> 骨架屏怎么提升性能的？骨架屏的原理及实现 <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/11-HTTP%E4%B8%8E%E7%BC%93%E5%AD%98.html" class="sidebar-item" aria-label="从性能优化到 HTTP 变化及缓存"><!--[--><!--]--> 从性能优化到 HTTP 变化及缓存 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">技能提炼-补充 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vuepress/mack/01-React%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E8%A1%A5%E5%85%85.html" class="sidebar-item" aria-label="React 19 新特性详解 &amp; useMemo/useCallback 深度解析"><!--[--><!--]--> React 19 新特性详解 &amp; useMemo/useCallback 深度解析 <!--[--><!--]--></a><!----></li><li><a href="/vuepress/mack/React%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3.html" class="sidebar-item" aria-label="React 更新流程详解"><!--[--><!--]--> React 更新流程详解 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="webpack-架构-与-rollup、vite-对比-核心原理" tabindex="-1"><a class="header-anchor" href="#webpack-架构-与-rollup、vite-对比-核心原理" aria-hidden="true">#</a> Webpack 架构 &amp; 与 Rollup、Vite 对比 &amp; 核心原理</h1><h2 id="笔试题-6-题" tabindex="-1"><a class="header-anchor" href="#笔试题-6-题" aria-hidden="true">#</a> 笔试题（6 题）</h2><h3 id="_1-webpack-构建流程" tabindex="-1"><a class="header-anchor" href="#_1-webpack-构建流程" aria-hidden="true">#</a> 1. Webpack 构建流程</h3><p>画出 Webpack 构建流程的关键步骤（entry → loader → plugin → chunk → asset），并解释每个步骤的作用。</p><p><strong>【作答】：</strong></p><p>流程图：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
┌─────────────────────────────────────────────────────────────┐
│  1. 初始化阶段 (Initialization)                              │
│  - 读取配置文件 (webpack.config.js)                          │
│  - 合并命令行参数                                            │
│  - 实例化 Compiler 对象                                      │
│  - 注册所有 Plugin                                           │
└─────────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────────┐
│  2. 编译阶段 (Compilation)                                   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 2.1 从 Entry 开始递归                                │   │
│  │  entry: &#39;./src/index.js&#39;                            │   │
│  └──────────────────────────────────────────────────────┘   │
│              ↓                                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 2.2 调用 Loader 转换模块                             │   │
│  │  .js → babel-loader → ES5                           │   │
│  │  .css → css-loader → style-loader                   │   │
│  │  .scss → sass-loader → css-loader                   │   │
│  └──────────────────────────────────────────────────────┘   │
│              ↓                                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 2.3 解析依赖关系                                      │   │
│  │  import &#39;./utils.js&#39; → 加入依赖图                    │   │
│  │  require(&#39;./config&#39;) → 继续递归解析                  │   │
│  └──────────────────────────────────────────────────────┘   │
│              ↓                                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 2.4 构建 Module Graph (模块依赖图)                    │   │
│  │     index.js                                         │   │
│  │     ├── utils.js                                     │   │
│  │     │   └── helper.js                                │   │
│  │     └── config.js                                    │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────────┐
│  3. 优化阶段 (Optimization)                                  │
│  - Tree Shaking (剔除未使用代码)                             │
│  - Scope Hoisting (作用域提升)                               │
│  - Code Splitting (代码分割)                                 │
│  - Minification (压缩代码)                                   │
└─────────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────────┐
│  4. 生成 Chunk 阶段 (Chunk Generation)                       │
│  根据依赖关系和分割策略生成 Chunk：                            │
│  - main.chunk.js (entry chunk)                              │
│  - vendor.chunk.js (splitChunks)                            │
│  - async.chunk.js (动态 import)                             │
└─────────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────────┐
│  5. 生成 Asset 阶段 (Asset Generation)                       │
│  将 Chunk 渲染成最终文件：                                    │
│  - main.bundle.js                                           │
│  - vendor.bundle.js                                         │
│  - style.css                                                │
│  - images/logo.png                                          │
│  - index.html (HtmlWebpackPlugin)                           │
└─────────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────────┐
│  6. 输出阶段 (Emit)                                          │
│  - 写入文件系统 (dist/)                                      │
│  - 生成 manifest.json                                       │
│  - 生成 stats.json                                          │
└─────────────────────────────────────────────────────────────┘
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>各步骤作用：</p><p>entry (入口):</p><ul><li>定义构建的起点，Webpack 从这里开始分析依赖</li><li>可以是单入口或多入口</li><li>示例：entry: { main: &#39;./src/index.js&#39;, admin: &#39;./src/admin.js&#39; }</li><li>作用：确定应用的入口文件，形成依赖图的根节点</li></ul><p>loader (转换器):</p><ul><li>将非 JavaScript 文件转换为 Webpack 能处理的模块</li><li>从右到左、从下到上链式调用</li><li>示例：.vue → vue-loader → JavaScript 模块</li><li>作用：实现文件级别的转换，处理特定类型的文件</li><li>本质：导出函数，接收源码字符串，返回转换后的代码</li></ul><p>plugin (插件):</p><ul><li>在 Webpack 构建流程的特定时机执行自定义逻辑</li><li>通过监听 Webpack 生命周期钩子实现功能扩展</li><li>示例：HtmlWebpackPlugin 生成 HTML、CleanWebpackPlugin 清理目录</li><li>作用：处理 loader 无法完成的复杂任务，如打包优化、资源管理</li><li>本质：包含 apply 方法的类/对象，可以访问整个编译生命周期</li></ul><p>chunk (代码块):</p><ul><li>多个模块的集合，是 Webpack 内部的中间产物</li><li>生成方式： <ol><li>Entry Chunk：每个 entry 生成一个 chunk</li><li>Async Chunk：动态 import() 生成异步 chunk</li><li>Runtime Chunk：提取运行时代码</li><li>Split Chunk：通过 splitChunks 提取公共模块</li></ol></li><li>作用：组织模块，为代码分割提供基础</li></ul><p>asset (资源文件):</p><ul><li>最终输出到 dist 目录的文件</li><li>包括：JavaScript bundle、CSS 文件、图片、字体等</li><li>命名规则：通过 output.filename 和 output.chunkFilename 配置</li><li>示例：main.[contenthash].js、vendors~main.[chunkhash].js</li><li>作用：浏览器可直接加载的最终产物</li></ul><hr><h3 id="_2-loader-vs-plugin" tabindex="-1"><a class="header-anchor" href="#_2-loader-vs-plugin" aria-hidden="true">#</a> 2. Loader vs Plugin</h3><p>loader 与 plugin 的本质区别是什么？各自的执行时机、能力边界？举例说明什么场景用 loader，什么场景用 plugin。</p><p><strong>【作答】：</strong></p><p>本质区别：</p><p>【Loader】</p><ul><li>本质：一个导出函数的模块</li><li>职责：文件转换器，将源文件转换为 Webpack 可处理的模块</li><li>作用范围：单个文件级别</li><li>输入/输出：字符串 → 字符串（或 Buffer）</li><li>代码示例：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>  function myLoader(source) {
    // source: 源文件内容
    const result = transform(source);
    return result; // 返回转换后的代码
  }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>【Plugin】</p><ul><li>本质：包含 apply 方法的类或对象</li><li>职责：功能扩展器，监听构建流程中的事件钩子</li><li>作用范围：整个编译过程</li><li>输入/输出：访问 Compiler 和 Compilation 对象，可以修改整个构建过程</li><li>代码示例：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>  class MyPlugin {
    apply(compiler) {
      compiler.hooks.emit.tap(&#39;MyPlugin&#39;, (compilation) =&gt; {
        // 可以访问所有资源、修改输出等
      });
    }
  }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>执行时机：</p><p>loader:</p><ol><li>在模块加载阶段执行</li><li>处理每个匹配的文件时调用</li><li>链式调用顺序：从右到左，从下到上 规则：[&#39;style-loader&#39;, &#39;css-loader&#39;, &#39;sass-loader&#39;] 执行：sass-loader → css-loader → style-loader</li></ol><p>示例执行流程： 发现 .scss 文件 ↓ sass-loader: SCSS → CSS ↓ css-loader: CSS → JS 模块 (CSS 转 CommonJS) ↓ style-loader: 注入 script 标签到 DOM</p><p>plugin:</p><ol><li>在整个编译生命周期的特定钩子执行</li><li>可以监听多个钩子，在不同阶段介入</li></ol><p>主要钩子时机：</p><ul><li>entryOption: 读取配置后</li><li>afterPlugins: 插件注册完成</li><li>run: 开始编译</li><li>compile: 创建 compilation 对象前</li><li>compilation: compilation 创建完成</li><li>make: 从 entry 开始递归分析依赖</li><li>afterCompile: 编译完成</li><li>emit: 生成资源到 output 目录前（可修改产物）</li><li>afterEmit: 生成资源后</li><li>done: 编译完全完成</li></ul><p>示例执行流程： Webpack 启动 ↓ run 钩子 → CleanWebpackPlugin 清理旧文件 ↓ compilation 钩子 → ProgressPlugin 显示进度 ↓ emit 钩子 → HtmlWebpackPlugin 生成 HTML ↓ done 钩子 → 输出构建统计信息</p><p>能力边界：</p><p>【Loader 能做的】 ✅ 转换文件内容（语言转换、编译）</p><ul><li>babel-loader: ES6+ → ES5</li><li>ts-loader: TypeScript → JavaScript</li><li>sass-loader: SCSS → CSS</li></ul><p>✅ 处理特定资源</p><ul><li>file-loader: 文件复制并返回 URL</li><li>url-loader: 小文件转 base64</li><li>image-loader: 图片压缩</li></ul><p>✅ 代码注入或修改</p><ul><li>vue-loader: 处理 .vue 单文件组件</li><li>eslint-loader: 代码检查并报告</li></ul><p>【Loader 不能做的】 ❌ 访问其他模块 ❌ 修改整体输出结构 ❌ 生成额外文件（除非通过 emitFile API） ❌ 访问编译上下文和统计信息</p><p>【Plugin 能做的】 ✅ 监听整个构建流程</p><ul><li>可以在任意钩子介入</li></ul><p>✅ 修改输出产物</p><ul><li>TerserPlugin: 压缩 JS</li><li>MiniCssExtractPlugin: 提取 CSS 为单独文件</li></ul><p>✅ 生成额外资源</p><ul><li>HtmlWebpackPlugin: 生成 HTML</li><li>CopyWebpackPlugin: 复制静态资源</li></ul><p>✅ 优化构建</p><ul><li>SplitChunksPlugin: 代码分割</li><li>DllPlugin: 预编译依赖</li></ul><p>✅ 改变编译行为</p><ul><li>DefinePlugin: 定义全局常量</li><li>ProvidePlugin: 自动加载模块</li></ul><p>【Plugin 不能做的】 ❌ 直接转换单个文件内容（应该用 loader）</p><p>使用场景示例：</p><p>【使用 Loader 的场景】</p><p>场景 1：TypeScript 转 JavaScript</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/\.ts$/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&#39;ts-loader&#39;</span> <span class="token comment">// ✅ 文件转换 → 用 loader</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>场景 2：样式处理链</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/\.scss$/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span>    <span class="token comment">// 注入到 DOM</span>
    <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>      <span class="token comment">// 解析 CSS 依赖</span>
    <span class="token string">&#39;postcss-loader&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// 自动添加浏览器前缀</span>
    <span class="token string">&#39;sass-loader&#39;</span>      <span class="token comment">// 编译 SCSS</span>
  <span class="token punctuation">]</span>  <span class="token comment">// ✅ 多步转换 → 链式 loader</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>场景 3：图片资源处理</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/\.(png|jpg|gif)$/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset/resource&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;images/[hash][ext]&#39;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// ✅ 资源处理 → 用 loader (Webpack 5 内置)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>【使用 Plugin 的场景】</p><p>场景 1：自动生成 HTML 并注入 bundle</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.html&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span> <span class="token comment">// ✅ 生成额外文件 → 用 plugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>场景 2：提取 CSS 到单独文件</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].[contenthash].css&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span> <span class="token comment">// ✅ 改变输出结构 → 用 plugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>场景 3：清理旧的构建产物</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// ✅ 文件系统操作 → 用 plugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>场景 4：代码分割优化</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">vendor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/node_modules/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;vendors&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  <span class="token comment">// ✅ 构建优化 → 用 plugin (内置)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>场景 5：定义环境变量</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">&#39;process____.env.NODE_ENV&#39;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span> <span class="token comment">// ✅ 全局注入 → 用 plugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>场景 6：模块热替换</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// ✅ 改变运行时行为 → 用 plugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>【组合使用的场景】</p><p>场景：处理 CSS 并提取到单独文件</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/\.css$/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">// loader: 替代 style-loader</span>
    <span class="token string">&#39;css-loader&#39;</span>                   <span class="token comment">// loader: 处理 CSS</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token comment">// plugin: 提取 CSS 文件</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;css/[name].[contenthash].css&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// Loader 负责转换，Plugin 负责输出</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>【决策流程】</p><p>问题：要实现某个功能，用 loader 还是 plugin？</p><ol><li><p>是否只需要转换单个文件？ ✅ 是 → 用 Loader ❌ 否 → 继续判断</p></li><li><p>是否需要访问整个编译流程？ ✅ 是 → 用 Plugin ❌ 否 → 继续判断</p></li><li><p>是否需要生成额外文件或修改输出？ ✅ 是 → 用 Plugin ❌ 否 → 用 Loader</p></li><li><p>是否需要修改多个模块或改变构建行为？ ✅ 是 → 用 Plugin</p></li></ol><p>【记忆口诀】</p><ul><li>Loader: 专注&quot;翻译&quot;，一个文件进，一个文件出</li><li>Plugin: 全局&quot;管家&quot;，可以在构建的任意环节插手</li></ul><hr><h3 id="_3-module-graph-vs-chunk-graph" tabindex="-1"><a class="header-anchor" href="#_3-module-graph-vs-chunk-graph" aria-hidden="true">#</a> 3. Module Graph vs Chunk Graph</h3><p>Webpack 的 module graph 与 chunk graph 分别是什么？它们之间的关系？为什么需要两个图？</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Module Graph (模块依赖图):

定义：
- 表示模块之间的依赖关系
- 是一个有向图，节点是模块，边是依赖关系
- 在编译阶段（Compilation）构建
- 反映了源代码的真实依赖结构

构建时机：
- 从 entry 开始递归解析
- 每遇到 import/require 就创建一条边
- 形成完整的依赖树

示例：
源代码结构：
  // index.js
  import utils from &#39;./utils.js&#39;;
  import(&#39;./async.js&#39;);  // 动态导入

  // utils.js
  import helper from &#39;./helper.js&#39;;

  // helper.js
  export const add = (a, b) =&gt; a + b;

Module Graph：
        index.js (entry)
           ↓
    ┌──────┴──────┐
    ↓             ↓
  utils.js    async.js (async)
    ↓
  helper.js

特点：
- 一个模块可能被多个模块依赖（菱形依赖）
- 包含同步依赖和异步依赖
- 是静态分析的结果

数据结构：
{
  moduleId: &#39;index.js&#39;,
  dependencies: [
    { module: &#39;utils.js&#39;, type: &#39;import&#39; },
    { module: &#39;async.js&#39;, type: &#39;import()&#39;, async: true }
  ],
  source: &#39;...&#39;,
  size: 1024
}

Chunk Graph (代码块图):

定义：
- 表示 chunk 之间的关系
- 是将 module graph 按照分割策略重新组织的结果
- 在优化阶段（Optimization）构建
- 反映了最终输出文件的组织结构

构建时机：
- 在 module graph 构建完成后
- 根据 entry、splitChunks、动态 import 等策略生成
- 决定了最终有多少个输出文件

示例（基于上面的 Module Graph）：

配置：
entry: {
  main: &#39;./src/index.js&#39;
},
optimization: {
  splitChunks: {
    cacheGroups: {
      vendors: {
        test: /node_modules/,
        name: &#39;vendors&#39;
      }
    }
  }
}

Chunk Graph：
┌─────────────────────┐
│  Chunk: main        │
│  - index.js         │
│  - utils.js         │
│  - helper.js        │
└─────────────────────┘
         ↓ (异步加载)
┌─────────────────────┐
│  Chunk: async       │
│  - async.js         │
└─────────────────────┘

如果有 node_modules 依赖：
┌─────────────────────┐       ┌─────────────────────┐
│  Chunk: vendors     │  ←──  │  Chunk: main        │
│  - react.js         │       │  - index.js         │
│  - lodash.js        │       │  - utils.js         │
└─────────────────────┘       └─────────────────────┘
                                       ↓
                              ┌─────────────────────┐
                              │  Chunk: async       │
                              │  - async.js         │
                              └─────────────────────┘

特点：
- 一个 chunk 包含多个 module
- 一个 module 可以属于多个 chunk（共享模块）
- chunk 之间有父子关系（entry chunk、async chunk）
- 最终会生成对应的 asset 文件

数据结构：
{
  chunkId: &#39;main&#39;,
  modules: [&#39;index.js&#39;, &#39;utils.js&#39;, &#39;helper.js&#39;],
  parents: [],  // 父 chunk
  children: [&#39;async&#39;],  // 子 chunk
  files: [&#39;main.bundle.js&#39;],
  hash: &#39;abc123&#39;
}

两者关系：

1. 转换关系（Module Graph → Chunk Graph）
   Module Graph                 Chunk Graph
   ┌──────────┐                ┌─────────────┐
   │  A  →  B │   分组         │  Chunk 1:   │
   │  ↓     ↓ │   ======&gt;      │   - A       │
   │  C  →  D │   策略         │   - B       │
   │  ↓       │                │   - C       │
   │  E (异步)│                └─────────────┘
   └──────────┘                ┌─────────────┐
                               │  Chunk 2:   │
                               │   - E       │
                               └─────────────┘

2. 多对多关系
   一个 Module 可以属于多个 Chunk（代码复用）
   一个 Chunk 包含多个 Module（代码聚合）

3. 依赖传递
   - Module Graph 的依赖关系决定了哪些模块需要打包在一起
   - Chunk Graph 的父子关系决定了运行时的加载顺序

4. 实际示例
   源码层面（Module Graph）：
     app.js → axios (来自 node_modules)
     page.js → axios (来自 node_modules)

   输出层面（Chunk Graph）：
     Chunk: vendors (包含 axios，被 app 和 page 共享)
     Chunk: app (包含 app.js)
     Chunk: page (包含 page.js)

为什么需要两个图：

原因1：职责分离
- Module Graph: 关注&quot;依赖关系&quot;
  → 回答：这个模块依赖哪些模块？
  → 目的：分析代码结构，Tree Shaking，循环依赖检测

- Chunk Graph: 关注&quot;打包策略&quot;
  → 回答：这些模块应该打包成几个文件？
  → 目的：代码分割，缓存优化，并行加载

原因2：灵活的分割策略
同一个 Module Graph 可以生成不同的 Chunk Graph

示例：相同的源代码，不同的配置
Module Graph:
  A → B → C → D

策略1：全部打包到一起
Chunk Graph: [Chunk: main (A, B, C, D)]
输出: main.js

策略2：按路由分割
Chunk Graph:
  [Chunk: home (A, B)]
  [Chunk: about (C, D)]
输出: home.js, about.js

策略3：提取公共依赖
Chunk Graph:
  [Chunk: vendors (B, D)]
  [Chunk: main (A, C)]
输出: vendors.js, main.js

原因3：优化需求
- Tree Shaking: 在 Module Graph 上标记未使用的导出
- Code Splitting: 在 Chunk Graph 上执行分割策略
- 缓存优化: Chunk Graph 可以分离稳定代码和业务代码

原因4：运行时需求
- Module Graph: 编译时静态分析
- Chunk Graph: 运行时动态加载的基础

示例：
  // 编译时：Module Graph 知道 async.js 是动态导入
  import(&#39;./async.js&#39;);

  // 运行时：Chunk Graph 确保 async.js 在单独的 chunk
  // 浏览器通过 &lt;script&gt; 按需加载

原因5：多入口场景
多个 entry 共享模块时，需要 Chunk Graph 来优化

Module Graph (多入口):
  entry1.js → common.js
  entry2.js → common.js

Chunk Graph (提取公共模块):
  Chunk: common (common.js)
  Chunk: entry1 (entry1.js)
  Chunk: entry2 (entry2.js)

如果只有 Module Graph，无法表达&quot;common.js 应该单独打包&quot;

【流程总结】

构建流程：
1. 从 entry 开始解析
2. 递归分析依赖 → 构建 Module Graph
3. 应用分割策略 → 生成 Chunk Graph
4. 渲染 Chunk → 生成 Asset
5. 输出文件

图的作用：
Module Graph: 保证依赖正确性
Chunk Graph: 保证输出合理性

【类比理解】

Module Graph = 原材料清单
  &quot;我需要哪些食材，它们之间有什么关系&quot;
  - 西红柿 → 需要切碎
  - 鸡蛋 → 需要打散
  - 食材之间的搭配关系

Chunk Graph = 出菜计划
  &quot;这些食材应该做成几道菜，如何组合&quot;
  - 第一道菜：西红柿炒鸡蛋（西红柿 + 鸡蛋）
  - 第二道菜：糖拌西红柿（西红柿 + 糖）
  - 西红柿被用在多道菜中（共享模块）

为什么需要两个？
  因为&quot;食材清单&quot;和&quot;出菜计划&quot;是两回事：
  - 食材清单关注&quot;有什么&quot;
  - 出菜计划关注&quot;怎么做&quot;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br></div></div><hr><h3 id="_4-rollup-tree-shaking" tabindex="-1"><a class="header-anchor" href="#_4-rollup-tree-shaking" aria-hidden="true">#</a> 4. Rollup Tree-shaking</h3><p>Rollup 的 tree-shaking 为什么通常比 Webpack 更&quot;干净&quot;？需要满足哪些条件才能有效 tree-shake？</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Rollup tree-shaking 更干净的原因：

原因1：输出格式不同

【Webpack 输出（IIFE 包裹）】
// webpack bundle
(function(modules) {
  var installedModules = {};
  function __webpack_require__(moduleId) {
    // ...模块加载逻辑
  }
  return __webpack_require__(0);
})([
  /* 0: index.js */
  function(module, exports, __webpack_require__) {
    const { add } = __webpack_require__(1);
    console.log(add(1, 2));
  },
  /* 1: utils.js */
  function(module, exports) {
    exports.add = (a, b) =&gt; a + b;
    exports.subtract = (a, b) =&gt; a - b;  // 未使用但仍在
  }
]);

问题：
- 每个模块被函数包裹，难以静态分析
- 运行时加载机制增加了代码量
- 即使 tree-shaking，也会留下模块骨架

【Rollup 输出（扁平化）】
// rollup bundle
const add = (a, b) =&gt; a + b;
// subtract 直接被删除，干干净净

console.log(add(1, 2));

优势：
- 直接输出 ES6 代码，无运行时包裹
- 所有模块被&quot;拍平&quot;到一个作用域
- 未使用的导出直接不存在

原因2：Scope Hoisting（作用域提升）

Webpack (不开启 scope hoisting):
// 模块1
function module1() {
  const name = &#39;webpack&#39;;
  return name;
}
// 模块2
function module2() {
  const result = module1();
  console.log(result);
}

Rollup (默认提升):
// 所有代码在同一作用域
const name = &#39;webpack&#39;;
const result = name;
console.log(result);

效果对比：
- Webpack: 保留模块边界 → 体积大
- Rollup: 消除模块边界 → 体积小

原因3：设计目标不同

Webpack:
- 设计目标：应用打包器（Application Bundler）
- 需要支持：
  ✓ CommonJS 和 ES6 混用
  ✓ 代码分割
  ✓ 动态加载 import()
  ✓ HMR 热更新
  ✓ 复杂的 loader/plugin 生态
- 代价：为了兼容性和功能，牺牲了一定的 tree-shaking 效果

Rollup:
- 设计目标：库打包器（Library Bundler）
- 专注于：
  ✓ 纯 ES6 模块
  ✓ 静态分析
  ✓ 最小化输出
  ✓ 适合打包组件库、工具库
- 优势：专注导致 tree-shaking 更彻底

原因4：副作用处理更严格

示例代码：
// utils.js
export const add = (a, b) =&gt; a + b;
console.log(&#39;utils loaded&#39;);  // 副作用

// index.js
import { add } from &#39;./utils&#39;;

Webpack:
- 保守策略：有 console.log，保留整个模块
- 除非在 package.json 中明确标记 &quot;sideEffects&quot;: false

Rollup:
- 更激进：分析代码，只保留必要的副作用
- 默认假设 ES6 模块无副作用

原因5：Dead Code Elimination 更彻底

示例：
// math.js
export const add = (a, b) =&gt; a + b;
export const complex = (x) =&gt; {
  const temp = x * 2;
  const result = temp + 10;
  return result;
};

// index.js
import { add } from &#39;./math&#39;;
console.log(add(1, 2));
// complex 未使用

Webpack 输出：
// 可能保留 complex 的定义（取决于配置）
const add = (a, b) =&gt; a + b;
const complex = (x) =&gt; { /* ... */ };  // ❌ 仍然存在

Rollup 输出：
const add = (a, b) =&gt; a + b;  // ✅ 只有 add

console.log(add(1, 2));

原因6：对循环依赖的处理

Webpack:
// a.js
import { b } from &#39;./b&#39;;
export const a = &#39;a&#39; + b;

// b.js
import { a } from &#39;./a&#39;;
export const b = &#39;b&#39;;

Webpack 需要运行时处理循环依赖 → 增加代码

Rollup:
- 静态分析时就会报错或警告
- 强制开发者解决循环依赖
- 输出更可预测

原因7：配置默认值不同

Webpack (需要手动配置):
optimization: {
  usedExports: true,        // 标记未使用的导出
  minimize: true,            // 压缩代码
  sideEffects: true,         // 考虑副作用
  concatenateModules: true   // scope hoisting (production 默认)
}

Rollup (默认开启):
// 默认就是最优的 tree-shaking
// 无需额外配置

对比示例：

源代码：
// utils.js
export const add = (a, b) =&gt; a + b;
export const subtract = (a, b) =&gt; a - b;
export const multiply = (a, b) =&gt; a * b;
export const divide = (a, b) =&gt; a / b;

// index.js
import { add } from &#39;./utils&#39;;
console.log(add(1, 2));

【Webpack 输出（production mode）】
// ... webpack runtime code ...
const add = (a, b) =&gt; a + b;
// ✅ subtract, multiply, divide 被删除
// ❌ 但有 webpack 运行时代码（~200 bytes）

【Rollup 输出】
const add = (a, b) =&gt; a + b;
console.log(add(1, 2));
// ✅ 完全干净，只有必要代码

体积对比：
- Webpack: ~250 bytes
- Rollup: ~50 bytes

有效 tree-shake 的条件：

条件1：使用 ES6 模块（ESM）

✅ 可以 tree-shake:
// ESM - 静态导入导出
export const add = (a, b) =&gt; a + b;
import { add } from &#39;./math&#39;;

❌ 不能 tree-shake:
// CommonJS - 动态导入导出
module.exports.add = (a, b) =&gt; a + b;
const { add } = require(&#39;./math&#39;);

原因：
- ESM: 编译时确定依赖关系（静态）
- CommonJS: 运行时确定依赖关系（动态）

反例：
// 动态导出 - 无法 tree-shake
const funcs = { add, subtract };
module.exports = funcs[condition ? &#39;add&#39; : &#39;subtract&#39;];

条件2：避免副作用（Side Effects）

✅ 无副作用:
// pure 函数
export const add = (a, b) =&gt; a + b;

❌ 有副作用（会被保留）:
export const add = (a, b) =&gt; a + b;
console.log(&#39;math module loaded&#39;);  // 副作用
window.mathLoaded = true;            // 副作用
document.title = &#39;App&#39;;              // 副作用

解决方法：
1. 在 package.json 中声明
{
  &quot;sideEffects&quot;: false  // 所有文件无副作用
}

或

{
  &quot;sideEffects&quot;: [
    &quot;*.css&quot;,        // CSS 文件有副作用
    &quot;src/polyfills.js&quot;
  ]
}

2. 使用 /*#__PURE__*/ 注释
const result = /*#__PURE__*/ complexCalculation();
export default result;
// 告诉打包器：这个函数调用无副作用

条件3：避免默认导出对象

❌ 难以 tree-shake:
// utils.js
export default {
  add: (a, b) =&gt; a + b,
  subtract: (a, b) =&gt; a - b
};

// index.js
import utils from &#39;./utils&#39;;
console.log(utils.add(1, 2));
// 问题：整个对象都会被打包

✅ 易于 tree-shake:
// utils.js
export const add = (a, b) =&gt; a + b;
export const subtract = (a, b) =&gt; a - b;

// index.js
import { add } from &#39;./utils&#39;;
console.log(add(1, 2));
// ✅ 只有 add 被打包

条件4：避免在导入时执行代码

❌ 会阻止 tree-shake:
// config.js
const config = {
  api: process__.env.API_URL
};
export default config;

// 导入时就会执行
import config from &#39;./config&#39;;

✅ 推迟执行:
// config.js
export const getConfig = () =&gt; ({
  api: process__.env.API_URL
});

// 需要时才调用
import { getConfig } from &#39;./config&#39;;
const config = getConfig();

条件5：类的使用要注意

❌ 类方法难以 tree-shake:
class Utils {
  add(a, b) { return a + b; }
  subtract(a, b) { return a - b; }
  multiply(a, b) { return a * b; }
}
export default new Utils();

// 使用
import utils from &#39;./utils&#39;;
utils.add(1, 2);
// 问题：整个类实例都会被打包

✅ 分离导出:
export const add = (a, b) =&gt; a + b;
export const subtract = (a, b) =&gt; a - b;
export const multiply = (a, b) =&gt; a * b;

条件6：正确配置 Babel

❌ Babel 转换破坏 ESM:
// .babelrc (错误配置)
{
  &quot;presets&quot;: [
    [&quot;@babel/preset-env&quot;, {
      &quot;modules&quot;: &quot;commonjs&quot;  // ❌ 转成 CommonJS
    }]
  ]
}

✅ 保留 ESM:
{
  &quot;presets&quot;: [
    [&quot;@babel/preset-env&quot;, {
      &quot;modules&quot;: false  // ✅ 保留 ES6 模块
    }]
  ]
}

条件7：避免动态导入路径

❌ 动态路径:
const moduleName = condition ? &#39;a&#39; : &#39;b&#39;;
import(`./${moduleName}.js`);  // 无法静态分析

✅ 静态路径:
if (condition) {
  import(&#39;./a.js&#39;);
} else {
  import(&#39;./b.js&#39;);
}

条件8：使用支持 tree-shaking 的库

❌ 不支持:
import _ from &#39;lodash&#39;;  // 整个 lodash (~70KB)
_.add(1, 2);

✅ 支持:
import add from &#39;lodash-es/add&#39;;  // 只导入需要的
add(1, 2);

或使用插件：
import { add } from &#39;lodash&#39;;  // 配合 babel-plugin-lodash

【验证 tree-shaking 效果】

方法1：分析产物
// package.json
{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack --mode production&quot;,
    &quot;analyze&quot;: &quot;webpack-bundle-analyzer dist/stats.json&quot;
  }
}

方法2：查看未使用的导出
// webpack.config.js
optimization: {
  usedExports: true
}

// 构建后查看警告信息

方法3：对比体积
// 记录优化前后的 bundle 大小

【最佳实践总结】

1. ✅ 使用 ES6 模块，不用 CommonJS
2. ✅ 命名导出优于默认导出
3. ✅ 在 package.json 声明 sideEffects
4. ✅ Babel 配置保留 ES6 模块
5. ✅ 使用支持 tree-shaking 的库
6. ✅ 避免在模块顶层执行副作用代码
7. ✅ 优先使用 Rollup 打包库，Webpack 打包应用
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br></div></div><hr><h3 id="_5-vite-为什么快" tabindex="-1"><a class="header-anchor" href="#_5-vite-为什么快" aria-hidden="true">#</a> 5. Vite 为什么快</h3><p>Vite dev 为什么快？请从三个层面分析：请求、编译、缓存/预构建。</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>请求层面：

核心：按需加载，利用浏览器原生 ESM

1. No Bundle 开发模式

   Webpack 开发流程：
   启动开发服务器
     ↓
   分析所有模块 (5000+ 文件)
     ↓
   打包所有文件
     ↓
   生成 bundle
     ↓
   启动完成 (20-30秒)  ← 慢！
     ↓
   访问 localhost:3000
     ↓
   返回 bundle.js (几 MB)

   Vite 开发流程：
   启动开发服务器
     ↓
   预构建依赖 (node_modules)
     ↓
   启动完成 (200-300ms)  ← 快！
     ↓
   访问 localhost:5173
     ↓
   浏览器请求 index.html
     ↓
   解析 `\&lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;\&gt;`
     ↓
   按需编译 main.js → 返回
     ↓
   浏览器解析 main.js 中的 import
     ↓
   按需编译依赖模块 → 返回
     ↓
   逐步加载，快速响应

2. 浏览器原生 ESM

   Vite 输出：

  &lt;!-- index.html --&gt;
  &lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;&gt;&lt;/script&gt;

  // main.js (Vite 处理后)
  import { createApp } from &#39;/node_modules/.vite/deps/vue.js?v=abc123&#39;
  import App from &#39;/src/App.vue&#39; // 浏览器原生支持

  createApp(App).mount(&#39;#app&#39;)

   优势：
   ✅ 不需要打包，浏览器直接加载 ES6 模块
   ✅ 每个文件都是独立的 HTTP 请求
   ✅ 强缓存：304 Not Modified
   ✅ 并行加载，充分利用 HTTP/2

3. 精确的依赖图

   只编译访问到的文件：

   App.vue
     ↓ 浏览器请求
   Vite 编译 App.vue → 返回 (10ms)
     ↓ 发现 import Header
   Vite 编译 Header.vue → 返回 (5ms)
     ↓ 发现 import Button
   Vite 编译 Button.vue → 返回 (3ms)

   未访问的路由组件：完全不编译 ✅

   对比 Webpack：
   - 启动时编译所有文件（包括未使用的）
   - 即使开启 lazy loading，也要分析依赖

4. 请求拦截和转换

   浏览器请求：
   GET /src/App.vue

   Vite Dev Server 中间件：
   ┌────────────────────────────────┐
   │ 1. 读取 App.vue                │
   │ 2. Vue SFC 编译器处理          │
   │ 3. 转换 import 路径             │
   │ 4. 注入 HMR 代码                │
   │ 5. 返回 JavaScript             │
   └────────────────────────────────┘

   返回：
   import { render } from &#39;/src/App.vue?type=template&#39;;
   import script from &#39;/src/App.vue?type=script&#39;;
   script.render = render;
   export default script;

   特点：
   - 实时编译：只在请求时编译
   - 增量编译：修改一个文件，只重新编译这个文件
   - 快速响应：单文件编译耗时 &lt; 10ms

编译层面：

核心：esbuild 预构建 + 原生 ESM

1. esbuild 极速编译

   速度对比：
   Webpack (Babel):
     10000 个文件 → 20-30 秒

   Vite (esbuild):
     10000 个文件 → 1-2 秒

   快 10-100 倍！

   原因：
   ✅ Go 语言编写（接近机器码）
      vs Babel 的 JavaScript（解释执行）

   ✅ 高度并行化
      充分利用多核 CPU

   ✅ 零拷贝优化
      直接操作内存，减少解析开销

   ✅ 增量编译
      只重新编译修改的部分

2. 依赖预构建（Pre-bundling）

   为什么需要预构建：

   问题1：CommonJS 转 ESM
   // lodash (CommonJS)
   module.exports = { ... }

   // 浏览器不支持 require
   const _ = require(&#39;lodash&#39;);  // ❌ 报错

   解决：esbuild 将 node_modules 中的 CommonJS 转为 ESM
   import _ from &#39;/node_modules/.vite/deps/lodash.js&#39;;  // ✅

   问题2：减少 HTTP 请求
   // lodash-es 有 600+ 个模块
   import debounce from &#39;lodash-es/debounce&#39;;
   // 会导致 600+ 个 HTTP 请求 ❌

   解决：esbuild 将 lodash-es 打包成一个文件
   import { debounce } from &#39;/node_modules/.vite/deps/lodash-es.js&#39;;
   // 只有 1 个请求 ✅

   预构建流程：
   首次启动 Vite
     ↓
   扫描 import 语句，发现依赖
     ↓
   esbuild 打包 node_modules
     ↓
   生成 .vite/deps/
     ↓
   添加强缓存 (max-age=31536000)

3. 单文件编译

   Vite 编译流程：

   请求 /src/App.vue
     ↓
   读取文件内容
     ↓
   根据文件类型选择编译器：
     - .vue → @vitejs/plugin-vue
     - .jsx → esbuild
     - .ts → esbuild
     - .css → postcss
     ↓
   编译单个文件 (&lt; 10ms)
     ↓
   返回结果 + 缓存

   对比 Webpack：
   Webpack: 打包整个 bundle → 修改一行代码 → 重新打包 (1-5s)
   Vite: 编译单个文件 → 修改一行代码 → 只重新编译这个文件 (10ms)

4. 智能代码分割

   Vite 自动按路由分割：

   // router.js
   const Home = () =&gt; import(&#39;./Home.vue&#39;);
   const About = () =&gt; import(&#39;./About.vue&#39;);

   编译结果：
   - 访问 /home → 只加载 Home.vue 及其依赖
   - 访问 /about → 只加载 About.vue 及其依赖

   动态加载：
   GET /src/views/Home.vue
   GET /src/components/HomeHeader.vue

   未访问 About，完全不请求 ✅

5. TypeScript 编译

   esbuild 编译 TS：
   - 只做类型擦除（Type Stripping）
   - 不做类型检查（可选的，通过 vue-tsc）
   - 速度极快：10x faster than tsc

   // tsconfig.json
   {
     &quot;compilerOptions&quot;: {
       &quot;isolatedModules&quot;: true  // esbuild 要求
     }
   }

缓存/预构建层面：

核心：多层缓存 + 智能失效

1. HTTP 强缓存

   依赖模块（node_modules）：
   GET /node_modules/.vite/deps/vue.js?v=abc123
   Response Headers:
     Cache-Control: max-age=31536000, immutable

   一年强缓存！304 Not Modified

   源码模块：
   GET /src/App.vue?t=1234567890
   Response Headers:
     Cache-Control: no-cache
     ETag: &quot;abc123&quot;

   协商缓存，确保最新

2. 文件系统缓存

   预构建缓存位置：
   node_modules/.vite/deps/
     ├── vue.js              (预构建的依赖)
     ├── vue.js.map
     ├── _metadata.json      (依赖图元数据)
     └── package.json

   缓存失效条件：
   ✅ package.json 中的依赖版本变化
   ✅ 包管理器的 lockfile 变化
   ✅ vite.config.js 中的相关配置变化
   ✅ NODE_ENV 环境变量变化

   只有这些变化时才重新预构建，否则直接使用缓存 ✅

3. 内存缓存

   Vite 内部缓存：
   const moduleCache = new Map();

   function transformModule(url) {
     if (moduleCache.has(url)) {
       return moduleCache.get(url);  // 命中缓存 ✅
     }

     const result = compile(url);
     moduleCache.set(url, result);
     return result;
   }

   HMR 更新时：
   - 只清除修改文件的缓存
   - 其他文件继续使用内存缓存

4. 依赖预扫描（Dependency Pre-Scanning）

   首次启动优化：

   传统方式：
   启动服务器 → 访问页面 → 发现依赖 → 预构建 → 刷新页面

   Vite 优化：
   启动服务器 → 同时扫描入口文件 → 提前预构建 → 访问页面时已就绪

   扫描逻辑：
   1. 分析 index.html 中的 `&lt;script type=&quot;module&quot;&gt;`
   2. esbuild 快速扫描，收集 import
   3. 并行预构建所有依赖
   4. 在用户访问前完成（冷启动优化）

5. 智能失效和重新验证

   监听文件变化：
   chokidar.watch(&#39;src/**/*&#39;).on(&#39;change&#39;, (path) =&gt; {
     // 只清除相关缓存
     invalidateModule(path);

     // HMR 更新
     hmr.send({
       type: &#39;update&#39;,
       path,
       timestamp: Date.now()
     });
   });
   精准失效：
   修改 App.vue
     ↓
   只清除 App.vue 的缓存
     ↓
   依赖 App.vue 的模块接收 HMR 更新
     ↓
   其他模块缓存仍然有效 ✅

6. 预构建优化检测

   自动检测缺失的依赖：

   访问页面 → 发现新的 import → 运行时预构建

   // 首次没有导入 axios
   // 后来添加：
   import axios from &#39;axios&#39;;

   Vite 自动：
   1. 检测到新依赖
   2. 立即预构建 axios
   3. 刷新页面（自动）
   4. 使用预构建的 axios

【速度对比实例】

场景：大型 Vue3 项目（5000+ 组件）

冷启动：
Webpack dev server:
  - 分析模块：15s
  - 打包构建：25s
  - 总计：40s ❌

Vite dev server:
  - 预构建依赖：2s
  - 启动服务器：0.3s
  - 总计：2.3s ✅

  快 17 倍！

热更新：
修改一个组件：

Webpack HMR:
  - 重新打包相关模块：1-3s
  - 浏览器更新：0.5s
  - 总计：1.5-3.5s

Vite HMR:
  - 重新编译单个文件：10ms
  - 浏览器更新：50ms
  - 总计：60ms ✅

  快 25-60 倍！

【Vite 快的本质总结】

1. 架构创新：
   ❌ Webpack: Bundle-based（先打包再服务）
   ✅ Vite: Native ESM-based（按需编译）

2. 工具选择：
   ❌ Webpack: Babel/Terser (JavaScript)
   ✅ Vite: esbuild (Go) + Rollup (生产)

3. 编译策略：
   ❌ Webpack: 全量编译
   ✅ Vite: 增量编译 + 按需编译

4. 缓存利用：
   ❌ Webpack: 内存缓存为主
   ✅ Vite: HTTP 缓存 + 文件缓存 + 内存缓存

5. 浏览器能力：
   ❌ Webpack: 不依赖浏览器 ESM
   ✅ Vite: 充分利用现代浏览器特性

【权衡和限制】

Vite 的限制：
1. 需要现代浏览器支持 ESM（IE11 需要额外配置）
2. 首次访问路由时需要编译（按需加载的代价）
3. 生产环境仍需打包（使用 Rollup）

Webpack 的优势：
1. 生态更成熟，plugin 更丰富
2. 兼容性更好（支持老浏览器）
3. 适合复杂的构建需求

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br></div></div><hr><h3 id="_6-webpack-hmr-原理" tabindex="-1"><a class="header-anchor" href="#_6-webpack-hmr-原理" aria-hidden="true">#</a> 6. Webpack HMR 原理</h3><p>解释 Webpack HMR 的基本原理，包括：hash、manifest、module.hot API、更新边界的概念。</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Hash 的作用：

1. 唯一标识每次构建
   每次编译都会生成新的 hash 值：

   第一次编译：
   Hash: abc123
   main.abc123.js

   修改代码后：
   Hash: def456
   main.def456.js

2. 文件版本控制
   不同类型的 hash：

   【hash】- 整个项目的 hash
   output: {
     filename: &#39;[name].[hash].js&#39;
   }
   所有文件共享同一个 hash，任何文件改变都会导致所有文件 hash 变化

   【chunkhash】- 每个 chunk 的 hash
   output: {
     filename: &#39;[name].[chunkhash].js&#39;
   }
   基于 chunk 内容生成，只有该 chunk 变化时才改变
   适用于代码分割场景

   【contenthash】- 文件内容的 hash
   output: {
     filename: &#39;[name].[contenthash].js&#39;
   }
   基于文件内容生成，最精准的缓存控制
   适用于 CSS 等资源文件

3. HMR 中的 hash 作用

   浏览器端：
   当前 hash: abc123

   Webpack Dev Server 推送：
   {
     type: &#39;hash&#39;,
     data: &#39;def456&#39;  // 新的 hash
   }

   浏览器更新：
   currentHash = &#39;def456&#39;;

   用途：
   - 标识构建版本
   - 请求更新资源时作为参数
   - 避免缓存问题

Manifest 是什么：

1. 定义
   Manifest 是描述模块更新信息的 JSON 文件
   记录了哪些模块发生了变化

2. 结构示例

   // hot-update.json (manifest)
   {
     &quot;h&quot;: &quot;def456&quot;,           // 新的 hash
     &quot;c&quot;: {                   // changed modules
       &quot;main&quot;: true           // main chunk 有更新
     }
   }

   浏览器收到后，知道需要请求：
   main.def456.hot-update.js  // 具体的更新模块

3. 更新模块文件

   // main.def456.hot-update.js
   self[&quot;webpackHotUpdate&quot;](&quot;main&quot;, {
     &quot;./src/App.js&quot;: (function(module, exports, __webpack_require__) {
       // 更新后的 App.js 代码
       const App = () =&gt; {
         return &lt;div&gt;Updated!&lt;/div&gt;;
       };
       module.exports = App;
     })
   });

4. Manifest 的作用

   流程：
   1. 文件变化 → Webpack 重新编译
   2. 生成新的 hash: def456
   3. 生成 manifest: def456.hot-update.json
   4. 生成更新模块: main.def456.hot-update.js
   5. 通过 WebSocket 推送 hash
   6. 浏览器请求 manifest
   7. 浏览器根据 manifest 请求更新的模块
   8. 应用更新

module.hot API：

1. 基本 API

   【module.hot.accept】
   接受模块更新，定义如何处理更新

   // App.js
   if (module.hot) {
     module.hot.accept(&#39;./Button.js&#39;, function() {
       // Button.js 更新时的回调
       console.log(&#39;Button updated!&#39;);
       // 可以在这里重新渲染
     });
   }

   无参数形式（接受自身更新）：
   if (module.hot) {
     module.hot.accept(err =&gt; {
       if (err) {
         console.error(&#39;HMR 更新失败&#39;, err);
       }
     });
   }

   【module.hot.decline】
   拒绝模块更新，触发完整刷新

   if (module.hot) {
     module.hot.decline(&#39;./config.js&#39;);
     // config.js 更新时，强制刷新页面
   }

   【module.hot.dispose】
   模块被替换前的清理函数

   if (module.hot) {
     module.hot.dispose(function(data) {
       // 保存状态，供新模块使用
       data.count = currentCount;

       // 清理副作用
       clearInterval(timer);
       removeEventListener(&#39;click&#39;, handler);
     });
   }

   【module.hot.status】
   获取 HMR 状态

   console.log(module.hot.status());
   // &#39;idle&#39; - 等待中
   // &#39;check&#39; - 检查更新
   // &#39;prepare&#39; - 准备更新
   // &#39;ready&#39; - 更新已下载
   // &#39;dispose&#39; - 清理旧模块
   // &#39;apply&#39; - 应用更新
   // &#39;abort&#39; - 更新中止
   // &#39;fail&#39; - 更新失败

2. 实际使用示例

   【React 组件 HMR】
   // App.jsx
   import React from &#39;react&#39;;
   import { render } from &#39;react-dom&#39;;
   import Root from &#39;./Root&#39;;

   const rootEl = document.getElementById(&#39;root&#39;);
   render(&lt;Root /&gt;, rootEl);

   if (module.hot) {
     module.hot.accept(&#39;./Root&#39;, () =&gt; {
       // Root 组件更新时，重新渲染
       const NextRoot = require(&#39;./Root&#39;).default;
       render(&lt;NextRoot /&gt;, rootEl);
     });
   }

   【Vue 组件 HMR】
   // main.js
   import { createApp } from &#39;vue&#39;;
   import App from &#39;./App.vue&#39;;

   const app = createApp(App);
   app.mount(&#39;#app&#39;);

   if (module.hot) {
     module.hot.accept(&#39;./App.vue&#39;, () =&gt; {
       const NewApp = require(&#39;./App.vue&#39;).default;
       app.unmount();
       createApp(NewApp).mount(&#39;#app&#39;);
     });
   }

   【状态保持示例】
   let count = 0;

   function increment() {
     count++;
     render();
   }

   if (module.hot) {
     // 保存状态
     module.hot.dispose(data =&gt; {
       data.count = count;
     });

     // 恢复状态
     if (module.hot.data) {
       count = module.hot.data.count || 0;
     }

     // 接受更新
     module.hot.accept();
   }

3. Loader 集成 HMR

   【style-loader】
   自动支持 CSS HMR：

   // style-loader 内部实现（简化）
   if (module.hot) {
     module.hot.accept();
     module.hot.dispose(() =&gt; {
       // 移除旧样式
       removeStyle();
     });
     // 应用新样式
     insertStyle(newCss);
   }

   【vue-loader】
   自动注入 HMR 代码：

   // vue-loader 处理后
   import script from &#39;./App.vue?vue&amp;type=script&#39;;
   import render from &#39;./App.vue?vue&amp;type=template&#39;;

   if (module.hot) {
     module.hot.accept(&#39;./App.vue?vue&amp;type=template&#39;, () =&gt; {
       __VUE_HMR_RUNTIME__.rerender(id, render);
     });
   }

更新边界：

1. 概念
   更新边界是指能够接受（accept）模块更新的位置
   如果一个模块没有定义如何接受更新，更新会向上冒泡

2. 冒泡机制

   模块依赖链：
   index.js → App.js → Button.js → utils.js

   场景1：Button.js 接受更新
   utils.js 修改
     ↓
   查找 utils.js 的 module.hot.accept
     ✅ 找到！更新边界在 utils.js
     ↓
   只更新 utils.js，不影响上层

   场景2：Button.js 不接受更新
   utils.js 修改
     ↓
   utils.js 没有 accept
     ↓
   向上冒泡到 Button.js
     ↓
   Button.js 有 accept
     ✅ 更新边界在 Button.js
     ↓
   重新执行 Button.js 及其依赖

   场景3：所有模块都不接受
   utils.js 修改
     ↓
   一路冒泡到 index.js
     ↓
   index.js 也没有 accept
     ❌ 触发完整页面刷新（fallback）

3. 更新边界示例

   【合理的边界】
   // index.js (入口)
   import App from &#39;./App&#39;;

   render(App);

   if (module.hot) {
     module.hot.accept(&#39;./App&#39;, () =&gt; {
       // App 或其子组件更新时，重新渲染
       render(require(&#39;./App&#39;).default);
     });
   }

   这样，App 及其所有子组件的更新都会在这里处理 ✅

   【过细的边界】
   // 每个组件都定义 accept
   // Button.js
   if (module.hot) {
     module.hot.accept();
   }

   // Header.js
   if (module.hot) {
     module.hot.accept();
   }

   问题：代码冗余，维护困难 ❌

   【无边界】
   // 所有模块都没有 module.hot.accept
   结果：任何修改都会刷新页面 ❌

4. 更新边界最佳实践

   ✅ 在框架入口设置边界（React/Vue）
   ✅ CSS 由 loader 自动处理
   ✅ 业务代码无需手动添加
   ✅ 使用框架提供的 HMR 插件

   示例配置：
   // webpack.config.js
   plugins: [
     new ReactRefreshWebpackPlugin(),  // React 自动 HMR
   ]

完整流程：

1. 启动阶段

   Webpack Dev Server 启动
     ↓
   构建项目，生成 hash: abc123
     ↓
   启动 WebSocket 服务器（默认端口 ws://localhost:8080）
     ↓
   浏览器访问页面
     ↓
   注入 HMR Runtime 代码：
     - WebSocket 客户端
     - module.hot API 实现
     - 更新应用逻辑
     ↓
   建立 WebSocket 连接
     ↓
   浏览器端存储当前 hash: abc123

2. 文件修改阶段

   开发者修改 Button.js
     ↓
   Webpack 监听到文件变化（chokidar）
     ↓
   触发重新编译（增量编译）
     ↓
   只编译变化的模块及其依赖
     ↓
   生成新的 hash: def456
     ↓
   生成 manifest 文件：
     - def456.hot-update.json (描述哪些 chunk 更新)
     ↓
   生成更新模块文件：
     - main.def456.hot-update.js (具体的模块代码)

3. 通知阶段

   Webpack 编译完成
     ↓
   通过 WebSocket 推送消息给浏览器：

   消息1：
   {
     type: &#39;hash&#39;,
     data: &#39;def456&#39;  // 新的 hash
   }

   消息2：
   {
     type: &#39;ok&#39;  // 编译成功，可以更新
   }

4. 检查阶段（浏览器端）

   浏览器收到消息
     ↓
   更新本地 hash: def456
     ↓
   调用 module.hot.check() 检查更新
     ↓
   请求 manifest 文件：
   GET /abc123.hot-update.json

   返回：
   {
     &quot;h&quot;: &quot;def456&quot;,
     &quot;c&quot;: { &quot;main&quot;: true }
   }
     ↓
   解析 manifest，知道 main chunk 有更新

5. 下载阶段

   请求更新的模块：
   GET /main.def456.hot-update.js

   返回：
   webpackHotUpdate(&quot;main&quot;, {
     &quot;./src/Button.js&quot;: function(module, exports, require) {
       // 新的 Button.js 代码
     }
   });
     ↓
   更新模块被下载到浏览器

6. 应用阶段

   查找更新模块的依赖链
     ↓
   向上查找是否有 module.hot.accept
     ↓
   找到更新边界（如 App.js）
     ↓
   调用 dispose 回调（清理旧模块）
     ↓
   替换旧模块为新模块
     ↓
   调用 accept 回调（应用新模块）
     ↓
   重新执行模块代码
     ↓
   UI 更新，不刷新页面 ✅

7. 失败处理

   如果没找到更新边界
     ↓
   或者更新过程出错
     ↓
   自动降级：刷新页面
     ↓
   window.location.reload()

【流程图总结】

Webpack (编译) ←→ WebSocket Server ←→ Browser (HMR Runtime)

编译端：
  文件变化
    ↓
  增量编译
    ↓
  生成 hash
    ↓
  生成 manifest
    ↓
  生成 hot-update.js

传输端（WebSocket）：
  推送 hash 消息
    ↓
  推送 ok 消息

浏览器端：
  接收消息
    ↓
  请求 manifest
    ↓
  请求 hot-update.js
    ↓
  查找更新边界
    ↓
  应用更新
    ↓
  重新渲染

【HMR vs 完整刷新对比】

完整刷新：
  修改代码 → 刷新页面 → 重新加载所有资源 → 丢失状态 → 体验差

HMR：
  修改代码 → 增量更新 → 只加载变化模块 → 保持状态 → 体验好

示例：
场景：表单填写到一半，修改样式

完整刷新：
  输入的数据全部丢失 ❌
  需要重新填写

HMR：
  输入的数据保留 ✅
  样式实时更新
  继续填写表单
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br></div></div><hr><h2 id="面试题-4-题" tabindex="-1"><a class="header-anchor" href="#面试题-4-题" aria-hidden="true">#</a> 面试题（4 题）</h2><h3 id="_1-从-0-设计打包器" tabindex="-1"><a class="header-anchor" href="#_1-从-0-设计打包器" aria-hidden="true">#</a> 1. 从 0 设计打包器</h3><p>从 0 设计一个打包器，你会如何抽象&quot;模块解析、依赖图构建、产物生成&quot;这三个核心环节？需要考虑哪些扩展点？</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>核心架构设计：

┌─────────────────────────────────────────────────────────┐
│                    Mini Bundler                         │
├─────────────────────────────────────────────────────────┤
│  1. 配置层 (Configuration)                              │
│     - entry, output, plugins, loaders                  │
│  2. 编译器 (Compiler)                                   │
│     - 统筹整个构建流程                                  │
│  3. 模块解析器 (Resolver)                               │
│     - 路径解析、文件查找                                │
│  4. 依赖图构建器 (Graph Builder)                        │
│     - AST 解析、依赖收集                                │
│  5. 转换器 (Transformer)                                │
│     - Loader 链式调用                                   │
│  6. 代码生成器 (Code Generator)                         │
│     - 生成最终 bundle                                   │
│  7. 插件系统 (Plugin System)                            │
│     - 生命周期钩子                                      │
└─────────────────────────────────────────────────────────┘

一、模块解析（Module Resolution）

1. 核心功能
   输入：模块标识符（如 &#39;./utils&#39;, &#39;lodash&#39;, &#39;@/components/Button&#39;）
   输出：绝对文件路径（如 &#39;/project/src/utils.js&#39;）

2. 解析算法

   class Resolver {
     constructor(options) {
       this.extensions = options.extensions || [&#39;.js&#39;, &#39;.json&#39;];
       this.alias = options.alias || {};
       this.modules = options.modules || [&#39;node_modules&#39;];
     }

     resolve(context, request) {
       // 步骤1: 处理别名
       const aliasedRequest = this.resolveAlias(request);

       // 步骤2: 判断模块类型
       if (this.isRelative(aliasedRequest)) {
         // 相对路径：./utils
         return this.resolveRelative(context, aliasedRequest);
       } else if (this.isAbsolute(aliasedRequest)) {
         // 绝对路径：/src/utils
         return this.resolveAbsolute(aliasedRequest);
       } else {
         // 第三方包：lodash
         return this.resolveNodeModules(context, aliasedRequest);
       }
     }

     resolveAlias(request) {
       // &#39;@/components&#39; → &#39;src/components&#39;
       for (const [key, value] of Object.entries(this.alias)) {
         if (request.startsWith(key)) {
           return request.replace(key, value);
         }
       }
       return request;
     }

     resolveRelative(context, request) {
       const basePath = path.join(context, request);
       return this.tryResolve(basePath);
     }

     tryResolve(basePath) {
       // 尝试直接访问
       if (fs.existsSync(basePath) &amp;&amp; fs.statSync(basePath).isFile()) {
         return basePath;
       }

       // 尝试添加扩展名
       for (const ext of this.extensions) {
         const pathWithExt = basePath + ext;
         if (fs.existsSync(pathWithExt)) {
           return pathWithExt;
         }
       }

       // 尝试 index 文件
       for (const ext of this.extensions) {
         const indexPath = path.join(basePath, `index${ext}`);
         if (fs.existsSync(indexPath)) {
           return indexPath;
         }
       }

       throw new Error(`Cannot find module: ${basePath}`);
     }

     resolveNodeModules(context, request) {
       // 从当前目录向上查找 node_modules
       let dir = context;
       while (true) {
         const modulePath = path.join(dir, &#39;node_modules&#39;, request);

         if (fs.existsSync(modulePath)) {
           // 读取 package.json，查找 main 字段
           const pkgPath = path.join(modulePath, &#39;package.json&#39;);
           if (fs.existsSync(pkgPath)) {
             const pkg = require(pkgPath);
             const entry = pkg.main || &#39;index.js&#39;;
             return path.join(modulePath, entry);
           }
           return this.tryResolve(modulePath);
         }

         const parent = path.dirname(dir);
         if (parent === dir) break;  // 到达根目录
         dir = parent;
       }

       throw new Error(`Cannot find module: ${request}`);
     }
   }

3. 扩展点
   - 自定义解析策略（resolvers）
   - 文件系统抽象（支持虚拟文件系统）
   - 缓存机制（避免重复解析）

二、依赖图构建（Dependency Graph）

1. 核心数据结构

   class Module {
     constructor(id, filePath, source) {
       this.id = id;                    // 模块唯一标识
       this.filePath = filePath;        // 文件路径
       this.source = source;            // 原始代码
       this.dependencies = [];          // 依赖的模块 ID
       this.transformedSource = null;   // 转换后的代码
       this.ast = null;                 // AST
     }
   }

   class DependencyGraph {
     constructor() {
       this.modules = new Map();  // id → Module
       this.entryId = null;
     }

     addModule(module) {
       this.modules.set(module.id, module);
     }

     getModule(id) {
       return this.modules.get(id);
     }
   }

2. 构建算法（深度优先遍历）

   class GraphBuilder {
     constructor(resolver, transformer) {
       this.resolver = resolver;
       this.transformer = transformer;
       this.graph = new DependencyGraph();
       this.moduleId = 0;
     }

     build(entryPath) {
       // 从入口开始递归构建
       const entryId = this.createModule(entryPath, null);
       this.graph.entryId = entryId;
       return this.graph;
     }

     createModule(filePath, parentPath) {
       // 检查是否已处理
       const existingModule = this.findModuleByPath(filePath);
       if (existingModule) {
         return existingModule.id;
       }

       // 生成模块 ID
       const id = this.moduleId++;

       // 读取文件
       const source = fs.readFileSync(filePath, &#39;utf-8&#39;);

       // 创建模块
       const module = new Module(id, filePath, source);
       this.graph.addModule(module);

       // 解析 AST
       module.ast = this.parse(source);

       // 收集依赖
       const dependencies = this.collectDependencies(module.ast);

       // 递归处理依赖
       for (const dep of dependencies) {
         const depPath = this.resolver.resolve(
           path.dirname(filePath),
           dep
         );
         const depId = this.createModule(depPath, filePath);
         module.dependencies.push(depId);
       }

       // 转换代码
       module.transformedSource = this.transformer.transform(
         module.source,
         module.filePath
       );

       return id;
     }

     parse(source) {
       // 使用 Babel 或其他解析器生成 AST
       const ast = require(&#39;@babel/parser&#39;).parse(source, {
         sourceType: &#39;module&#39;,
         plugins: [&#39;jsx&#39;, &#39;typescript&#39;]
       });
       return ast;
     }

     collectDependencies(ast) {
       const dependencies = [];

       // 遍历 AST，收集 import/require
       require(&#39;@babel/traverse&#39;).default(ast, {
         ImportDeclaration(path) {
           // import xx from &#39;module&#39;
           dependencies.push(path.node.source.value);
         },
         CallExpression(path) {
           // require(&#39;module&#39;)
           if (path.node.callee.name === &#39;require&#39;) {
             const arg = path.node.arguments[0];
             if (arg.type === &#39;StringLiteral&#39;) {
               dependencies.push(arg.value);
             }
           }
         }
       });

       return dependencies;
     }

     findModuleByPath(filePath) {
       for (const module of this.graph.modules.values()) {
         if (module.filePath === filePath) {
           return module;
         }
       }
       return null;
     }
   }

3. 扩展点
   - 循环依赖检测
   - 动态 import 处理（代码分割）
   - 多入口支持
   - 依赖去重优化

三、产物生成（Code Generation）

1. 运行时模板

   const bundleTemplate = `
   (function(modules) {
     // 模块缓存
     const installedModules = {};

     // require 函数实现
     function __webpack_require__(moduleId) {
       // 检查缓存
       if (installedModules[moduleId]) {
         return installedModules[moduleId].exports;
       }

       // 创建新模块
       const module = installedModules[moduleId] = {
         id: moduleId,
         exports: {}
       };

       // 执行模块函数
       modules[moduleId].call(
         module.exports,
         module,
         module.exports,
         __webpack_require__
       );

       return module.exports;
     }

     // 加载入口模块
     return __webpack_require__(__ENTRY_ID__);
   })({
     __MODULES__
   });
   `;

2. 代码生成器

   class CodeGenerator {
     constructor(graph) {
       this.graph = graph;
     }

     generate() {
       // 生成模块映射
       const modulesCode = this.generateModules();

       // 替换模板占位符
       let bundle = bundleTemplate
         .replace(&#39;__ENTRY_ID__&#39;, this.graph.entryId)
         .replace(&#39;__MODULES__&#39;, modulesCode);

       return bundle;
     }

     generateModules() {
       const modules = [];

       for (const [id, module] of this.graph.modules) {
         // 转换依赖路径为模块 ID
         let code = module.transformedSource;

         for (const depId of module.dependencies) {
           const depModule = this.graph.getModule(depId);
           // 替换 import/require 路径为模块 ID
           code = code.replace(
             new RegExp(`[&#39;&quot;]${depModule.filePath}[&#39;&quot;]`, &#39;g&#39;),
             depId
           );
         }

         modules.push(`
           ${id}: function(module, exports, require) {
             ${code}
           }
         `);
       }

       return modules.join(&#39;,\n&#39;);
     }

     // 生成 Source Map
     generateSourceMap() {
       // 使用 source-map 库生成映射
       const map = new SourceMapGenerator();
       // ... 添加映射信息
       return map.toString();
     }
   }

3. 扩展点
   - 多种输出格式（UMD, ESM, CommonJS）
   - Source Map 生成
   - 代码分割（多个 chunk）
   - 压缩和优化

四、插件系统（Plugin System）

1. 生命周期钩子

   class Compiler {
     constructor(options) {
       this.options = options;
       this.hooks = {
         // 构建开始前
         beforeRun: new SyncHook(),
         // 构建开始
         run: new SyncHook(),
         // 编译开始
         compile: new SyncHook(),
         // 模块创建后
         afterModule: new SyncHook([&#39;module&#39;]),
         // 编译完成
         afterCompile: new SyncHook([&#39;compilation&#39;]),
         // 生成资源前
         emit: new AsyncSeriesHook([&#39;compilation&#39;]),
         // 生成资源后
         afterEmit: new AsyncSeriesHook([&#39;compilation&#39;]),
         // 完成
         done: new SyncHook([&#39;stats&#39;])
       };
     }

     run(callback) {
       this.hooks.beforeRun.call();
       this.hooks.run.call();

       // 编译流程
       this.compile((err, compilation) =&gt; {
         if (err) return callback(err);

         this.hooks.afterCompile.call(compilation);

         // 生成文件
         this.emitAssets(compilation, (err) =&gt; {
           if (err) return callback(err);

           this.hooks.done.call({ compilation });
           callback(null, compilation);
         });
       });
     }

     compile(callback) {
       this.hooks.compile.call();

       // 创建 compilation 对象
       const compilation = new Compilation(this);

       // 构建依赖图
       compilation.build();

       callback(null, compilation);
     }

     emitAssets(compilation, callback) {
       this.hooks.emit.callAsync(compilation, (err) =&gt; {
         if (err) return callback(err);

         // 写入文件
         for (const [filename, content] of compilation.assets) {
           fs.writeFileSync(
             path.join(this.options.output.path, filename),
             content
           );
         }

         this.hooks.afterEmit.callAsync(compilation, callback);
       });
     }
   }

2. 插件接口

   class MyPlugin {
     apply(compiler) {
       // 监听钩子
       compiler.hooks.emit.tapAsync(&#39;MyPlugin&#39;, (compilation, callback) =&gt; {
         // 修改产物
         compilation.assets.set(&#39;extra.txt&#39;, &#39;Generated by MyPlugin&#39;);
         callback();
       });

       compiler.hooks.afterModule.tap(&#39;MyPlugin&#39;, (module) =&gt; {
         // 处理模块
         console.log(&#39;Module created:&#39;, module.filePath);
       });
     }
   }

   // 使用
   const compiler = new Compiler({
     plugins: [new MyPlugin()]
   });

   // 注册插件
   for (const plugin of compiler.options.plugins) {
     plugin.apply(compiler);
   }

3. 扩展点
   - 异步钩子（AsyncSeriesHook, AsyncParallelHook）
   - 钩子拦截器（interceptors）
   - 插件间通信机制

五、Loader 系统

1. Loader 接口

   // babel-loader 示例
   function babelLoader(source) {
     // this 是 loader context
     const options = this.getOptions();

     // 转换代码
     const result = babel.transform(source, options);

     // 返回转换后的代码
     return result.code;
   }

   // 异步 loader
   function asyncLoader(source) {
     const callback = this.async();

     doAsyncWork(source, (err, result) =&gt; {
       if (err) return callback(err);
       callback(null, result);
     });
   }

   // Pitch Loader
   function pitchLoader(remainingRequest, precedingRequest, data) {
     // pitch 阶段执行
     // 可以中断 loader 链
     if (shouldSkip()) {
       return &#39;module.exports = &quot;skipped&quot;;&#39;;
     }
   }
   pitchLoader.pitch = function() { /* ... */ };

2. Loader 链式调用

   class LoaderRunner {
     runLoaders(loaders, resource, callback) {
       let loaderIndex = loaders.length - 1;
       let result = fs.readFileSync(resource, &#39;utf-8&#39;);

       // 从右到左执行
       while (loaderIndex &gt;= 0) {
         const loader = loaders[loaderIndex];
         const loaderContext = this.createContext(resource);

         result = loader.call(loaderContext, result);
         loaderIndex--;
       }

       callback(null, result);
     }

     createContext(resource) {
       return {
         resource,
         async: function() {
           // 返回异步回调
         },
         getOptions: function() {
           // 获取 loader 配置
         }
       };
     }
   }

六、完整示例

// mini-bundler.js
class MiniBundler {
  constructor(options) {
    this.options = options;
    this.compiler = new Compiler(options);
  }

  run() {
    // 1. 模块解析
    const resolver = new Resolver(this.options.resolve);

    // 2. 代码转换
    const transformer = new Transformer(this.options.module.rules);

    // 3. 构建依赖图
    const builder = new GraphBuilder(resolver, transformer);
    const graph = builder.build(this.options.entry);

    // 4. 生成代码
    const generator = new CodeGenerator(graph);
    const bundle = generator.generate();

    // 5. 输出文件
    fs.writeFileSync(
      this.options.output.filename,
      bundle
    );
  }
}

// 使用
const bundler = new MiniBundler({
  entry: &#39;./src/index.js&#39;,
  output: {
    path: &#39;./dist&#39;,
    filename: &#39;bundle.js&#39;
  },
  module: {
    rules: [
      { test: /\.js$/, use: &#39;babel-loader&#39; }
    ]
  },
  resolve: {
    extensions: [&#39;.js&#39;, &#39;.json&#39;],
    alias: {
      &#39;@&#39;: &#39;./src&#39;
    }
  },
  plugins: [
    new MyPlugin()
  ]
});

bundler.run();

七、关键扩展点总结

1. 模块解析扩展
   - 自定义解析器（custom resolvers）
   - 虚拟模块（virtual modules）
   - 外部依赖（externals）

2. 依赖图扩展
   - 循环依赖处理
   - 代码分割策略
   - Tree Shaking 集成

3. 代码生成扩展
   - 多种输出格式
   - Source Map 支持
   - 代码压缩和混淆

4. 插件系统扩展
   - 生命周期钩子
   - 编译优化
   - 资源处理

5. 性能优化扩展
   - 持久化缓存
   - 并行构建
   - 增量编译
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br></div></div><hr><h3 id="_2-vite-的开发-生产模式差异" tabindex="-1"><a class="header-anchor" href="#_2-vite-的开发-生产模式差异" aria-hidden="true">#</a> 2. Vite 的开发/生产模式差异</h3><p>Vite 为什么开发用 ESM、生产仍要 bundling？分别解决什么问题？这种设计有什么取舍？</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>一、开发模式（Dev）：为什么用 ESM

1. 核心原理

   浏览器直接加载 ES Module：

   &lt;!-- index.html --&gt;
   &lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;&gt;&lt;/script&gt;

   浏览器发起请求：
   GET /src/main.js
     ↓
   Vite Dev Server 拦截
     ↓
   实时编译（esbuild/SWC）
     ↓
   返回转换后的 ESM
     ↓
   浏览器解析 import，继续请求依赖
     ↓
   按需加载，逐步构建

2. 解决的问题

   问题1：启动速度慢
   传统打包器（Webpack）：
     启动 → 分析所有模块 → 打包 → 启动完成（30s+）

   Vite：
     启动 → 预构建依赖（node_modules）→ 启动完成（200ms）
     访问页面时才编译，按需加载

   问题2：HMR 更新慢
   Webpack：
     修改文件 → 重新打包相关模块 → 更新（1-5s）

   Vite：
     修改文件 → 只编译这个文件 → 精准 HMR（&lt;100ms）

   问题3：开发体验差
   每次改动都要等待，打断开发思路
   Vite 即时反馈，提升开发效率

3. 开发模式的优势

   ✅ 极快的冷启动
      无需打包，服务器秒起

   ✅ 即时的热更新
      只重新编译修改的文件

   ✅ 真正的按需编译
      未访问的路由/组件不编译

   ✅ 利用浏览器缓存
      HTTP 304 强缓存

   ✅ 并行加载
      充分利用 HTTP/2 多路复用

二、生产模式（Build）：为什么要 bundling

1. 核心原理

   Vite 生产构建使用 Rollup：

   vite build
     ↓
   Rollup 打包所有模块
     ↓
   Tree Shaking
     ↓
   代码分割
     ↓
   压缩优化
     ↓
   生成 bundle 文件

2. 为什么不直接用 ESM？

   问题1：性能问题（最关键）

   假设应用有 1000 个模块：

   【直接用 ESM】
   浏览器加载：
     index.html
       ↓
     main.js (import 10 个模块)
       ↓
     10 个模块 (每个 import 5 个)
       ↓
     50 个模块...

   结果：
   - 1000+ 个 HTTP 请求
   - 瀑布式加载（串行）
   - 即使 HTTP/2，也会有延迟
   - 移动网络更慢

   【打包后】
   浏览器加载：
     index.html
       ↓
     main.js (bundle，所有代码在内)
       ↓
     async-chunk.js (代码分割的异步包)

   结果：
   - 2-3 个 HTTP 请求
   - 并行加载
   - 更快的首屏时间

   问题2：兼容性问题

   现代浏览器 ESM 支持：
   ✅ Chrome 61+
   ✅ Firefox 60+
   ✅ Safari 11+
   ❌ IE 11 (不支持)

   生产环境需要考虑：
   - 老旧浏览器用户
   - 企业内网（可能强制 IE）
   - 兼容性降级方案

   打包后可以：
   - 转译为 ES5
   - 使用 Polyfill
   - 提供降级方案

   问题3：代码体积问题

   【ESM 重复代码】
   // moduleA.js
   import { debounce } from &#39;lodash-es&#39;;
   export default debounce;

   // moduleB.js
   import { debounce } from &#39;lodash-es&#39;;
   export default debounce;

   浏览器加载：
   - lodash-es/debounce.js 被加载 1 次 ✅
   - 但依赖的内部模块可能重复解析

   【打包后去重】
   Rollup 分析依赖图：
   - debounce 只打包一次
   - 完全去重，体积更小

   问题4：Tree Shaking 不彻底

   ESM 原生不支持 Tree Shaking：

   // utils.js
   export const used = () =&gt; {};
   export const unused = () =&gt; {};  // 未使用

   // main.js
   import { used } from &#39;./utils.js&#39;;

   浏览器：
   - 仍然加载整个 utils.js
   - unused 函数仍在文件中

   Rollup 打包：
   - 静态分析 unused 未使用
   - 直接删除，减小体积

   问题5：网络往返延迟（RTT）

   每个 HTTP 请求都有延迟：
   - DNS 查询
   - TCP 连接
   - TLS 握手
   - 服务器处理

   1000 个模块 = 1000 次网络往返
   即使每次 10ms，总计 10s

   打包后 3 个文件 = 3 次往返 = 30ms

   问题6：缓存策略复杂

   ESM：
   - 每个文件单独缓存
   - 一个模块更新，只失效一个缓存 ✅
   - 但首次加载 1000 个文件都要检查缓存

   Bundle：
   - 使用 contenthash
   - main.[hash].js 缓存一年
   - 代码变化 → hash 变化 → 自动更新
   - 更简单可靠

3. 生产模式的优势

   ✅ 更少的 HTTP 请求
      减少网络开销

   ✅ 更好的 Tree Shaking
      移除未使用代码，体积更小

   ✅ 代码压缩和混淆
      减小体积，保护代码

   ✅ 代码分割优化
      按路由/按需加载

   ✅ 长期缓存策略
      contenthash 精准缓存

   ✅ 兼容性处理
      支持老旧浏览器

   ✅ 性能优化
      Scope Hoisting、常量折叠等

三、双模式设计的取舍

1. 开发模式的优势与劣势

   优势：
   ✅ 极快的启动速度（200ms vs 30s）
   ✅ 极快的 HMR（&lt;100ms vs 1-5s）
   ✅ 按需编译，节省资源
   ✅ 真实的模块边界，调试方便

   劣势：
   ❌ 首次访问路由时有编译延迟（可预构建缓解）
   ❌ 需要现代浏览器支持 ESM
   ❌ 开发和生产不一致（可能有坑）
   ❌ 大量 HTTP 请求（开发环境可接受）

2. 生产模式的优势与劣势

   优势：
   ✅ 最优的加载性能
   ✅ 最小的体积
   ✅ 最好的兼容性
   ✅ 成熟的优化策略

   劣势：
   ❌ 构建时间较长（但比 Webpack 快）
   ❌ 需要构建步骤
   ❌ 调试相对困难（需要 Source Map）

3. 开发/生产不一致的潜在问题

   问题1：模块解析差异

   开发环境：
   import Component from &#39;./Component&#39;;
   // Vite 自动补全 .vue 扩展名

   生产环境（Rollup）：
   import Component from &#39;./Component&#39;;
   // 可能找不到模块（如果配置不一致）

   解决：
   // vite.config.js
   export default {
     resolve: {
       extensions: [&#39;.js&#39;, &#39;.ts&#39;, &#39;.vue&#39;]  // 统一配置
     }
   }

   问题2：环境变量处理

   开发环境：
   console.log(import.meta.env.VITE_API_URL);
   // Vite 运行时注入

   生产环境：
   console.log(import.meta.env.VITE_API_URL);
   // Rollup 构建时替换为字符串

   注意：
   - 不能使用动态的 env 访问
   - 必须完整写出变量名

   问题3：CSS 处理差异

   开发环境：
   import &#39;./style.css&#39;;
   // 通过 &lt;style&gt; 标签注入

   生产环境：
   import &#39;./style.css&#39;;
   // 提取为单独的 .css 文件

   影响：
   - 样式应用时机可能不同
   - 需要测试生产构建

   问题4：代码分割行为

   开发环境：
   const Home = () =&gt; import(&#39;./Home.vue&#39;);
   // 每次访问都是独立的请求

   生产环境：
   const Home = () =&gt; import(&#39;./Home.vue&#39;);
   // 打包成 chunk，可能包含其他模块

   建议：
   - 定期构建生产版本测试
   - 使用 vite preview 预览生产构建

4. 最佳实践

   开发模式优化：
   ✅ 配置依赖预构建
      optimizeDeps: {
        include: [&#39;vue&#39;, &#39;lodash-es&#39;]
      }

   ✅ 减少不必要的转换
      只转换需要的文件

   ✅ 使用缓存
      利用 HTTP 缓存和文件系统缓存

   生产模式优化：
   ✅ 代码分割
      build: {
        rollupOptions: {
          output: {
            manualChunks: {
              vendor: [&#39;vue&#39;, &#39;vue-router&#39;]
            }
          }
        }
      }

   ✅ 压缩配置
      build: {
        minify: &#39;terser&#39;,
        terserOptions: {
          compress: {
            drop_console: true
          }
        }
      }

   ✅ 启用 gzip/brotli
      viteCompression()

四、对比总结

| 维度 | 开发模式（ESM） | 生产模式（Bundle） |
|------|----------------|-------------------|
| 启动速度 | ⚡ 极快（200ms） | N/A（需要构建） |
| 热更新 | ⚡ 极快（&lt;100ms） | N/A |
| 首次加载 | 🐌 多请求 | ⚡ 少请求 |
| 文件体积 | ➖ 未优化 | ✅ 最小化 |
| Tree Shaking | ❌ 不支持 | ✅ 完全支持 |
| 兼容性 | ⚠️ 仅现代浏览器 | ✅ 可兼容老浏览器 |
| 调试 | ✅ 真实模块 | ⚠️ 需要 Source Map |
| 缓存策略 | 📦 HTTP 缓存 | 📦 contenthash 缓存 |
| 代码分割 | ✅ 天然支持 | ✅ 手动配置 |

五、Vite 的设计哲学

1. 开发体验优先
   - 快速启动，即时反馈
   - 让开发者保持心流状态
   - 不为构建速度牺牲开发体验

2. 生产性能优先
   - 最优的加载性能
   - 最小的包体积
   - 不为开发速度牺牲生产性能

3. 充分利用现代工具
   - esbuild: Go 编写，极速编译
   - Rollup: 成熟的打包器，最佳 Tree Shaking
   - 浏览器原生 ESM: 减少构建负担

4. 渐进式增强
   - 基础功能开箱即用
   - 高级功能按需配置
   - 插件生态丰富

六、何时选择不同的构建工具

选择 Vite：
✅ 新项目
✅ Vue/React/Svelte 应用
✅ 追求极致的开发体验
✅ 团队成员使用现代浏览器

选择 Webpack：
✅ 遗留项目（迁移成本高）
✅ 需要极致的灵活性
✅ 复杂的构建需求
✅ 必须支持 IE11

选择 Rollup：
✅ 打包库（而非应用）
✅ 需要多种输出格式
✅ 追求最小体积

【总结】
Vite 的双模式设计是对开发体验和生产性能的平衡：
- 开发时利用现代浏览器能力，追求速度
- 生产时使用成熟打包器，追求性能
- 两者结合，提供最佳的全流程体验
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br></div></div><hr><h3 id="_3-webpack-性能优化" tabindex="-1"><a class="header-anchor" href="#_3-webpack-性能优化" aria-hidden="true">#</a> 3. Webpack 性能优化</h3><p>Webpack 性能瓶颈通常在哪几个环节？你会如何定位（指标/工具/策略）？给出你的优化清单。</p><p><strong>【作答】：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>一、性能瓶颈环节

1. 构建速度瓶颈

   【入口解析阶段】
   - 递归解析所有模块的依赖
   - 大型项目可能有 5000+ 模块
   - 每个模块都要读取、解析

   【Loader 转换阶段】
   - babel-loader 转换 ES6+ → ES5（最慢）
   - ts-loader 编译 TypeScript
   - sass-loader 编译 SCSS
   - 每个文件都要经过 loader 链

   【Plugin 处理阶段】
   - 压缩插件（TerserPlugin）
   - 提取 CSS（MiniCssExtractPlugin）
   - 生成 HTML（HtmlWebpackPlugin）

   【文件输出阶段】
   - 写入大量文件到磁盘
   - 生成 Source Map

2. 打包体积瓶颈

   - 未 Tree Shaking 的第三方库
   - 重复打包的公共模块
   - 未压缩的图片资源
   - 未分离的大块代码
   - Source Map 过大

3. 运行时性能瓶颈

   - 首屏加载资源过多
   - 未做代码分割
   - 缓存策略不当

二、性能定位方法

1. 速度分析工具

   【speed-measure-webpack-plugin】
   测量每个 loader 和 plugin 的耗时

   // webpack.config.js
   const SpeedMeasurePlugin = require(&#39;speed-measure-webpack-plugin&#39;);
   const smp = new SpeedMeasurePlugin();

   module.exports = smp.wrap({
     // 你的 webpack 配置
   });

   输出示例：
   SMP ⏱
   General output time took 18.5 secs

   Plugins:
     TerserPlugin took 8.2 secs
     MiniCssExtractPlugin took 3.1 secs
     HtmlWebpackPlugin took 0.5 secs

   Loaders:
     babel-loader took 12.3 secs
       /src/index.js (2.1 secs)
       /src/App.js (1.8 secs)
     css-loader took 2.5 secs
     sass-loader took 3.2 secs

   分析：
   - babel-loader 最慢 → 优化编译
   - TerserPlugin 慢 → 考虑并行压缩

2. 体积分析工具

   【webpack-bundle-analyzer】
   可视化分析打包产物

   const BundleAnalyzerPlugin = require(&#39;webpack-bundle-analyzer&#39;).BundleAnalyzerPlugin;

   module.exports = {
     plugins: [
       new BundleAnalyzerPlugin({
         analyzerMode: &#39;static&#39;,  // 生成 HTML 文件
         openAnalyzer: true
       })
     ]
   };

   npm run build
   → 自动打开分析页面

   可以看到：
   - 每个模块的体积
   - 重复打包的模块（红色）
   - 最大的依赖库
   - 可优化的空间

3. 构建日志分析

   【stats.json】
   生成详细的构建统计

   webpack --profile --json &gt; stats.json

   上传到：
   - webpack.github.io/analyse/
   - statoscope.tech

   可以分析：
   - 模块依赖关系
   - chunk 组成
   - 为什么某个模块被打包

4. 关键指标

   【构建速度指标】
   - 冷启动时间（首次构建）
   - 热启动时间（有缓存）
   - HMR 更新时间
   - 生产构建时间

   目标：
   - 开发环境冷启动 &lt; 30s
   - HMR 更新 &lt; 1s
   - 生产构建（中型项目）&lt; 3 分钟

   【体积指标】
   - 总体积
   - 首屏资源体积
   - gzip 后体积

   目标：
   - 主 bundle &lt; 200KB (gzip)
   - 首屏加载 &lt; 500KB (gzip)
   - 总体积控制在合理范围

三、优化清单

【类别 A：构建速度优化】

1. 减少 Loader 处理范围

   ❌ 优化前：
   module: {
     rules: [
       {
         test: /\.js$/,
         use: &#39;babel-loader&#39;  // 处理所有 JS 文件
       }
     ]
   }

   ✅ 优化后：
   module: {
     rules: [
       {
         test: /\.js$/,
         exclude: /node_modules/,  // 排除 node_modules
         include: path.resolve(__dirname, &#39;src&#39;),  // 只处理 src
         use: &#39;babel-loader&#39;
       }
     ]
   }

   效果：
   - 减少 50%+ 的文件处理量
   - 构建时间减少 30-40%

2. 开启 Loader 缓存

   ✅ babel-loader 缓存：
   {
     test: /\.js$/,
     use: {
       loader: &#39;babel-loader&#39;,
       options: {
         cacheDirectory: true,  // 开启缓存
         cacheCompression: false  // 不压缩缓存（更快）
       }
     }
   }

   缓存位置：node_modules/.cache/babel-loader

   效果：
   - 第二次构建快 70%+
   - HMR 更新快 80%+

3. 使用 esbuild/swc 替代 Babel

   【esbuild-loader】
   Go 语言编写，速度快 10-100 倍

   module: {
     rules: [
       {
         test: /\.js$/,
         loader: &#39;esbuild-loader&#39;,
         options: {
           target: &#39;es2015&#39;
         }
       }
     ]
   }

   【swc-loader】
   Rust 语言编写，速度快 20 倍

   {
     test: /\.js$/,
     use: {
       loader: &#39;swc-loader&#39;,
       options: {
         jsc: {
           parser: {
             syntax: &#39;ecmascript&#39;,
             jsx: true
           }
         }
       }
     }
   }

   权衡：
   - esbuild/swc 功能不如 Babel 完善
   - 部分插件不支持
   - 适合大部分场景

4. 多进程/多线程构建

   【thread-loader】
   开启多进程处理 loader

   module: {
     rules: [
       {
         test: /\.js$/,
         use: [
           &#39;thread-loader&#39;,  // 放在耗时 loader 之前
           &#39;babel-loader&#39;
         ]
       }
     ]
   }

   【terser-webpack-plugin 并行压缩】
   optimization: {
     minimize: true,
     minimizer: [
       new TerserPlugin({
         parallel: true  // 使用多进程并行压缩
       })
     ]
   }

   注意：
   - 小项目反而变慢（进程开销）
   - 建议模块数 &gt; 1000 再使用

5. 持久化缓存（Webpack 5）

   cache: {
     type: &#39;filesystem&#39;,  // 文件系统缓存
     buildDependencies: {
       config: [__filename]  // 配置文件变化时失效
     }
   }

   缓存位置：node_modules/.cache/webpack

   效果：
   - 第二次构建快 90%+
   - 改一个文件，其他模块使用缓存

6. 优化模块解析

   resolve: {
     // 指定查找目录，减少搜索范围
     modules: [path.resolve(__dirname, &#39;src&#39;), &#39;node_modules&#39;],

     // 减少扩展名尝试
     extensions: [&#39;.js&#39;, &#39;.jsx&#39;],  // 不要太多

     // 别名，减少查找层级
     alias: {
       &#39;@&#39;: path.resolve(__dirname, &#39;src&#39;),
       &#39;react&#39;: path.resolve(__dirname, &#39;node_modules/react&#39;)
     },

     // 使用 package.json 的 main 字段
     mainFields: [&#39;main&#39;],

     // 不解析 symlinks
     symlinks: false
   }

7. 减少 Plugin 使用

   ❌ 开发环境不必要的插件：
   - TerserPlugin（压缩）
   - CompressionPlugin（gzip）
   - BundleAnalyzerPlugin（分析）

   ✅ 按环境区分：
   const plugins = [
     new HtmlWebpackPlugin()
   ];

   if (process__.env.NODE_ENV === &#39;production&#39;) {
     plugins.push(
       new TerserPlugin(),
       new CompressionPlugin()
     );
   }

8. 使用 DllPlugin 预编译依赖

   第三方库（React/Vue/Lodash）很少变化
   可以预先打包，开发时直接引用

   // webpack.dll.config.js
   module.exports = {
     entry: {
       vendor: [&#39;react&#39;, &#39;react-dom&#39;, &#39;lodash&#39;]
     },
     output: {
       filename: &#39;[name].dll.js&#39;,
       library: &#39;[name]_library&#39;
     },
     plugins: [
       new webpack.DllPlugin({
         name: &#39;[name]_library&#39;,
         path: path.join(__dirname, &#39;dll&#39;, &#39;[name]-manifest.json&#39;)
       })
     ]
   };

   // 主配置引用
   plugins: [
     new webpack.DllReferencePlugin({
       manifest: require(&#39;./dll/vendor-manifest.json&#39;)
     })
   ]

   效果：
   - 减少重复编译
   - 构建快 40%+

   缺点：
   - 维护成本高
   - Webpack 5 的持久化缓存已能替代

9. 开发环境优化

   devtool: &#39;eval-cheap-module-source-map&#39;,  // 快速生成 Source Map

   optimization: {
     removeAvailableModules: false,  // 不移除已可用模块
     removeEmptyChunks: false,       // 不移除空 chunk
     splitChunks: false,              // 不做代码分割
     minimize: false,                 // 不压缩
     usedExports: false               // 不标记未使用导出
   }

   效果：
   - 跳过不必要的优化
   - 开发构建快 50%+

【类别 B：打包体积优化】

10. Tree Shaking

    optimization: {
      usedExports: true,  // 标记未使用的导出
      minimize: true,      // 压缩时移除
      sideEffects: false   // 允许删除无副作用的未使用模块
    }

    package.json:
    {
      &quot;sideEffects&quot;: false  // 或 [&quot;*.css&quot;]
    }

    注意：
    - 只对 ES6 模块有效
    - CommonJS 无法 Tree Shake

11. 代码分割

    【按路由分割】
    const Home = React.lazy(() =&gt; import(&#39;./Home&#39;));
    const About = React.lazy(() =&gt; import(&#39;./About&#39;));

    【提取公共代码】
    optimization: {
      splitChunks: {
        chunks: &#39;all&#39;,
        cacheGroups: {
          vendor: {
            test: /[\\/]node_modules[\\/]/,
            name: &#39;vendors&#39;,
            priority: 10
          },
          common: {
            minChunks: 2,
            name: &#39;common&#39;,
            priority: 5
          }
        }
      },
      runtimeChunk: &#39;single&#39;  // 提取 runtime
    }

    效果：
    - 首屏加载减少 60%+
    - 长期缓存，vendors 不变

12. 压缩优化

    【JS 压缩】
    new TerserPlugin({
      parallel: true,
      terserOptions: {
        compress: {
          drop_console: true,  // 删除 console
          drop_debugger: true,
          pure_funcs: [&#39;console.log&#39;]  // 删除特定函数
        }
      }
    })

    【CSS 压缩】
    new CssMinimizerPlugin()

    【HTML 压缩】
    new HtmlWebpackPlugin({
      minify: {
        collapseWhitespace: true,
        removeComments: true
      }
    })

13. 图片优化

    【image-webpack-loader】
    {
      test: /\.(png|jpg|gif)$/,
      use: [
        &#39;file-loader&#39;,
        {
          loader: &#39;image-webpack-loader&#39;,
          options: {
            mozjpeg: { quality: 75 },
            pngquant: { quality: [0.65, 0.90] }
          }
        }
      ]
    }

    【转 base64】
    {
      test: /\.(png|jpg)$/,
      type: &#39;asset&#39;,
      parser: {
        dataUrlCondition: {
          maxSize: 8 * 1024  // 8KB 以下转 base64
        }
      }
    }

    【WebP 格式】
    使用 image-minimizer-webpack-plugin

14. 按需加载第三方库

    ❌ 整体导入：
    import _ from &#39;lodash&#39;;  // 整个 lodash (~70KB)
    _.debounce(fn, 300);

    ✅ 按需导入：
    import debounce from &#39;lodash/debounce&#39;;  // 只导入需要的

    或使用插件：
    babel-plugin-import
    babel-plugin-lodash

15. 移除重复依赖

    【查找重复】
    npm ls lodash

    可能看到：
    ├─┬ package-a@1.0.0
    │ └── lodash@4.17.19
    └─┬ package-b@2.0.0
      └── lodash@4.17.20

    【解决方案1：resolutions（yarn）】
    package.json:
    {
      &quot;resolutions&quot;: {
        &quot;lodash&quot;: &quot;4.17.21&quot;  // 强制使用同一版本
      }
    }

    【解决方案2：alias】
    resolve: {
      alias: {
        lodash: path.resolve(__dirname, &#39;node_modules/lodash&#39;)
      }
    }

16. Externals（CDN）

    externals: {
      react: &#39;React&#39;,
      &#39;react-dom&#39;: &#39;ReactDOM&#39;
    }

    ```html
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js&quot;&gt;&lt;/script&gt;
    ```

    效果：
    - 减少打包体积
    - 利用 CDN 缓存

    缺点：
    - 依赖外部资源
    - 可能有加载失败风险

17. 开启 Gzip/Brotli

    const CompressionPlugin = require(&#39;compression-webpack-plugin&#39;);

    plugins: [
      new CompressionPlugin({
        algorithm: &#39;gzip&#39;,
        test: /\.(js|css|html)$/,
        threshold: 10240,  // 10KB 以上才压缩
        minRatio: 0.8
      })
    ]

    效果：
    - JS 体积减少 70%+
    - CSS 体积减少 80%+

【类别 C：运行时优化】

18. 优化 Source Map

    开发环境：
    devtool: &#39;eval-cheap-module-source-map&#39;  // 快速，但调试友好

    生产环境：
    devtool: &#39;hidden-source-map&#39;  // 不暴露源码，但可上传到错误监控平台

    或不生成（最快）：
    devtool: false

19. 模块联邦（Webpack 5）

    多个应用共享依赖：

    new ModuleFederationPlugin({
      name: &#39;app1&#39;,
      remotes: {
        app2: &#39;app2@http://localhost:3002/remoteEntry.js&#39;
      },
      shared: [&#39;react&#39;, &#39;react-dom&#39;]
    })

    效果：
    - 微前端架构
    - 共享依赖，减少重复加载

20. Prefetch/Preload

    import(/* webpackPrefetch: true */ &#39;./utils&#39;)

    生成：
    &lt;link rel=&quot;prefetch&quot; href=&quot;utils.chunk.js&quot;&gt;

    浏览器空闲时预加载

四、优化策略总结

优先级排序：

【立即见效（投入少，收益高）】
1. ✅ 开启 Loader 缓存
2. ✅ 排除 node_modules
3. ✅ 开启持久化缓存（Webpack 5）
4. ✅ 代码分割 + Tree Shaking
5. ✅ 压缩配置

【中期优化（需要调研）】
6. ⚡ 替换为 esbuild/swc
7. ⚡ 按需加载第三方库
8. ⚡ 图片优化
9. ⚡ 多进程构建

【长期规划（架构调整）】
10. 🎯 迁移到 Vite（新项目）
11. 🎯 模块联邦（微前端）
12. 🎯 Monorepo + 依赖共享

优化检查清单：

□ 速度分析：使用 speed-measure-webpack-plugin
□ 体积分析：使用 webpack-bundle-analyzer
□ Loader 缓存：babel-loader cacheDirectory
□ 持久化缓存：cache.type = &#39;filesystem&#39;
□ 排除不必要文件：exclude node_modules
□ 代码分割：splitChunks 配置
□ Tree Shaking：usedExports + sideEffects
□ 压缩：TerserPlugin + CssMinimizerPlugin
□ 图片优化：image-webpack-loader
□ Source Map：按环境选择合适的 devtool
□ 按需加载：React.lazy + import()
□ 移除重复依赖：npm ls 检查
□ CDN：externals 配置
□ Gzip：compression-webpack-plugin
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br><span class="line-number">622</span><br><span class="line-number">623</span><br><span class="line-number">624</span><br><span class="line-number">625</span><br></div></div><hr><h3 id="_4-webpack-迁移到-vite" tabindex="-1"><a class="header-anchor" href="#_4-webpack-迁移到-vite" aria-hidden="true">#</a> 4. Webpack 迁移到 Vite</h3><p>一个大型项目从 Webpack 迁移到 Vite，你会如何评估风险、兼容性问题、分阶段落地方案？</p><p><strong>【作答】：</strong></p><p>一、前期评估</p><ol><li><p>项目现状调研</p><p>【技术栈评估】 ✅ 适合迁移：</p><ul><li>Vue 3 / React / Svelte 等现代框架</li><li>使用 ES6+ 模块</li><li>依赖库支持 ESM</li><li>团队使用现代浏览器开发</li></ul><p>⚠️ 需要评估：</p><ul><li>Vue 2（需要 @vitejs/plugin-vue2）</li><li>混用 CommonJS 和 ESM</li><li>部分依赖只有 UMD 格式</li><li>大量自定义 Webpack 配置</li></ul><p>❌ 不建议迁移：</p><ul><li>必须支持 IE11（除非用 @vitejs/plugin-legacy）</li><li>深度定制 Webpack 配置无法替代</li><li>团队不愿意学习新工具</li><li>项目即将下线</li></ul><p>【依赖检查】 检查 package.json 中的依赖：</p><p>npm ls --depth=0 &gt; dependencies.txt</p><p>重点检查：</p><ul><li>是否有 ESM 版本</li><li>是否支持 Vite</li><li>是否需要特殊处理</li></ul><p>工具：</p><ul><li>es-check: 检查代码是否为 ESM</li><li>publint: 检查包的导出是否正确</li></ul><p>【Webpack 配置分析】 记录当前 Webpack 配置：</p><ul><li><p>Loader 使用情况 □ babel-loader → Vite 内置 esbuild □ vue-loader → @vitejs/plugin-vue □ style-loader → Vite 内置 □ file-loader → Vite asset 处理 □ 自定义 loader → 需要评估</p></li><li><p>Plugin 使用情况 □ HtmlWebpackPlugin → Vite 内置 □ DefinePlugin → Vite define 配置 □ CopyWebpackPlugin → vite-plugin-static-copy □ 自定义 plugin → 需要迁移或找替代</p></li><li><p>特殊功能 □ 代码分割 → Vite 支持 □ 别名配置 → Vite 支持 □ 环境变量 → Vite 支持 □ Proxy → Vite 支持</p></li></ul></li><li><p>风险评估矩阵</p><table><thead><tr><th>风险项</th><th>严重程度</th><th>发生概率</th><th>应对措施</th></tr></thead><tbody><tr><td>依赖不兼容</td><td>高</td><td>中</td><td>预先测试，准备降级方案</td></tr><tr><td>功能缺失</td><td>高</td><td>低</td><td>找替代插件或自己实现</td></tr><tr><td>构建产物差异</td><td>中</td><td>高</td><td>充分测试，对比产物</td></tr><tr><td>团队学习成本</td><td>低</td><td>高</td><td>培训 + 文档</td></tr><tr><td>性能回退</td><td>高</td><td>低</td><td>性能测试</td></tr><tr><td>开发体验下降</td><td>中</td><td>低</td><td>试运行，收集反馈</td></tr></tbody></table></li><li><p>收益评估</p><p>【预期收益】 开发速度：</p><ul><li>冷启动：30s → 2s（快 15 倍）</li><li>热更新：2s → 100ms（快 20 倍）</li></ul><p>开发体验：</p><ul><li>即时反馈，提升开发效率</li><li>更少的配置，降低维护成本</li></ul><p>【量化指标】</p><ul><li>开发效率提升：30%（每天节省 2 小时等待时间）</li><li>构建配置减少：50%（更简洁）</li><li>学习成本：2-3 天（阅读文档 + 实践）</li></ul></li></ol><p>二、兼容性问题排查</p><ol><li><p>模块系统兼容性</p><p>【问题 1：CommonJS 模块】</p></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // 老代码
   const utils = require_(&#39;./utils&#39;);
   module.exports = { ... };
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>影响：</p><ul><li>Vite 优先支持 ESM</li><li>CommonJS 需要额外处理</li></ul><p>解决方案： 方案 1：渐进式改造</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // 逐步改为 ESM
   import utils from &#39;./utils&#39;;
   export default { ... };
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>方案 2：兼容配置</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // vite.config.js
   optimizeDeps: {
     include: [&#39;legacy-package&#39;]  // 预构建 CJS 依赖
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>方案 3：使用插件</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // @originjs/vite-plugin-commonjs
   import { viteCommonjs } from &#39;@originjs/vite-plugin-commonjs&#39;;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>【问题 2：动态 require】</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // Webpack 支持
   const componentName = &#39;Button&#39;;
   const Component = require(`./components/${componentName}`);
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>// Vite 不支持 ❌ import(/) 不能使用变量路径</p><p>解决方案：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // 改为静态导入 + 对象映射
   const components = {
     Button: () =&gt; import(&#39;./components/Button&#39;),
     Input: () =&gt; import(&#39;./components/Input&#39;)
   };
   const Component = await components[componentName]();
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li><p>环境变量兼容性</p><p>【问题：变量命名差异】 Webpack:</p></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   process__.env.NODE_ENV
   process__.env.REACT_APP_API_URL
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Vite:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   import.meta.env.MODE  // development / production
   import.meta.env.VITE_API_URL  // 必须 VITE_ 前缀
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>解决方案： 方案 1：全局替换</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // 代码中统一替换
   - process__.env.NODE_ENV
   + import.meta.env.MODE

   - process__.env.REACT_APP_API_URL
   + import.meta.env.VITE_API_URL
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>方案 2：兼容层</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // vite.config.js
   define: {
     &#39;process__.env.NODE_ENV&#39;: JSON.stringify(process__.env.NODE_ENV),
     &#39;process__.env.REACT_APP_API_URL&#39;: JSON.stringify(process__.env.VITE_API_URL)
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li><p>别名和路径解析</p><p>Webpack:</p></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   resolve: {
     alias: {
       &#39;@&#39;: path.resolve(__dirname, &#39;src&#39;),
       &#39;components&#39;: path.resolve(__dirname, &#39;src/components&#39;)
     }
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Vite:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   resolve: {
     alias: {
       &#39;@&#39;: &#39;/src&#39;,  // 可以用相对路径
       &#39;components&#39;: &#39;/src/components&#39;
     }
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意：</p><ul><li>Vite 的路径是相对于项目根目录</li><li>需要调整 import 语句</li></ul><ol start="4"><li>静态资源处理</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   【图片导入】
   Webpack:
   import logo from &#39;./logo.png&#39;;  // 返回路径字符串
   &lt;img src={logo} /&gt;

   Vite:
   import logo from &#39;./logo.png&#39;;  // 同样返回路径
   &lt;img src={logo} /&gt;  // ✅ 兼容

   【显式 URL 导入】
   Vite 特有：
   import logo from &#39;./logo.png?url&#39;;  // 强制作为 URL
   import logoRaw from &#39;./logo.png?raw&#39;;  // 作为字符串

   【public 目录】
   Webpack:
   - public/favicon.ico → /favicon.ico

   Vite:
   - public/favicon.ico → /favicon.ico  // ✅ 兼容
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol start="5"><li>CSS 处理差异</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   【CSS Modules】
   Webpack:
   import styles from &#39;./App.module.css&#39;;

   Vite:
   import styles from &#39;./App.module.css&#39;;  // ✅ 兼容

   【SCSS/Less】
   Webpack: 需要 sass-loader
   Vite: 内置支持，只需安装 sass

   npm install -D sass

   【PostCSS】
   // postcss.config.js（两者通用）
   module.exports = {
     plugins: {
       autoprefixer: {}
     }
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol start="6"><li><p>第三方库兼容性</p><p>【需要预构建的库】 某些库导出不规范，需要预构建：</p></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   optimizeDeps: {
     include: [
       &#39;lodash-es&#39;,  // 太多小文件
       &#39;ant-design-vue&#39;,  // 导出复杂
       &#39;legacy-lib&#39;  // CommonJS 库
     ],
     exclude: [
       &#39;your-local-package&#39;  // 本地开发的包
     ]
   }

   【需要特殊处理的库】
   // jQuery 等全局变量库
   export default {
     define: {
       $: &#39;window.jQuery&#39;,
       jQuery: &#39;window.jQuery&#39;
     }
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>三、分阶段迁移方案</p><p>阶段 1：准备阶段（1-2 周）</p><p>任务清单： □ 升级依赖到最新稳定版 □ 将 CommonJS 改为 ESM □ 清理不用的依赖 □ 整理 Webpack 配置清单 □ 准备迁移文档</p><p>具体步骤：</p><ol><li><p>创建迁移分支 git checkout -b feat/migrate-to-vite</p></li><li><p>安装 Vite npm install -D vite @vitejs/plugin-vue</p><p>或 React: npm install -D vite @vitejs/plugin-react</p></li><li><p>创建基础配置</p></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   // vite.config.js
   import { defineConfig } from &#39;vite&#39;;
   import vue from &#39;@vitejs/plugin-vue&#39;;

   export default defineConfig({
     plugins: [vue()],
     resolve: {
       alias: {
         &#39;@&#39;: &#39;/src&#39;
       }
     },
     server: {
       port: 3000,
       proxy: {
         &#39;/api&#39;: {
           target: &#39;http://localhost:8080&#39;,
           changeOrigin: true
         }
       }
     }
   });
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="4"><li>修改入口文件</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html 移到项目根目录 --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/src/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>阶段 2：试运行阶段（1 周）</p><ol><li><p>本地开发测试 npm run dev # Vite 开发服务器</p><p>测试项： □ 页面能否正常访问 □ 路由跳转是否正常 □ API 请求是否正常 □ 热更新是否工作 □ 样式是否正确 □ 图片等资源是否加载</p></li><li><p>解决兼容性问题 记录遇到的问题：</p><p>问题日志模板：</p><table><thead><tr><th>问题</th><th>原因</th><th>解决方案</th><th>状态</th></tr></thead><tbody><tr><td>xxx 依赖报错</td><td>CommonJS</td><td>optimizeDeps</td><td>✅</td></tr><tr><td>环境变量 undefined</td><td>命名不同</td><td>改为 VITE_</td><td>✅</td></tr></tbody></table></li><li><p>性能对比测试 记录指标：</p><table><thead><tr><th>指标</th><th>Webpack</th><th>Vite</th><th>提升</th></tr></thead><tbody><tr><td>冷启动</td><td>28s</td><td>2.1s</td><td>13x</td></tr><tr><td>热更新</td><td>1.8s</td><td>95ms</td><td>19x</td></tr><tr><td>生产构建</td><td>180s</td><td>45s</td><td>4x</td></tr></tbody></table></li></ol><p>阶段 3：灰度发布阶段（2 周）</p><ol><li><p>部分开发者试用</p><ul><li>选择 2-3 名开发者先使用 Vite</li><li>收集问题和反馈</li><li>优化配置和文档</li></ul></li><li><p>双轨运行</p></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   package.json:
   {
   &quot;scripts&quot;: {
   &quot;dev&quot;: &quot;vite&quot;, // Vite 开发
   &quot;dev:webpack&quot;: &quot;webpack serve&quot;, // 保留 Webpack
   &quot;build&quot;: &quot;vite build&quot;,
   &quot;build:webpack&quot;: &quot;webpack build&quot;
   }
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>开发者可以自由选择：</p><ul><li>新功能开发用 Vite</li><li>出问题可以切回 Webpack</li></ul><ol start="3"><li><p>构建产物对比</p><ul><li>分别构建</li></ul><p>npm run build # Vite npm run build:webpack</p><ul><li><p>对比产物</p></li><li><p>文件数量</p></li><li><p>体积大小</p></li><li><p>功能完整性</p></li><li><p>性能指标</p></li></ul></li></ol><p>阶段 4：全面迁移阶段（1 周）</p><ol><li><p>团队培训</p><ul><li>分享 Vite 基础知识</li><li>讲解配置差异</li><li>演示常见问题解决</li></ul></li><li><p>统一切换</p><ul><li>所有开发者切换到 Vite</li><li>删除 Webpack 配置（保留备份）</li><li>更新 CI/CD 流程</li></ul></li><li><p>监控和调优</p><ul><li>收集问题</li><li>快速响应</li><li>持续优化</li></ul></li></ol><p>阶段 5：收尾阶段（1 周）</p><ol><li><p>清理代码 □ 删除 Webpack 相关依赖 □ 删除 Webpack 配置文件 □ 更新文档</p><p>npm uninstall webpack webpack-cli webpack-dev-server npm uninstall babel-loader css-loader style-loader ...</p><p>git rm webpack.config.js git rm babel.config.js</p></li><li><p>更新 CI/CD</p><ul><li><p>.gitlab-ci.yml / .github/workflows</p></li><li><p>npm run build:webpack</p></li></ul><ul><li>npm run build</li></ul></li><li><p>总结复盘</p><ul><li>迁移时间</li><li>遇到的问题</li><li>最终收益</li><li>经验教训</li></ul></li></ol><p>四、回滚预案</p><ol><li><p>触发条件</p><ul><li>严重 Bug 无法快速修复</li><li>性能严重下降</li><li>团队强烈反对</li></ul></li><li><p>回滚步骤 git checkout webpack-backup-branch npm install # 恢复依赖 npm run dev:webpack</p></li><li><p>降低回滚风险</p><ul><li>保留 Webpack 配置 1 个月</li><li>定期备份稳定版本</li><li>充分测试再删除</li></ul></li></ol><p>五、迁移检查清单</p><p>【开发环境】 □ npm run dev 能正常启动 □ 热更新（HMR）正常工作 □ Source Map 可以正常调试 □ 环境变量正确注入 □ API 代理正常工作 □ 别名（@/~）正常解析 □ CSS/SCSS 正常编译 □ 图片等静态资源正常加载</p><p>【构建产物】 □ npm run build 成功 □ 产物文件结构正确 □ HTML 正确引用 JS/CSS □ 代码分割正常 □ 资源文件正确输出 □ 环境变量正确替换 □ Source Map 正确生成（可选）</p><p>【功能测试】 □ 所有页面能正常访问 □ 路由跳转正常 □ 状态管理正常 □ API 请求正常 □ 表单提交正常 □ 文件上传/下载正常 □ WebSocket 连接正常（如有）</p><p>【性能测试】 □ 首屏加载时间 □ 交互响应时间 □ 构建产物体积 □ Lighthouse 评分</p><p>【兼容性测试】 □ Chrome □ Firefox □ Safari □ Edge □ 移动端浏览器</p><p>六、常见问题及解决方案</p><ol><li>依赖预构建问题</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   现象：
   Uncaught Error: Module &quot;xxx&quot; has been externalized

   解决：
   optimizeDeps: {
   include: [&#39;xxx&#39;]
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>循环依赖警告</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   现象：
   Circular dependency detected

   解决：

   - 检查并消除循环依赖
   - 或使用动态 import 打破循环
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>全局变量未定义</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   现象：
   process__ is not defined

   解决：
   define: {
   &#39;process__.env&#39;: {},
   global: &#39;window&#39;
   }
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>Node.js 内置模块</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   现象：
   Cannot find module &#39;path&#39;

   解决：
   npm install -D vite-plugin-node-polyfills

   plugins: [
   nodePolyfills()
   ]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>七、总结</p><p>成功迁移的关键：</p><ol><li>✅ 充分评估和准备</li><li>✅ 分阶段逐步推进</li><li>✅ 保留回滚预案</li><li>✅ 团队充分沟通</li><li>✅ 持续监控优化</li></ol><p>时间规划（中型项目）：</p><ul><li>准备阶段：1-2 周</li><li>试运行：1 周</li><li>灰度发布：2 周</li><li>全面迁移：1 周</li><li>收尾：1 周</li><li>总计：6-7 周</li></ul><p>预期收益：</p><ul><li>开发速度提升 10-20 倍</li><li>开发体验显著提升</li><li>维护成本降低</li><li>团队技术栈现代化</li></ul><hr><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress/mack/01-React%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" class="" aria-label="React 16+ 各版本区别 &amp; React 核心原理"><!--[--><!--]--> React 16+ 各版本区别 &amp; React 核心原理 <!--[--><!--]--></a></span><span class="next"><a href="/vuepress/mack/03-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="" aria-label="性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot;"><!--[--><!--]--> 性能优化流程 &amp; 从浏览器请求链路解释&quot;为什么这么优化&quot; <!--[--><!--]--></a></span></p></nav><!--[--><!--[--><div style="display:none"></div><div class="adsbygoogle-box"><ins class="adsbygoogle" style="display:block;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6846038091720568" data-ad-slot="1554369026"></ins></div><div style="display:none"> (adsbygoogle = window.adsbygoogle || []).push({}); </div><!--]--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script src="/vuepress/assets/js/runtime~app.f97bd93a.js" defer></script><script src="/vuepress/assets/js/5316.94e78182.js" defer></script><script src="/vuepress/assets/js/app.277a2eeb.js" defer></script>
  </body>
</html>
